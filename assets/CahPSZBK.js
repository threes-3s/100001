import{f as Z,A as Ee,S as Se,c as k,a as Ae,u as C,b as D,h as ke}from"./DIgKSzXd.js";import"./Urg1aW1i.js";import"./app-CGcBzPiP.js";var Te=function(){var r=function(t,e){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(s,a){s.__proto__=a}||function(s,a){for(var n in a)a.hasOwnProperty(n)&&(s[n]=a[n])},r(t,e)};return function(t,e){r(t,e);function s(){this.constructor=t}t.prototype=e===null?Object.create(e):(s.prototype=e.prototype,new s)}}(),N=function(){return N=Object.assign||function(r){for(var t,e=1,s=arguments.length;e<s;e++){t=arguments[e];for(var a in t)Object.prototype.hasOwnProperty.call(t,a)&&(r[a]=t[a])}return r},N.apply(this,arguments)},Oe=function(r,t,e,s){function a(n){return n instanceof e?n:new e(function(c){c(n)})}return new(e||(e=Promise))(function(n,c){function u(o){try{i(s.next(o))}catch(f){c(f)}}function l(o){try{i(s.throw(o))}catch(f){c(f)}}function i(o){o.done?n(o.value):a(o.value).then(u,l)}i((s=s.apply(r,t||[])).next())})},Ie=function(r,t){var e={label:0,sent:function(){if(n[0]&1)throw n[1];return n[1]},trys:[],ops:[]},s,a,n,c;return c={next:u(0),throw:u(1),return:u(2)},typeof Symbol=="function"&&(c[Symbol.iterator]=function(){return this}),c;function u(i){return function(o){return l([i,o])}}function l(i){if(s)throw new TypeError("Generator is already executing.");for(;e;)try{if(s=1,a&&(n=i[0]&2?a.return:i[0]?a.throw||((n=a.return)&&n.call(a),0):a.next)&&!(n=n.call(a,i[1])).done)return n;switch(a=0,n&&(i=[i[0]&2,n.value]),i[0]){case 0:case 1:n=i;break;case 4:return e.label++,{value:i[1],done:!1};case 5:e.label++,a=i[1],i=[0];continue;case 7:i=e.ops.pop(),e.trys.pop();continue;default:if(n=e.trys,!(n=n.length>0&&n[n.length-1])&&(i[0]===6||i[0]===2)){e=0;continue}if(i[0]===3&&(!n||i[1]>n[0]&&i[1]<n[3])){e.label=i[1];break}if(i[0]===6&&e.label<n[1]){e.label=n[1],n=i;break}if(n&&e.label<n[2]){e.label=n[2],e.ops.push(i);break}n[2]&&e.ops.pop(),e.trys.pop();continue}i=t.call(r,e)}catch(o){i=[6,o],a=0}finally{s=n=0}if(i[0]&5)throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}};function Re(){if(typeof wx>"u"||typeof Page>"u"||!wx.getSystemInfoSync||!wx.getStorageSync||!wx.setStorageSync||!wx.connectSocket||!wx.request)return!1;try{if(!wx.getSystemInfoSync()||wx.getSystemInfoSync().AppPlatform==="qq")return!1}catch{return!1}return!0}function Ce(){return typeof App>"u"&&typeof getApp>"u"&&!wx.onAppHide&&!wx.offAppHide&&!wx.onAppShow&&!wx.offAppShow}var xe=function(r){Te(t,r);function t(e){e===void 0&&(e={});var s=r.call(this)||this,a=e.timeout,n=e.timeoutMsg,c=e.restrictedMethods;return s._timeout=a||0,s._timeoutMsg=n||"请求超时",s._restrictedMethods=c||["get","post","upload","download"],s}return t.prototype.post=function(e){var s=this;return new Promise(function(a,n){var c=e.url,u=e.data,l=e.headers,i=wx.request({url:Z("https:",c),data:u,timeout:s._timeout,method:"POST",header:l,success:function(o){a(o)},fail:function(o){n(o)},complete:function(o){if(!(!o||!o.errMsg)&&!(!s._timeout||s._restrictedMethods.indexOf("post")===-1)){var f=o.errMsg;if(f==="request:fail timeout"){console.warn(s._timeoutMsg);try{i.abort()}catch{}}}}})})},t.prototype.upload=function(e){var s=this,a=this;return new Promise(function(n){return Oe(s,void 0,void 0,function(){var c,u,l,i,o,f;return Ie(this,function(p){return c=e.url,u=e.file,l=e.data,i=e.headers,o=e.onUploadProgress,f=wx.uploadFile({url:c,filePath:u,name:"file",formData:N({},l),header:i,timeout:this._timeout,success:function(h){var y={statusCode:h.statusCode,data:h.data||{}};h.statusCode===200&&l.success_action_status&&(y.statusCode=parseInt(l.success_action_status,10)),n(y)},fail:function(h){n(h)},complete:function(h){if(!(!h||!h.errMsg)&&!(!a._timeout||a._restrictedMethods.indexOf("upload")===-1)){var y=h.errMsg;if(y==="request:fail timeout"){console.warn(a._timeoutMsg);try{f.abort()}catch{}}}}}),o&&f.onProgressUpdate(function(h){o(h)}),[2]})})})},t.prototype.download=function(e){var s=this,a=this;return new Promise(function(n,c){var u=e.url,l=e.headers,i=wx.downloadFile({url:Z("https:",u),header:l,timeout:s._timeout,success:function(o){o.statusCode===200&&o.tempFilePath?n({statusCode:200,tempFilePath:o.tempFilePath}):n(o)},fail:function(o){c(o)},complete:function(o){if(!(!o||!o.errMsg)&&!(!a._timeout||a._restrictedMethods.indexOf("download")===-1)){var f=o.errMsg;if(f==="request:fail timeout"){console.warn(a._timeoutMsg);try{i.abort()}catch{}}}}})})},t}(Ee),Ne={setItem:function(r,t){wx.setStorageSync(r,t)},getItem:function(r){return wx.getStorageSync(r)},removeItem:function(r){wx.removeStorageSync(r)},clear:function(){wx.clearStorageSync()}},Pe=function(){function r(t,e){e===void 0&&(e={});var s=wx.connectSocket(N({url:t},e)),a={set onopen(n){s.onOpen(n)},set onmessage(n){s.onMessage(n)},set onclose(n){s.onClose(n)},set onerror(n){s.onError(n)},send:function(n){return s.send({data:n})},close:function(n,c){return s.close({code:n,reason:c})},get readyState(){return s.readyState},CONNECTING:0,OPEN:1,CLOSING:2,CLOSED:3};return a}return r}();function Me(){var r={root:{},reqClass:xe,wsClass:Pe,localStorage:Ne,primaryStorage:Se.local,getAppSign:function(){var t=wx.getAccountInfoSync();return Ce()?t&&t.plugin?t.plugin.appId:"":t&&t.miniProgram?t.miniProgram.appId:""}};return r}var Ke={genAdapter:Me,isMatch:Re,runtime:"wx_mp"},W=function(){for(var r=0,t=0,e=arguments.length;t<e;t++)r+=arguments[t].length;for(var s=Array(r),a=0,t=0;t<e;t++)for(var n=arguments[t],c=0,u=n.length;c<u;c++,a++)s[a]=n[c];return s},P=k.ERRORS,ee={};function De(r,t){var e=t.name,s=t.namespace,a=t.entity,n=t.injectEvents,c=t.IIFE,u=c===void 0?!1:c;if(ee[e]||s&&r[s])throw new Error(JSON.stringify({code:P.INVALID_OPERATION,msg:"Duplicate component "+e}));if(u){if(!a||typeof a!="function")throw new Error(JSON.stringify({code:P.INVALID_PARAMS,msg:"IIFE component's entity must be a function"}));a.call(r)}if(ee[e]=t,s?r.prototype[s]=a:de(r.prototype,a),n){var l=n.bus,i=n.events;if(!l||!i||i.length===0)return;var o=r.prototype.fire||function(){};r.prototype.events||(r.prototype.events={});var f=r.prototype.events||{};f[e]?r.prototype.events[e].events=W(r.prototype.events[e].events,i):r.prototype.events[e]={bus:l,events:i},r.prototype.fire=function(p,h){o(p,h);for(var y in this.events){var m=this.events[y],d=m.bus,T=m.events;if(T.includes(p)){d.fire(p,h);break}}}}}function de(r,t){if(!(t instanceof Object))return t;switch(t.constructor){case Date:var e=t;return new Date(e.getTime());case Object:r===void 0&&(r={});break;case Array:r=[];break;default:return t}for(var s in t)t.hasOwnProperty(s)&&(r[s]=de(r[s],t[s]));return r}function Ue(r,t){var e=t.entity,s=t.target;if(!r.prototype.hasOwnProperty(s))throw new Error(JSON.stringify({code:P.INVALID_OPERATION,msg:"target:"+s+" is not exist"}));var a=r.prototype[s];if(typeof a!="function")throw new Error(JSON.stringify({code:P.INVALID_OPERATION,msg:"target:"+s+" is not a function which is the only type supports hook"}));r.prototype[s]=function(){for(var n=[],c=0;c<arguments.length;c++)n[c]=arguments[c];return e.call.apply(e,W([this],n)),a.call.apply(a,W([this],n))}}var g={},A=function(){return A=Object.assign||function(r){for(var t,e=1,s=arguments.length;e<s;e++){t=arguments[e];for(var a in t)Object.prototype.hasOwnProperty.call(t,a)&&(r[a]=t[a])}return r},A.apply(this,arguments)},Fe="access_token",qe="access_token_expire",je="refresh_token",Le="anonymous_uuid",Be="login_type",Ve="user_info",te=Ae.CloudbaseCache,x={},J={};function ne(r){var t=r.env,e=r.persistence,s=r.platformInfo,a=Fe+"_"+t,n=qe+"_"+t,c=je+"_"+t,u=Le+"_"+t,l=Be+"_"+t,i=Ve+"_"+t,o={accessTokenKey:a,accessTokenExpireKey:n,refreshTokenKey:c,anonymousUuidKey:u,loginTypeKey:l,userInfoKey:i};x[t]?x[t].updatePersistence(e):x[t]=new te(A(A({},r),{keys:o,platformInfo:s,alwaysLocalKeys:["anonymousUuidKey"]})),J[t]=J[t]||new te(A(A({},r),{keys:o,platformInfo:s,persistence:"local"}))}function he(r){return x[r]}function pe(r){return J[r]}var He=k.setSdkName,We=k.setProtocol,ye="",ge="@cloudbase/js-sdk";function Je(r){ye=r}function $e(){return ye}function Ye(r){ge=r,He(r)}function Ge(){return ge}var Xe="2020-01-10",ve=typeof location<"u"&&location.protocol==="http:"?"http:":"https:",me=(typeof process<"u","//tcb-api.tencentcloudapi.com/web");function _e(r,t){me=r,t&&(ve=t,We(t))}function Qe(r,t,e){var s=t?"//"+r+"."+t+".tcb-api.tencentcloudapi.com/web":"//"+r+".ap-shanghai.tcb-api.tencentcloudapi.com/web";_e(s,e)}function ze(){return{BASE_URL:me,PROTOCOL:ve}}var $;(function(r){r.ANONYMOUS="ANONYMOUS",r.WECHAT="WECHAT",r.CUSTOM="CUSTOM",r.NULL="NULL"})($||($={}));var re={LOGIN_STATE_CHANGED:"loginStateChanged",LOGIN_STATE_EXPIRED:"loginStateExpire",LOGIN_TYPE_CHANGED:"loginTypeChanged",ANONYMOUS_CONVERTED:"anonymousConverted",ACCESS_TOKEN_REFRESHD:"refreshAccessToken"},v=function(){return v=Object.assign||function(r){for(var t,e=1,s=arguments.length;e<s;e++){t=arguments[e];for(var a in t)Object.prototype.hasOwnProperty.call(t,a)&&(r[a]=t[a])}return r},v.apply(this,arguments)},_=function(r,t,e,s){function a(n){return n instanceof e?n:new e(function(c){c(n)})}return new(e||(e=Promise))(function(n,c){function u(o){try{i(s.next(o))}catch(f){c(f)}}function l(o){try{i(s.throw(o))}catch(f){c(f)}}function i(o){o.done?n(o.value):a(o.value).then(u,l)}i((s=s.apply(r,t||[])).next())})},b=function(r,t){var e={label:0,sent:function(){if(n[0]&1)throw n[1];return n[1]},trys:[],ops:[]},s,a,n,c;return c={next:u(0),throw:u(1),return:u(2)},typeof Symbol=="function"&&(c[Symbol.iterator]=function(){return this}),c;function u(i){return function(o){return l([i,o])}}function l(i){if(s)throw new TypeError("Generator is already executing.");for(;e;)try{if(s=1,a&&(n=i[0]&2?a.return:i[0]?a.throw||((n=a.return)&&n.call(a),0):a.next)&&!(n=n.call(a,i[1])).done)return n;switch(a=0,n&&(i=[i[0]&2,n.value]),i[0]){case 0:case 1:n=i;break;case 4:return e.label++,{value:i[1],done:!1};case 5:e.label++,a=i[1],i=[0];continue;case 7:i=e.ops.pop(),e.trys.pop();continue;default:if(n=e.trys,!(n=n.length>0&&n[n.length-1])&&(i[0]===6||i[0]===2)){e=0;continue}if(i[0]===3&&(!n||i[1]>n[0]&&i[1]<n[3])){e.label=i[1];break}if(i[0]===6&&e.label<n[1]){e.label=n[1],n=i;break}if(n&&e.label<n[2]){e.label=n[2],e.ops.push(i);break}n[2]&&e.ops.pop(),e.trys.pop();continue}i=t.call(r,e)}catch(o){i=[6,o],a=0}finally{s=n=0}if(i[0]&5)throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}},R=k.ERRORS,Ze=C.genSeqId,et=C.isFormData,tt=C.formatUrl,nt=C.createSign,rt=D.RUNTIME,se=["auth.getJwt","auth.logout","auth.signInWithTicket","auth.signInAnonymously","auth.signIn","auth.fetchAccessTokenWithRefreshToken","auth.signUpWithEmailAndPassword","auth.activateEndUserMail","auth.sendPasswordResetEmail","auth.resetPasswordWithToken","auth.isUsernameRegistered"];function V(r,t,e){var s=r[t];r[t]=function(a){var n={},c={};e.forEach(function(l){var i=l.call(r,a),o=i.data,f=i.headers;Object.assign(n,o),Object.assign(c,f)});var u=a.data;return u&&function(){if(et(u)){for(var l in n)u.append(l,n[l]);return}a.data=v(v({},u),n)}(),a.headers=v(v({},a.headers||{}),c),s.call(r,a)}}function H(){var r=Ze();return{data:{seqId:r},headers:{"X-SDK-Version":"@cloudbase/js-sdk/"+$e(),"x-seqid":r}}}var st=function(){function r(t){this._throwWhenRequestFail=!1,this.config=t,this._reqClass=new g.adapter.reqClass({timeout:this.config.timeout,timeoutMsg:"[@cloudbase/js-sdk] 请求在"+this.config.timeout/1e3+"s内未完成，已中断",restrictedMethods:["post"]}),this._throwWhenRequestFail=t.throw||!1,this._cache=he(this.config.env),this._localCache=pe(this.config.env),V(this._reqClass,"post",[H]),V(this._reqClass,"upload",[H]),V(this._reqClass,"download",[H])}return r.prototype.post=function(t){return _(this,void 0,void 0,function(){var e;return b(this,function(s){switch(s.label){case 0:return[4,this._reqClass.post(t)];case 1:return e=s.sent(),[2,e]}})})},r.prototype.upload=function(t){return _(this,void 0,void 0,function(){var e;return b(this,function(s){switch(s.label){case 0:return[4,this._reqClass.upload(t)];case 1:return e=s.sent(),[2,e]}})})},r.prototype.download=function(t){return _(this,void 0,void 0,function(){var e;return b(this,function(s){switch(s.label){case 0:return[4,this._reqClass.download(t)];case 1:return e=s.sent(),[2,e]}})})},r.prototype.refreshAccessToken=function(){return _(this,void 0,void 0,function(){var t,e,s;return b(this,function(a){switch(a.label){case 0:this._refreshAccessTokenPromise||(this._refreshAccessTokenPromise=this._refreshAccessToken()),a.label=1;case 1:return a.trys.push([1,3,,4]),[4,this._refreshAccessTokenPromise];case 2:return t=a.sent(),[3,4];case 3:return s=a.sent(),e=s,[3,4];case 4:if(this._refreshAccessTokenPromise=null,this._shouldRefreshAccessTokenHook=null,e)throw e;return[2,t]}})})},r.prototype.getAccessToken=function(){return _(this,void 0,void 0,function(){var t,e,s,a,n,c,u,l,i,o;return b(this,function(f){switch(f.label){case 0:return t=this._cache.keys,e=t.accessTokenKey,s=t.accessTokenExpireKey,a=t.refreshTokenKey,[4,this._cache.getStoreAsync(a)];case 1:if(n=f.sent(),!n)throw new Error(JSON.stringify({code:R.OPERATION_FAIL,msg:"refresh token is not exist, your local data might be messed up, please retry after clear localStorage or sessionStorage"}));return[4,this._cache.getStoreAsync(e)];case 2:return c=f.sent(),l=Number,[4,this._cache.getStoreAsync(s)];case 3:return u=l.apply(void 0,[f.sent()]),i=!0,o=this._shouldRefreshAccessTokenHook,o?[4,this._shouldRefreshAccessTokenHook(c,u)]:[3,5];case 4:o=!f.sent(),f.label=5;case 5:return o&&(i=!1),(!c||!u||u<Date.now())&&i?[4,this.refreshAccessToken()]:[3,7];case 6:return[2,f.sent()];case 7:return[2,{accessToken:c,accessTokenExpire:u}]}})})},r.prototype.request=function(t,e,s){return _(this,void 0,void 0,function(){var a,n,c,u,l,i,o,f,f,p,h,y,m,d,T,Y,U,G,X,F,q,O,j,Q,z,L,w,B;return b(this,function(I){switch(I.label){case 0:return a="x-tcb-trace_"+this.config.env,n="application/x-www-form-urlencoded",c=v({action:t,dataVersion:Xe,env:this.config.env},e),se.indexOf(t)!==-1?[3,3]:(u=this._cache.keys.refreshTokenKey,[4,this._cache.getStoreAsync(u)]);case 1:return l=I.sent(),l?(i=c,[4,this.getAccessToken()]):[3,3];case 2:i.access_token=I.sent().accessToken,I.label=3;case 3:if(t==="storage.uploadFile"){o=new FormData;for(f in o)o.hasOwnProperty(f)&&o[f]!==void 0&&o.append(f,c[f]);n="multipart/form-data"}else{n="application/json;charset=UTF-8",o={};for(f in c)c[f]!==void 0&&(o[f]=c[f])}return p={headers:{"content-type":n}},s!=null&&s.onUploadProgress&&(p.onUploadProgress=s.onUploadProgress),this.config.region&&(p.headers["X-TCB-Region"]=this.config.region),h=this._localCache.getStore(a),h&&(p.headers["X-TCB-Trace"]=h),g.runtime!==rt.WEB&&(y=this.config,m=y.appSign,d=y.appSecret,T=Date.now(),Y=d.appAccessKey,U=d.appAccessKeyId,G=nt({data:{},timestamp:T,appAccessKeyId:U,appSign:m},Y),p.headers["X-TCB-App-Source"]="timestamp="+T+";appAccessKeyId="+U+";appSign="+m+";sign="+G),X=e.parse,F=e.inQuery,q=e.search,O={env:this.config.env},X&&(O.parse=!0),F&&(O=v(v({},F),O)),j=ze(),Q=j.BASE_URL,z=j.PROTOCOL,L=tt(z,Q,O),q&&(L+=q),[4,this.post(v({url:L,data:o},p))];case 4:if(w=I.sent(),B=w.header&&w.header["x-tcb-trace"],B&&this._localCache.setStore(a,B),Number(w.status)!==200&&Number(w.statusCode)!==200||!w.data)throw new Error("network request error");return[2,w]}})})},r.prototype.send=function(t,e){return e===void 0&&(e={}),_(this,void 0,void 0,function(){var s;return b(this,function(a){switch(a.label){case 0:return[4,this.request(t,e,{onUploadProgress:e.onUploadProgress})];case 1:return s=a.sent(),s.data.code==="ACCESS_TOKEN_EXPIRED"&&se.indexOf(t)===-1?[4,this.refreshAccessToken()]:[3,4];case 2:return a.sent(),[4,this.request(t,e,{onUploadProgress:e.onUploadProgress})];case 3:s=a.sent(),a.label=4;case 4:if(s.data.code&&this._throwWhenRequestFail)throw new Error(JSON.stringify({code:R.OPERATION_FAIL,msg:"["+s.data.code+"] "+s.data.message}));return[2,s.data]}})})},r.prototype._refreshAccessToken=function(t){return t===void 0&&(t=1),_(this,void 0,void 0,function(){var e,s,a,n,c,u,l,i,o,f,p,h,y,m;return b(this,function(d){switch(d.label){case 0:return e=this._cache.keys,s=e.accessTokenKey,a=e.accessTokenExpireKey,n=e.refreshTokenKey,c=e.loginTypeKey,u=e.anonymousUuidKey,[4,this._cache.removeStoreAsync(s)];case 1:return d.sent(),[4,this._cache.removeStoreAsync(a)];case 2:return d.sent(),[4,this._cache.getStoreAsync(n)];case 3:if(l=d.sent(),!l)throw new Error(JSON.stringify({code:R.INVALID_OPERATION,msg:"not login"}));return i={refresh_token:l},[4,this.request("auth.fetchAccessTokenWithRefreshToken",i)];case 4:return o=d.sent(),o.data.code?(f=o.data.code,f==="SIGN_PARAM_INVALID"||f==="REFRESH_TOKEN_EXPIRED"||f==="INVALID_REFRESH_TOKEN"?[4,this._cache.getStoreAsync(c)]:[3,11]):[3,12];case 5:return p=d.sent()===$.ANONYMOUS,p&&f==="INVALID_REFRESH_TOKEN"?[4,this._cache.getStoreAsync(u)]:[3,9];case 6:return h=d.sent(),[4,this._cache.getStoreAsync(n)];case 7:return y=d.sent(),[4,this.send("auth.signInAnonymously",{anonymous_uuid:h,refresh_token:y})];case 8:if(m=d.sent(),this._setRefreshToken(m.refresh_token),t>=1)return[2,this._refreshAccessToken(--t)];throw new Error(JSON.stringify({code:R.OPERATION_FAIL,message:"重试获取 refresh token 失败"}));case 9:return K.fire(re.LOGIN_STATE_EXPIRED),[4,this._cache.removeStoreAsync(n)];case 10:d.sent(),d.label=11;case 11:throw new Error(JSON.stringify({code:R.NETWORK_ERROR,msg:"refresh access_token failed："+o.data.code}));case 12:return o.data.access_token?(K.fire(re.ACCESS_TOKEN_REFRESHD),[4,this._cache.setStoreAsync(s,o.data.access_token)]):[3,15];case 13:return d.sent(),[4,this._cache.setStoreAsync(a,o.data.access_token_expire+Date.now())];case 14:return d.sent(),[2,{accessToken:o.data.access_token,accessTokenExpire:o.data.access_token_expire}];case 15:return o.data.refresh_token?[4,this._cache.removeStoreAsync(n)]:[3,19];case 16:return d.sent(),[4,this._cache.setStoreAsync(n,o.data.refresh_token)];case 17:return d.sent(),[4,this._refreshAccessToken()];case 18:d.sent(),d.label=19;case 19:return[2]}})})},r.prototype._setRefreshToken=function(t){return _(this,void 0,void 0,function(){var e,s,a,n;return b(this,function(c){switch(c.label){case 0:return e=this._cache.keys,s=e.accessTokenKey,a=e.accessTokenExpireKey,n=e.refreshTokenKey,[4,this._cache.removeStoreAsync(s)];case 1:return c.sent(),[4,this._cache.removeStoreAsync(a)];case 2:return c.sent(),[4,this._cache.setStoreAsync(n,t)];case 3:return c.sent(),[2]}})})},r}(),be={};function at(r){be[r.env]=new st(v(v({},r),{throw:!0}))}function it(r){return be[r]}var M=function(){return M=Object.assign||function(r){for(var t,e=1,s=arguments.length;e<s;e++){t=arguments[e];for(var a in t)Object.prototype.hasOwnProperty.call(t,a)&&(r[a]=t[a])}return r},M.apply(this,arguments)},ae=function(r,t,e,s){var a=arguments.length,n=a<3?t:s===null?s=Object.getOwnPropertyDescriptor(t,e):s,c;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")n=Reflect.decorate(r,t,e,s);else for(var u=r.length-1;u>=0;u--)(c=r[u])&&(n=(a<3?c(n):a>3?c(t,e,n):c(t,e))||n);return a>3&&n&&Object.defineProperty(t,e,n),n},S=function(r,t){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(r,t)},ot=function(r,t,e,s){function a(n){return n instanceof e?n:new e(function(c){c(n)})}return new(e||(e=Promise))(function(n,c){function u(o){try{i(s.next(o))}catch(f){c(f)}}function l(o){try{i(s.throw(o))}catch(f){c(f)}}function i(o){o.done?n(o.value):a(o.value).then(u,l)}i((s=s.apply(r,t||[])).next())})},ct=function(r,t){var e={label:0,sent:function(){if(n[0]&1)throw n[1];return n[1]},trys:[],ops:[]},s,a,n,c;return c={next:u(0),throw:u(1),return:u(2)},typeof Symbol=="function"&&(c[Symbol.iterator]=function(){return this}),c;function u(i){return function(o){return l([i,o])}}function l(i){if(s)throw new TypeError("Generator is already executing.");for(;e;)try{if(s=1,a&&(n=i[0]&2?a.return:i[0]?a.throw||((n=a.return)&&n.call(a),0):a.next)&&!(n=n.call(a,i[1])).done)return n;switch(a=0,n&&(i=[i[0]&2,n.value]),i[0]){case 0:case 1:n=i;break;case 4:return e.label++,{value:i[1],done:!1};case 5:e.label++,a=i[1],i=[0];continue;case 7:i=e.ops.pop(),e.trys.pop();continue;default:if(n=e.trys,!(n=n.length>0&&n[n.length-1])&&(i[0]===6||i[0]===2)){e=0;continue}if(i[0]===3&&(!n||i[1]>n[0]&&i[1]<n[3])){e.label=i[1];break}if(i[0]===6&&e.label<n[1]){e.label=n[1],n=i;break}if(n&&e.label<n[2]){e.label=n[2],e.ops.push(i);break}n[2]&&e.ops.pop(),e.trys.pop();continue}i=t.call(r,e)}catch(o){i=[6,o],a=0}finally{s=n=0}if(i[0]&5)throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}},ut=D.useAdapters,ft=D.useDefaultAdapter,lt=D.RUNTIME,E=k.ERRORS,ie=k.COMMUNITY_SITE_URL,oe=C.printWarn,ce=ke.catchErrorsDecorator,dt={timeout:15e3,persistence:"local"},ue=1e3*60*10,fe=100,le={},ht=function(){function r(t){this._config=t||this._config,this.authInstance=null}return Object.defineProperty(r.prototype,"config",{get:function(){return this._config},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"platform",{get:function(){return g},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"cache",{get:function(){return he(this._config.env)},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"localCache",{get:function(){return pe(this._config.env)},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"request",{get:function(){return it(this._config.env)},enumerable:!1,configurable:!0}),r.prototype.init=function(t){if(!t.env)throw new Error(JSON.stringify({code:E.INVALID_PARAMS,msg:"env must not be specified"}));if(g.adapter||this._useDefaultAdapter(),this.requestClient=new g.adapter.reqClass({timeout:t.timeout||5e3,timeoutMsg:"["+Ge()+"][REQUEST TIMEOUT] request had been abort since didn't finished within"+t.timeout/1e3+"s"}),g.runtime!==lt.WEB){if(!t.appSecret)throw new Error(JSON.stringify({code:E.INVALID_PARAMS,msg:"invalid appSecret"}));var e=g.adapter.getAppSign?g.adapter.getAppSign():"";if(t.appSign&&e&&t.appSign!==e)throw new Error(JSON.stringify({code:E.INVALID_PARAMS,msg:"invalid appSign"}));if(e&&(t.appSign=e),!t.appSign)throw new Error(JSON.stringify({code:E.INVALID_PARAMS,msg:"invalid appSign"}))}this._config=M(M({},dt),t),this._config.timeout=this._formatTimeout(this._config.timeout);var s=this._config,a=s.env,n=s.persistence,c=s.debug,u=s.timeout,l=s.appSecret,i=s.appSign;ne({env:a,persistence:n,debug:c,platformInfo:this.platform}),at({env:a,region:t.region||"",timeout:u,appSecret:l,appSign:i}),t.region&&Qe(a,t.region||"");var o=new r(this._config);return o.requestClient=this.requestClient,o},r.prototype.updateConfig=function(t){var e=t.persistence,s=t.debug;this._config.persistence=e,this._config.debug=s,ne({env:this._config.env,persistence:e,debug:s,platformInfo:this.platform})},r.prototype.registerExtension=function(t){le[t.name]=t},r.prototype.invokeExtension=function(t,e){return ot(this,void 0,void 0,function(){var s;return ct(this,function(a){switch(a.label){case 0:if(s=le[t],!s)throw new Error(JSON.stringify({code:E.INVALID_PARAMS,msg:"extension:"+t+" must be registered before invoke"}));return[4,s.invoke(e,this)];case 1:return[2,a.sent()]}})})},r.prototype.useAdapters=function(t){var e=ut(t)||{},s=e.adapter,a=e.runtime;s&&(g.adapter=s),a&&(g.runtime=a)},r.prototype.registerHook=function(t){Ue(r,t)},r.prototype.registerComponent=function(t){De(r,t)},r.prototype.registerVersion=function(t){Je(t)},r.prototype.registerSdkName=function(t){Ye(t)},r.prototype.registerEndPoint=function(t,e){_e(t,e)},r.prototype._useDefaultAdapter=function(){var t=ft(),e=t.adapter,s=t.runtime;g.adapter=e,g.runtime=s},r.prototype._formatTimeout=function(t){switch(!0){case t>ue:return oe(E.INVALID_PARAMS,"timeout is greater than maximum value[10min]"),ue;case t<fe:return oe(E.INVALID_PARAMS,"timeout is less than maximum value[100ms]"),fe;default:return t}},ae([ce({mode:"sync",title:"Cloudbase 初始化失败",messages:["请确认以下各项：","  1 - 调用 cloudbase.init() 的语法或参数是否正确","  2 - 如果是非浏览器环境，是否配置了安全应用来源（https://docs.cloudbase.net/api-reference/webv2/adapter.html#jie-ru-liu-cheng）","如果问题依然存在，建议到官方问答社区提问或寻找帮助："+ie]}),S("design:type",Function),S("design:paramtypes",[Object]),S("design:returntype",r)],r.prototype,"init",null),ae([ce({title:"调用扩展能力失败",messages:["请确认以下各项：","  1 - 调用 invokeExtension() 的语法或参数是否正确","  2 - 被调用的扩展能力是否已经安装并通过 registerExtension() 注册","如果问题依然存在，建议到官方问答社区提问或寻找帮助："+ie]}),S("design:type",Function),S("design:paramtypes",[String,Object]),S("design:returntype",Promise)],r.prototype,"invokeExtension",null),r}(),K=new ht;K.useAdapters(Ke);const we=K,pt="@cloudbase/js-sdk",yt="1.7.2",gt="cloudbase javascript sdk",vt="dist/index.cjs.js",mt="dist/index.esm.js",_t="miniprogram_dist",bt="./index.d.ts",wt={lint:'eslint --fix "./src/**/*.ts" "./database/**/*.ts"',build:"rm -rf dist/ && gulp build","build:cdn":"gulp cdn","build:miniapp":"gulp miniapp","build:e2e":"rm -rf dist/ && NODE_ENV=e2e gulp e2e"},Et={access:"public"},St={type:"git",url:"https://github.com/TencentCloudBase/cloudbase-js-sdk"},At=["tcb","cloudbase","Cloudbase","serverless","Serverless","javascript","JavaScript"],kt=["miniprogram_dist","**/dist/","/index.d.ts","**/package.json"],Tt=["app","auth","database","functions","storage"],Ot="",It="ISC",Rt={"@cloudbase/analytics":"^1.1.1-alpha.0","@cloudbase/app":"^1.4.1","@cloudbase/auth":"^1.6.1","@cloudbase/database":"0.9.18-next","@cloudbase/functions":"^1.3.4","@cloudbase/realtime":"^1.1.4-alpha.0","@cloudbase/storage":"^1.3.4","@cloudbase/types":"^1.1.3-alpha.0","@cloudbase/utilities":"^1.3.4"},Ct={"@babel/core":"^7.9.0","@babel/plugin-proposal-class-properties":"^7.8.3","@babel/plugin-transform-runtime":"^7.9.0","@babel/preset-env":"^7.9.5","@babel/preset-typescript":"^7.9.0","@typescript-eslint/eslint-plugin":"^3.8.0","@typescript-eslint/parser":"^3.8.0","awesome-typescript-loader":"^5.2.1","babel-loader":"^8.1.0",eslint:"^7.6.0","eslint-config-alloy":"^3.7.4",gulp:"^4.0.2","gulp-clean":"^0.4.0","gulp-rename":"^2.0.0","gulp-sourcemaps":"^2.6.5","gulp-typescript":"^6.0.0-alpha.1","json-loader":"^0.5.7","merge-stream":"^2.0.0","package-json-cleanup-loader":"^1.0.3",typescript:"^3.8.3",webpack:"4.41.3","webpack-cli":"^3.3.11","webpack-node-externals":"^1.7.2","webpack-stream":"^5.2.1","webpack-visualizer-plugin":"^0.1.11"},xt=["last 2 version","> 1%","not dead","chrome 53"],Nt="29ca0bf24318daa1fbb230910edf0b1545e17e7f",Pt={name:pt,version:yt,description:gt,main:vt,module:mt,miniprogram:_t,typings:bt,scripts:wt,publishConfig:Et,repository:St,keywords:At,files:kt,components:Tt,author:Ot,license:It,dependencies:Rt,devDependencies:Ct,browserslist:xt,gitHead:Nt};var Mt=Pt.version;we.registerVersion(Mt);try{window.cloudbase=we}catch{}export{we as default};
