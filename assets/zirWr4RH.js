import{Z as $s,p as qr,a3 as Ms,a0 as Vr,K as qn,a1 as Ae,a2 as kr,T as Fs,q as Vn,aa as er,W as Us,D as js,ab as Ws}from"./app-Ba0Wni1V.js";import{v as Gs}from"./B7rzJU0A.js";import{E as Ri,h as tr}from"./B-illQST.js";import Hs from"./CkQSrMkt.js";import"./DoCqnTqV.js";import{c as Ee,g as gn,E as qs}from"./CbB-UZXg.js";import"./BDc59cHj.js";var tt,je;(function(e){e.DocIDError="文档ID不合法",e.CollNameError="集合名称不合法",e.OpStrError="操作符不合法",e.DirectionError="排序字符不合法",e.IntergerError="must be integer",e.QueryParamTypeError="查询参数必须为对象",e.QueryParamValueError="查询参数对象值不能均为undefined"})(je||(je={}));var V={String:"String",Number:"Number",Object:"Object",Array:"Array",Boolean:"Boolean",Null:"Null",GeoPoint:"GeoPoint",GeoLineString:"GeoLineString",GeoPolygon:"GeoPolygon",GeoMultiPoint:"GeoMultiPoint",GeoMultiLineString:"GeoMultiLineString",GeoMultiPolygon:"GeoMultiPolygon",Timestamp:"Date",Command:"Command",ServerDate:"ServerDate",BsonDate:"BsonDate"},Vs=["desc","asc"],ks=["<","<=","==",">=",">"],it;(function(e){e.lt="<",e.gt=">",e.lte="<=",e.gte=">=",e.eq="=="})(it||(it={}));tt={},tt[it.eq]="$eq",tt[it.lt]="$lt",tt[it.lte]="$lte",tt[it.gt]="$gt",tt[it.gte]="$gte";var Pe;(function(e){e.WHERE="WHERE",e.DOC="DOC"})(Pe||(Pe={}));var Js=function(){var e=function(t,r){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,i){n.__proto__=i}||function(n,i){for(var o in i)i.hasOwnProperty(o)&&(n[o]=i[o])},e(t,r)};return function(t,r){e(t,r);function n(){this.constructor=t}t.prototype=r===null?Object.create(r):(n.prototype=r.prototype,new n)}}(),rr=[],kn={},Ks=function(){function e(t){Object.defineProperties(this,{target:{enumerable:!1,writable:!1,configurable:!1,value:t}})}return e}(),pe=function(e){Js(t,e);function t(r,n){var i=this;if(n!==kn)throw new TypeError("InternalSymbol cannot be constructed with new operator");return i=e.call(this,r)||this,i}return t.for=function(r){for(var n=0,i=rr.length;n<i;n++)if(rr[n].target===r)return rr[n].instance;var o=new t(r,kn);return rr.push({target:r,instance:o}),o},t}(Ks),Ft=pe.for("UNSET_FIELD_NAME"),Ci=pe.for("UPDATE_COMMAND"),Di=pe.for("QUERY_COMMAND"),Li=pe.for("LOGIC_COMMAND"),Bi=pe.for("GEO_POINT"),Ys=pe.for("SYMBOL_GEO_LINE_STRING"),Xs=pe.for("SYMBOL_GEO_POLYGON"),Zs=pe.for("SYMBOL_GEO_MULTI_POINT"),zs=pe.for("SYMBOL_GEO_MULTI_LINE_STRING"),Qs=pe.for("SYMBOL_GEO_MULTI_POLYGON"),Pi=pe.for("SERVER_DATE"),$i=pe.for("REGEXP"),Mi=function(){function e(t){var r=(t===void 0?{}:t).offset,n=r===void 0?0:r;this.offset=n}return Object.defineProperty(e.prototype,"_internalType",{get:function(){return Pi},enumerable:!0,configurable:!0}),e.prototype.parse=function(){return{$date:{offset:this.offset}}},e}();function ea(e){return new Mi(e)}var Jr=function(e,t){var r=typeof Symbol=="function"&&e[Symbol.iterator];if(!r)return e;var n=r.call(e),i,o=[],a;try{for(;(t===void 0||t-- >0)&&!(i=n.next()).done;)o.push(i.value)}catch(l){a={error:l}}finally{try{i&&!i.done&&(r=n.return)&&r.call(n)}finally{if(a)throw a.error}}return o},wr=function(){function e(){}return e.formatResDocumentData=function(t){return t.map(function(r){return e.formatField(r)})},e.formatField=function(t){var r=Object.keys(t),n={};return Array.isArray(t)&&(n=[]),r.forEach(function(i){var o=t[i],a=e.whichType(o),l;switch(a){case V.GeoPoint:l=new le(o.coordinates[0],o.coordinates[1]);break;case V.GeoLineString:l=new Le(o.coordinates.map(function(p){return new le(p[0],p[1])}));break;case V.GeoPolygon:l=new at(o.coordinates.map(function(p){return new Le(p.map(function(c){var g=Jr(c,2),m=g[0],_=g[1];return new le(m,_)}))}));break;case V.GeoMultiPoint:l=new ur(o.coordinates.map(function(p){return new le(p[0],p[1])}));break;case V.GeoMultiLineString:l=new cr(o.coordinates.map(function(p){return new Le(p.map(function(c){var g=Jr(c,2),m=g[0],_=g[1];return new le(m,_)}))}));break;case V.GeoMultiPolygon:l=new Ut(o.coordinates.map(function(p){return new at(p.map(function(c){return new Le(c.map(function(g){var m=Jr(g,2),_=m[0],I=m[1];return new le(_,I)}))}))}));break;case V.Timestamp:l=new Date(o.$timestamp*1e3);break;case V.Object:case V.Array:l=e.formatField(o);break;case V.ServerDate:l=new Date(o.$date);break;default:l=o}Array.isArray(n)?n.push(l):n[i]=l}),n},e.whichType=function(t){var r=Object.prototype.toString.call(t).slice(8,-1);if(r===V.Timestamp)return V.BsonDate;if(r===V.Object){if(t instanceof le)return V.GeoPoint;if(t instanceof Date)return V.Timestamp;if(t instanceof Mi)return V.ServerDate;t.$timestamp?r=V.Timestamp:t.$date?r=V.ServerDate:le.validate(t)?r=V.GeoPoint:Le.validate(t)?r=V.GeoLineString:at.validate(t)?r=V.GeoPolygon:ur.validate(t)?r=V.GeoMultiPoint:cr.validate(t)?r=V.GeoMultiLineString:Ut.validate(t)&&(r=V.GeoMultiPolygon)}return r},e.generateDocId=function(){for(var t="ABCDEFabcdef0123456789",r="",n=0;n<24;n++)r+=t.charAt(Math.floor(Math.random()*t.length));return r},e}(),qe=function(){function e(){}return e.isGeopoint=function(t,r){if(wr.whichType(r)!==V.Number)throw new Error("Geo Point must be number type");var n=Math.abs(r);if(t==="latitude"&&n>90)throw new Error("latitude should be a number ranges from -90 to 90");if(t==="longitude"&&n>180)throw new Error("longitude should be a number ranges from -180 to 180");return!0},e.isInteger=function(t,r){if(!Number.isInteger(r))throw new Error(t+je.IntergerError);return!0},e.isFieldOrder=function(t){if(Vs.indexOf(t)===-1)throw new Error(je.DirectionError);return!0},e.isFieldPath=function(t){if(!/^[a-zA-Z0-9-_\.]/.test(t))throw new Error;return!0},e.isOperator=function(t){if(ks.indexOf(t)===-1)throw new Error(je.OpStrError);return!0},e.isCollName=function(t){if(!/^[a-zA-Z0-9]([a-zA-Z0-9-_]){1,32}$/.test(t))throw new Error(je.CollNameError);return!0},e.isDocID=function(t){if(!/^([a-fA-F0-9]){24}$/.test(t))throw new Error(je.DocIDError);return!0},e}(),$e=function(e){return Object.prototype.toString.call(e).slice(8,-1).toLowerCase()},ke=function(e){return $e(e)==="object"},ta=function(e){return $e(e)==="string"},Se=function(e){return $e(e)==="number"},z=function(e){return Array.isArray(e)},Fi=function(e){return $e(e)==="date"},mn=function(e){return $e(e)==="regexp"},Ui=function(e){return e&&e._internalType instanceof pe},le=function(){function e(t,r){qe.isGeopoint("longitude",t),qe.isGeopoint("latitude",r),this.longitude=t,this.latitude=r}return e.prototype.parse=function(t){var r;return r={},r[t]={type:"Point",coordinates:[this.longitude,this.latitude]},r},e.prototype.toJSON=function(){return{type:"Point",coordinates:[this.longitude,this.latitude]}},e.prototype.toReadableString=function(){return"["+this.longitude+","+this.latitude+"]"},e.validate=function(t){return t.type==="Point"&&z(t.coordinates)&&qe.isGeopoint("longitude",t.coordinates[0])&&qe.isGeopoint("latitude",t.coordinates[1])},Object.defineProperty(e.prototype,"_internalType",{get:function(){return Bi},enumerable:!0,configurable:!0}),e}(),ra=function(e){var t=typeof Symbol=="function"&&Symbol.iterator,r=t&&e[t],n=0;if(r)return r.call(e);if(e&&typeof e.length=="number")return{next:function(){return e&&n>=e.length&&(e=void 0),{value:e&&e[n++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")},Le=function(){function e(t){if(!z(t))throw new TypeError('"points" must be of type Point[]. Received type '+typeof t);if(t.length<2)throw new Error('"points" must contain 2 points at least');t.forEach(function(r){if(!(r instanceof le))throw new TypeError('"points" must be of type Point[]. Received type '+typeof r+"[]")}),this.points=t}return e.prototype.parse=function(t){var r;return r={},r[t]={type:"LineString",coordinates:this.points.map(function(n){return n.toJSON().coordinates})},r},e.prototype.toJSON=function(){return{type:"LineString",coordinates:this.points.map(function(t){return t.toJSON().coordinates})}},e.validate=function(t){var r,n;if(t.type!=="LineString"||!z(t.coordinates))return!1;try{for(var i=ra(t.coordinates),o=i.next();!o.done;o=i.next()){var a=o.value;if(!Se(a[0])||!Se(a[1]))return!1}}catch(l){r={error:l}}finally{try{o&&!o.done&&(n=i.return)&&n.call(i)}finally{if(r)throw r.error}}return!0},e.isClosed=function(t){var r=t.points[0],n=t.points[t.points.length-1];if(r.latitude===n.latitude&&r.longitude===n.longitude)return!0},Object.defineProperty(e.prototype,"_internalType",{get:function(){return Ys},enumerable:!0,configurable:!0}),e}(),Jn=function(e){var t=typeof Symbol=="function"&&Symbol.iterator,r=t&&e[t],n=0;if(r)return r.call(e);if(e&&typeof e.length=="number")return{next:function(){return e&&n>=e.length&&(e=void 0),{value:e&&e[n++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")},at=function(){function e(t){if(!z(t))throw new TypeError('"lines" must be of type LineString[]. Received type '+typeof t);if(t.length===0)throw new Error("Polygon must contain 1 linestring at least");t.forEach(function(r){if(!(r instanceof Le))throw new TypeError('"lines" must be of type LineString[]. Received type '+typeof r+"[]");if(!Le.isClosed(r))throw new Error("LineString "+r.points.map(function(n){return n.toReadableString()})+" is not a closed cycle")}),this.lines=t}return e.prototype.parse=function(t){var r;return r={},r[t]={type:"Polygon",coordinates:this.lines.map(function(n){return n.points.map(function(i){return[i.longitude,i.latitude]})})},r},e.prototype.toJSON=function(){return{type:"Polygon",coordinates:this.lines.map(function(t){return t.points.map(function(r){return[r.longitude,r.latitude]})})}},e.validate=function(t){var r,n,i,o;if(t.type!=="Polygon"||!z(t.coordinates))return!1;try{for(var a=Jn(t.coordinates),l=a.next();!l.done;l=a.next()){var p=l.value;if(!this.isCloseLineString(p))return!1;try{for(var c=(i=void 0,Jn(p)),g=c.next();!g.done;g=c.next()){var m=g.value;if(!Se(m[0])||!Se(m[1]))return!1}}catch(_){i={error:_}}finally{try{g&&!g.done&&(o=c.return)&&o.call(c)}finally{if(i)throw i.error}}}}catch(_){r={error:_}}finally{try{l&&!l.done&&(n=a.return)&&n.call(a)}finally{if(r)throw r.error}}return!0},e.isCloseLineString=function(t){var r=t[0],n=t[t.length-1];return!(r[0]!==n[0]||r[1]!==n[1])},Object.defineProperty(e.prototype,"_internalType",{get:function(){return Qs},enumerable:!0,configurable:!0}),e}(),na=function(e){var t=typeof Symbol=="function"&&Symbol.iterator,r=t&&e[t],n=0;if(r)return r.call(e);if(e&&typeof e.length=="number")return{next:function(){return e&&n>=e.length&&(e=void 0),{value:e&&e[n++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")},ur=function(){function e(t){if(!z(t))throw new TypeError('"points" must be of type Point[]. Received type '+typeof t);if(t.length===0)throw new Error('"points" must contain 1 point at least');t.forEach(function(r){if(!(r instanceof le))throw new TypeError('"points" must be of type Point[]. Received type '+typeof r+"[]")}),this.points=t}return e.prototype.parse=function(t){var r;return r={},r[t]={type:"MultiPoint",coordinates:this.points.map(function(n){return n.toJSON().coordinates})},r},e.prototype.toJSON=function(){return{type:"MultiPoint",coordinates:this.points.map(function(t){return t.toJSON().coordinates})}},e.validate=function(t){var r,n;if(t.type!=="MultiPoint"||!z(t.coordinates))return!1;try{for(var i=na(t.coordinates),o=i.next();!o.done;o=i.next()){var a=o.value;if(!Se(a[0])||!Se(a[1]))return!1}}catch(l){r={error:l}}finally{try{o&&!o.done&&(n=i.return)&&n.call(i)}finally{if(r)throw r.error}}return!0},Object.defineProperty(e.prototype,"_internalType",{get:function(){return Zs},enumerable:!0,configurable:!0}),e}(),Kn=function(e){var t=typeof Symbol=="function"&&Symbol.iterator,r=t&&e[t],n=0;if(r)return r.call(e);if(e&&typeof e.length=="number")return{next:function(){return e&&n>=e.length&&(e=void 0),{value:e&&e[n++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")},cr=function(){function e(t){if(!z(t))throw new TypeError('"lines" must be of type LineString[]. Received type '+typeof t);if(t.length===0)throw new Error("Polygon must contain 1 linestring at least");t.forEach(function(r){if(!(r instanceof Le))throw new TypeError('"lines" must be of type LineString[]. Received type '+typeof r+"[]")}),this.lines=t}return e.prototype.parse=function(t){var r;return r={},r[t]={type:"MultiLineString",coordinates:this.lines.map(function(n){return n.points.map(function(i){return[i.longitude,i.latitude]})})},r},e.prototype.toJSON=function(){return{type:"MultiLineString",coordinates:this.lines.map(function(t){return t.points.map(function(r){return[r.longitude,r.latitude]})})}},e.validate=function(t){var r,n,i,o;if(t.type!=="MultiLineString"||!z(t.coordinates))return!1;try{for(var a=Kn(t.coordinates),l=a.next();!l.done;l=a.next()){var p=l.value;try{for(var c=(i=void 0,Kn(p)),g=c.next();!g.done;g=c.next()){var m=g.value;if(!Se(m[0])||!Se(m[1]))return!1}}catch(_){i={error:_}}finally{try{g&&!g.done&&(o=c.return)&&o.call(c)}finally{if(i)throw i.error}}}}catch(_){r={error:_}}finally{try{l&&!l.done&&(n=a.return)&&n.call(a)}finally{if(r)throw r.error}}return!0},Object.defineProperty(e.prototype,"_internalType",{get:function(){return zs},enumerable:!0,configurable:!0}),e}(),nr=function(e){var t=typeof Symbol=="function"&&Symbol.iterator,r=t&&e[t],n=0;if(r)return r.call(e);if(e&&typeof e.length=="number")return{next:function(){return e&&n>=e.length&&(e=void 0),{value:e&&e[n++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")},Ut=function(){function e(t){var r,n;if(!z(t))throw new TypeError('"polygons" must be of type Polygon[]. Received type '+typeof t);if(t.length===0)throw new Error("MultiPolygon must contain 1 polygon at least");try{for(var i=nr(t),o=i.next();!o.done;o=i.next()){var a=o.value;if(!(a instanceof at))throw new TypeError('"polygon" must be of type Polygon[]. Received type '+typeof a+"[]")}}catch(l){r={error:l}}finally{try{o&&!o.done&&(n=i.return)&&n.call(i)}finally{if(r)throw r.error}}this.polygons=t}return e.prototype.parse=function(t){var r;return r={},r[t]={type:"MultiPolygon",coordinates:this.polygons.map(function(n){return n.lines.map(function(i){return i.points.map(function(o){return[o.longitude,o.latitude]})})})},r},e.prototype.toJSON=function(){return{type:"MultiPolygon",coordinates:this.polygons.map(function(t){return t.lines.map(function(r){return r.points.map(function(n){return[n.longitude,n.latitude]})})})}},e.validate=function(t){var r,n,i,o,a,l;if(t.type!=="MultiPolygon"||!z(t.coordinates))return!1;try{for(var p=nr(t.coordinates),c=p.next();!c.done;c=p.next()){var g=c.value;try{for(var m=(i=void 0,nr(g)),_=m.next();!_.done;_=m.next()){var I=_.value;try{for(var T=(a=void 0,nr(I)),N=T.next();!N.done;N=T.next()){var D=N.value;if(!Se(D[0])||!Se(D[1]))return!1}}catch(x){a={error:x}}finally{try{N&&!N.done&&(l=T.return)&&l.call(T)}finally{if(a)throw a.error}}}}catch(x){i={error:x}}finally{try{_&&!_.done&&(o=m.return)&&o.call(m)}finally{if(i)throw i.error}}}}catch(x){r={error:x}}finally{try{c&&!c.done&&(n=p.return)&&n.call(p)}finally{if(r)throw r.error}}return!0},Object.defineProperty(e.prototype,"_internalType",{get:function(){return Xs},enumerable:!0,configurable:!0}),e}();const ia=Object.freeze(Object.defineProperty({__proto__:null,LineString:Le,MultiLineString:cr,MultiPoint:ur,MultiPolygon:Ut,Point:le,Polygon:at},Symbol.toStringTag,{value:"Module"}));var We=function(){var e;if(!Promise){e=function(){},e.promise={};var t=function(){throw new Error('Your Node runtime does support ES6 Promises. Set "global.Promise" to your preferred implementation of promises.')};return Object.defineProperty(e.promise,"then",{get:t}),Object.defineProperty(e.promise,"catch",{get:t}),e}var r=new Promise(function(n,i){e=function(o,a){return o?i(o):n(a)}});return e.promise=r,e},M;(function(e){e.SET="set",e.REMOVE="remove",e.INC="inc",e.MUL="mul",e.PUSH="push",e.PULL="pull",e.PULL_ALL="pullAll",e.POP="pop",e.SHIFT="shift",e.UNSHIFT="unshift",e.ADD_TO_SET="addToSet",e.BIT="bit",e.RENAME="rename",e.MAX="max",e.MIN="min"})(M||(M={}));var Q=function(){function e(t,r,n){this._internalType=Ci,Object.defineProperties(this,{_internalType:{enumerable:!1,configurable:!1}}),this.operator=t,this.operands=r,this.fieldName=n||Ft}return e.prototype._setFieldName=function(t){var r=new e(this.operator,this.operands,t);return r},e}();function Yn(e){return e&&e instanceof Q&&e._internalType===Ci}var de;(function(e){e.AND="and",e.OR="or",e.NOT="not",e.NOR="nor"})(de||(de={}));var st=function(){function e(t,r,n){if(this._internalType=Li,Object.defineProperties(this,{_internalType:{enumerable:!1,configurable:!1}}),this.operator=t,this.operands=r,this.fieldName=n||Ft,this.fieldName!==Ft)if(Array.isArray(r)){r=r.slice(),this.operands=r;for(var i=0,o=r.length;i<o;i++){var a=r[i];(fr(a)||hr(a))&&(r[i]=a._setFieldName(this.fieldName))}}else{var a=r;(fr(a)||hr(a))&&(r=a._setFieldName(this.fieldName))}}return e.prototype._setFieldName=function(t){var r=this.operands.map(function(i){return i instanceof e?i._setFieldName(t):i}),n=new e(this.operator,r,t);return n},e.prototype.and=function(){var t=Array.isArray(arguments[0])?arguments[0]:Array.from(arguments);return t.unshift(this),new e(de.AND,t,this.fieldName)},e.prototype.or=function(){var t=Array.isArray(arguments[0])?arguments[0]:Array.from(arguments);return t.unshift(this),new e(de.OR,t,this.fieldName)},e}();function fr(e){return e&&e instanceof st&&e._internalType===Li}var oa=function(){var e=function(t,r){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,i){n.__proto__=i}||function(n,i){for(var o in i)i.hasOwnProperty(o)&&(n[o]=i[o])},e(t,r)};return function(t,r){e(t,r);function n(){this.constructor=t}t.prototype=r===null?Object.create(r):(n.prototype=r.prototype,new n)}}(),L;(function(e){e.EQ="eq",e.NEQ="neq",e.GT="gt",e.GTE="gte",e.LT="lt",e.LTE="lte",e.IN="in",e.NIN="nin",e.ALL="all",e.ELEM_MATCH="elemMatch",e.EXISTS="exists",e.SIZE="size",e.MOD="mod",e.GEO_NEAR="geoNear",e.GEO_WITHIN="geoWithin",e.GEO_INTERSECTS="geoIntersects"})(L||(L={}));var ee=function(e){oa(t,e);function t(r,n,i){var o=e.call(this,r,n,i)||this;return o.operator=r,o._internalType=Di,o}return t.prototype.toJSON=function(){var r,n;switch(this.operator){case L.IN:case L.NIN:return r={},r["$"+this.operator]=this.operands,r;default:return n={},n["$"+this.operator]=this.operands[0],n}},t.prototype._setFieldName=function(r){var n=new t(this.operator,this.operands,r);return n},t.prototype.eq=function(r){var n=new t(L.EQ,[r],this.fieldName);return this.and(n)},t.prototype.neq=function(r){var n=new t(L.NEQ,[r],this.fieldName);return this.and(n)},t.prototype.gt=function(r){var n=new t(L.GT,[r],this.fieldName);return this.and(n)},t.prototype.gte=function(r){var n=new t(L.GTE,[r],this.fieldName);return this.and(n)},t.prototype.lt=function(r){var n=new t(L.LT,[r],this.fieldName);return this.and(n)},t.prototype.lte=function(r){var n=new t(L.LTE,[r],this.fieldName);return this.and(n)},t.prototype.in=function(r){var n=new t(L.IN,r,this.fieldName);return this.and(n)},t.prototype.nin=function(r){var n=new t(L.NIN,r,this.fieldName);return this.and(n)},t.prototype.geoNear=function(r){if(!(r.geometry instanceof le))throw new TypeError('"geometry" must be of type Point. Received type '+typeof r.geometry);if(r.maxDistance!==void 0&&!Se(r.maxDistance))throw new TypeError('"maxDistance" must be of type Number. Received type '+typeof r.maxDistance);if(r.minDistance!==void 0&&!Se(r.minDistance))throw new TypeError('"minDistance" must be of type Number. Received type '+typeof r.minDistance);var n=new t(L.GEO_NEAR,[r],this.fieldName);return this.and(n)},t.prototype.geoWithin=function(r){if(!(r.geometry instanceof Ut)&&!(r.geometry instanceof at))throw new TypeError('"geometry" must be of type Polygon or MultiPolygon. Received type '+typeof r.geometry);var n=new t(L.GEO_WITHIN,[r],this.fieldName);return this.and(n)},t.prototype.geoIntersects=function(r){if(!(r.geometry instanceof le)&&!(r.geometry instanceof Le)&&!(r.geometry instanceof at)&&!(r.geometry instanceof ur)&&!(r.geometry instanceof cr)&&!(r.geometry instanceof Ut))throw new TypeError('"geometry" must be of type Point, LineString, Polygon, MultiPoint, MultiLineString or MultiPolygon. Received type '+typeof r.geometry);var n=new t(L.GEO_INTERSECTS,[r],this.fieldName);return this.and(n)},t}(st);function hr(e){return e&&e instanceof ee&&e._internalType===Di}function Xn(e){return hr(e)}var Ke={};for(var Je in L)Ke[Je]="$"+Je;for(var Je in de)Ke[Je]="$"+Je;for(var Je in M)Ke[Je]="$"+Je;Ke[L.NEQ]="$ne";Ke[M.REMOVE]="$unset";Ke[M.SHIFT]="$pop";Ke[M.UNSHIFT]="$push";function bt(e){return Ke[e]||"$"+e}var an=function(){return an=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++){t=arguments[r];for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i])}return e},an.apply(this,arguments)},sa=function(e,t){var r=typeof Symbol=="function"&&e[Symbol.iterator];if(!r)return e;var n=r.call(e),i,o=[],a;try{for(;(t===void 0||t-- >0)&&!(i=n.next()).done;)o.push(i.value)}catch(l){a={error:l}}finally{try{i&&!i.done&&(r=n.return)&&r.call(n)}finally{if(a)throw a.error}}return o},Zn=function(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(sa(arguments[t]));return e};function jt(e){return un(e,[e])}function un(e,t){if(Ui(e))switch(e._internalType){case Bi:return e.toJSON();case Pi:return e.parse();case $i:return e.parse();default:return e.toJSON?e.toJSON():e}else{if(Fi(e))return{$date:+e};if(mn(e))return{$regex:e.source,$options:e.flags};if(z(e))return e.map(function(i){if(t.indexOf(i)>-1)throw new Error("Cannot convert circular structure to JSON");return un(i,Zn(t,[i]))});if(ke(e)){var r=an({},e);for(var n in r){if(t.indexOf(r[n])>-1)throw new Error("Cannot convert circular structure to JSON");r[n]=un(r[n],Zn(t,[r[n]]))}return r}else return e}}var cn=function(){return cn=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++){t=arguments[r];for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i])}return e},cn.apply(this,arguments)},aa=function(e,t){var r=typeof Symbol=="function"&&e[Symbol.iterator];if(!r)return e;var n=r.call(e),i,o=[],a;try{for(;(t===void 0||t-- >0)&&!(i=n.next()).done;)o.push(i.value)}catch(l){a={error:l}}finally{try{i&&!i.done&&(r=n.return)&&r.call(n)}finally{if(a)throw a.error}}return o},zn=function(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(aa(arguments[t]));return e};function ji(e,t,r,n){var i=cn({},e);for(var o in e)if(!/^\$/.test(o)){var a=e[o];if(a&&ke(a)&&!t(a)){if(n.indexOf(a)>-1)throw new Error("Cannot convert circular structure to JSON");var l=zn(r,[o]),p=zn(n,[a]),c=ji(a,t,l,p);i[o]=c;var g=!1;for(var m in c)/^\$/.test(m)?g=!0:(i[o+"."+m]=c[m],delete i[o][m]);g||delete i[o]}}return i}function Wi(e){return ji(e,fn,[],[e])}function Qn(e,t,r){t[r]||delete e[r];for(var n in t)e[n]?z(e[n])?e[n].push(t[n]):ke(e[n])?ke(t[n])?Object.assign(e[n],t[n]):(console.warn("unmergable condition, query is object but condition is "+$e(t)+", can only overwrite",t,r),e[n]=t[n]):(console.warn("to-merge query is of type "+$e(e)+", can only overwrite",e,t,r),e[n]=t[n]):e[n]=t[n]}function fn(e){return Ui(e)||Fi(e)||mn(e)}function Ve(e){return jt(e)}var yn=function(){function e(){}return e.encode=function(t){var r=new e;return r.encodeUpdate(t)},e.prototype.encodeUpdate=function(t){return Yn(t)?this.encodeUpdateCommand(t):$e(t)==="object"?this.encodeUpdateObject(t):t},e.prototype.encodeUpdateCommand=function(t){if(t.fieldName===Ft)throw new Error("Cannot encode a comparison command with unset field name");switch(t.operator){case M.PUSH:case M.PULL:case M.PULL_ALL:case M.POP:case M.SHIFT:case M.UNSHIFT:case M.ADD_TO_SET:return this.encodeArrayUpdateCommand(t);default:return this.encodeFieldUpdateCommand(t)}},e.prototype.encodeFieldUpdateCommand=function(t){var r,n,i,o,a=bt(t.operator);switch(t.operator){case M.REMOVE:return r={},r[a]=(n={},n[t.fieldName]="",n),r;default:return i={},i[a]=(o={},o[t.fieldName]=t.operands[0],o),i}},e.prototype.encodeArrayUpdateCommand=function(t){var r,n,i,o,a,l,p,c,g,m,_=bt(t.operator);switch(t.operator){case M.PUSH:{var I=void 0;return z(t.operands)?I={$each:t.operands.map(Ve)}:I=t.operands,r={},r[_]=(n={},n[t.fieldName]=I,n),r}case M.UNSHIFT:{var I={$each:t.operands.map(Ve),$position:0};return i={},i[_]=(o={},o[t.fieldName]=I,o),i}case M.POP:return a={},a[_]=(l={},l[t.fieldName]=1,l),a;case M.SHIFT:return p={},p[_]=(c={},c[t.fieldName]=-1,c),p;default:return g={},g[_]=(m={},m[t.fieldName]=Ve(t.operands),m),g}},e.prototype.encodeUpdateObject=function(t){var r=Wi(t);for(var n in r)if(!/^\$/.test(n)){var i=r[n];if(Yn(i)){r[n]=i._setFieldName(n);var o=this.encodeUpdateCommand(r[n]);Qn(r,o,n)}else{r[n]=i=Ve(i);var a=new Q(M.SET,[i],n),o=this.encodeUpdateCommand(a);Qn(r,o,n)}}return r},e}(),Kr={};function Gi(e){if(!ne.wsClientClass)throw new Error("to use realtime you must import realtime module first");var t=e.config.env;return Kr[t]||(Kr[t]=new ne.wsClientClass({context:{appConfig:{docSizeLimit:1e3,realtimePingInterval:1e4,realtimePongWaitTimeout:5e3,request:new ne.reqClass(e.config)}}})),Kr[t]}var lr=function(){return lr=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++){t=arguments[r];for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i])}return e},lr.apply(this,arguments)},ei=function(){function e(t,r,n,i){var o=this;i===void 0&&(i={}),this.watch=function(a){var l=Gi(o._db);return l.watch(lr(lr({},a),{envId:o._db.config.env,collectionName:o._coll,query:JSON.stringify({_id:o.id})}))},this._db=t,this._coll=r,this.id=n,this.request=new ne.reqClass(this._db.config),this.projection=i}return e.prototype.create=function(t,r){r=r||We();var n={collectionName:this._coll,data:jt(t)};return this.id&&(n._id=this.id),this.request.send("database.addDocument",n).then(function(i){i.code?r(0,i):r(0,{id:i.data._id,requestId:i.requestId})}).catch(function(i){r(i)}),r.promise},e.prototype.set=function(t,r){if(r=r||We(),!this.id)return Promise.resolve({code:"INVALID_PARAM",message:"docId不能为空"});if(!t||typeof t!="object")return Promise.resolve({code:"INVALID_PARAM",message:"参数必需是非空对象"});if(t.hasOwnProperty("_id"))return Promise.resolve({code:"INVALID_PARAM",message:"不能更新_id的值"});var n=!1,i=function(l){if(typeof l=="object")for(var p in l)l[p]instanceof Q?n=!0:typeof l[p]=="object"&&i(l[p])};if(i(t),n)return Promise.resolve({code:"DATABASE_REQUEST_FAILED",message:"update operator complicit"});var o=!1,a={collectionName:this._coll,queryType:Pe.DOC,data:jt(t),multi:!1,merge:o,upsert:!0};return this.id&&(a.query={_id:this.id}),this.request.send("database.updateDocument",a).then(function(l){l.code?r(0,l):r(0,{updated:l.data.updated,upsertedId:l.data.upserted_id,requestId:l.requestId})}).catch(function(l){r(l)}),r.promise},e.prototype.update=function(t,r){if(r=r||We(),!t||typeof t!="object")return Promise.resolve({code:"INVALID_PARAM",message:"参数必需是非空对象"});if(t.hasOwnProperty("_id"))return Promise.resolve({code:"INVALID_PARAM",message:"不能更新_id的值"});var n={_id:this.id},i=!0,o={collectionName:this._coll,data:yn.encode(t),query:n,queryType:Pe.DOC,multi:!1,merge:i,upsert:!1};return this.request.send("database.updateDocument",o).then(function(a){a.code?r(0,a):r(0,{updated:a.data.updated,upsertedId:a.data.upserted_id,requestId:a.requestId})}).catch(function(a){r(a)}),r.promise},e.prototype.remove=function(t){t=t||We();var r={_id:this.id},n={collectionName:this._coll,query:r,queryType:Pe.DOC,multi:!1};return this.request.send("database.deleteDocument",n).then(function(i){i.code?t(0,i):t(0,{deleted:i.data.deleted,requestId:i.requestId})}).catch(function(i){t(i)}),t.promise},e.prototype.get=function(t){t=t||We();var r={_id:this.id},n={collectionName:this._coll,query:r,queryType:Pe.DOC,multi:!1,projection:this.projection};return this.request.send("database.queryDocument",n).then(function(i){if(i.code)t(0,i);else{var o=wr.formatResDocumentData(i.data.list);t(0,{data:o,requestId:i.requestId,total:i.TotalCount,limit:i.Limit,offset:i.Offset})}}).catch(function(i){t(i)}),t.promise},e.prototype.field=function(t){for(var r in t)t[r]?t[r]=1:t[r]=0;return new e(this._db,this._coll,this.id,t)},e}(),hn=function(){function e(){}return e.encode=function(t){var r=new ua;return r.encodeQuery(t)},e}(),ua=function(){function e(){}return e.prototype.encodeQuery=function(t,r){var n;return fn(t)?fr(t)?this.encodeLogicCommand(t):hr(t)?this.encodeQueryCommand(t):(n={},n[r]=this.encodeQueryObject(t),n):ke(t)?this.encodeQueryObject(t):t},e.prototype.encodeRegExp=function(t){return{$regex:t.source,$options:t.flags}},e.prototype.encodeLogicCommand=function(t){var r,n,i,o,a,l,p,c=this;switch(t.operator){case de.NOR:case de.AND:case de.OR:{var g=bt(t.operator),m=t.operands.map(function(T){return c.encodeQuery(T,t.fieldName)});return r={},r[g]=m,r}case de.NOT:{var g=bt(t.operator),_=t.operands[0];if(mn(_))return n={},n[t.fieldName]=(i={},i[g]=this.encodeRegExp(_),i),n;var m=this.encodeQuery(_)[t.fieldName];return o={},o[t.fieldName]=(a={},a[g]=m,a),o}default:{var g=bt(t.operator);if(t.operands.length===1){var I=this.encodeQuery(t.operands[0]);return l={},l[g]=I,l}else{var m=t.operands.map(this.encodeQuery.bind(this));return p={},p[g]=m,p}}}},e.prototype.encodeQueryCommand=function(t){return Xn(t)?this.encodeComparisonCommand(t):this.encodeComparisonCommand(t)},e.prototype.encodeComparisonCommand=function(t){var r,n,i,o,a,l,p,c,g;if(t.fieldName===Ft)throw new Error("Cannot encode a comparison command with unset field name");var m=bt(t.operator);switch(t.operator){case L.EQ:case L.NEQ:case L.LT:case L.LTE:case L.GT:case L.GTE:case L.ELEM_MATCH:case L.EXISTS:case L.SIZE:case L.MOD:return r={},r[t.fieldName]=(n={},n[m]=Ve(t.operands[0]),n),r;case L.IN:case L.NIN:case L.ALL:return i={},i[t.fieldName]=(o={},o[m]=Ve(t.operands),o),i;case L.GEO_NEAR:{var _=t.operands[0];return a={},a[t.fieldName]={$nearSphere:{$geometry:_.geometry.toJSON(),$maxDistance:_.maxDistance,$minDistance:_.minDistance}},a}case L.GEO_WITHIN:{var _=t.operands[0];return l={},l[t.fieldName]={$geoWithin:{$geometry:_.geometry.toJSON()}},l}case L.GEO_INTERSECTS:{var _=t.operands[0];return p={},p[t.fieldName]={$geoIntersects:{$geometry:_.geometry.toJSON()}},p}default:return c={},c[t.fieldName]=(g={},g[m]=Ve(t.operands[0]),g),c}},e.prototype.encodeQueryObject=function(t){var r=Wi(t);for(var n in r){var i=r[n];if(fr(i)){r[n]=i._setFieldName(n);var o=this.encodeLogicCommand(r[n]);this.mergeConditionAfterEncode(r,o,n)}else if(Xn(i)){r[n]=i._setFieldName(n);var o=this.encodeComparisonCommand(r[n]);this.mergeConditionAfterEncode(r,o,n)}else fn(i)&&(r[n]=Ve(i))}return r},e.prototype.mergeConditionAfterEncode=function(t,r,n){r[n]||delete t[n];for(var i in r)t[i]?z(t[i])?t[i]=t[i].concat(r[i]):ke(t[i])?ke(r[i])?Object.assign(t,r):(console.warn("unmergable condition, query is object but condition is "+$e(r)+", can only overwrite",r,n),t[i]=r[i]):(console.warn("to-merge query is of type "+$e(t)+", can only overwrite",t,r,n),t[i]=r[i]):t[i]=r[i]},e}(),ot=function(){return ot=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++){t=arguments[r];for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i])}return e},ot.apply(this,arguments)},ca=function(){function e(t,r,n,i,o){var a=this;this.watch=function(l){var p=Gi(a._db);return p.watch(ot(ot({},l),{envId:a._db.config.env,collectionName:a._coll,query:JSON.stringify(a._fieldFilters||{}),limit:a._queryOptions.limit,orderBy:a._fieldOrders?a._fieldOrders.reduce(function(c,g){return c[g.field]=g.direction,c},{}):void 0}))},this._db=t,this._coll=r,this._fieldFilters=n,this._fieldOrders=i||[],this._queryOptions=o||{},this._request=new ne.reqClass(this._db.config)}return e.prototype.get=function(t){t=t||We();var r=[];this._fieldOrders&&this._fieldOrders.forEach(function(i){r.push(i)});var n={collectionName:this._coll,queryType:Pe.WHERE};return this._fieldFilters&&(n.query=this._fieldFilters),r.length>0&&(n.order=r),this._queryOptions.offset&&(n.offset=this._queryOptions.offset),this._queryOptions.limit?n.limit=this._queryOptions.limit<1e3?this._queryOptions.limit:1e3:n.limit=100,this._queryOptions.projection&&(n.projection=this._queryOptions.projection),this._request.send("database.queryDocument",n).then(function(i){if(i.code)t(0,i);else{var o=wr.formatResDocumentData(i.data.list),a={data:o,requestId:i.requestId};i.TotalCount&&(a.total=i.TotalCount),i.Limit&&(a.limit=i.Limit),i.Offset&&(a.offset=i.Offset),t(0,a)}}).catch(function(i){t(i)}),t.promise},e.prototype.count=function(t){t=t||We();var r={collectionName:this._coll,queryType:Pe.WHERE};return this._fieldFilters&&(r.query=this._fieldFilters),this._request.send("database.countDocument",r).then(function(n){n.code?t(0,n):t(0,{requestId:n.requestId,total:n.data.total})}).catch(function(n){t(n)}),t.promise},e.prototype.where=function(t){if(Object.prototype.toString.call(t).slice(8,-1)!=="Object")throw Error(je.QueryParamTypeError);var r=Object.keys(t),n=r.some(function(i){return t[i]!==void 0});if(r.length&&!n)throw Error(je.QueryParamValueError);return new e(this._db,this._coll,hn.encode(t),this._fieldOrders,this._queryOptions)},e.prototype.orderBy=function(t,r){qe.isFieldPath(t),qe.isFieldOrder(r);var n={field:t,direction:r},i=this._fieldOrders.concat(n);return new e(this._db,this._coll,this._fieldFilters,i,this._queryOptions)},e.prototype.limit=function(t){qe.isInteger("limit",t);var r=ot({},this._queryOptions);return r.limit=t,new e(this._db,this._coll,this._fieldFilters,this._fieldOrders,r)},e.prototype.skip=function(t){qe.isInteger("offset",t);var r=ot({},this._queryOptions);return r.offset=t,new e(this._db,this._coll,this._fieldFilters,this._fieldOrders,r)},e.prototype.update=function(t,r){if(r=r||We(),!t||typeof t!="object")return Promise.resolve({code:"INVALID_PARAM",message:"参数必需是非空对象"});if(t.hasOwnProperty("_id"))return Promise.resolve({code:"INVALID_PARAM",message:"不能更新_id的值"});var n={collectionName:this._coll,query:this._fieldFilters,queryType:Pe.WHERE,multi:!0,merge:!0,upsert:!1,data:yn.encode(t)};return this._request.send("database.updateDocument",n).then(function(i){i.code?r(0,i):r(0,{requestId:i.requestId,updated:i.data.updated,upsertId:i.data.upsert_id})}).catch(function(i){r(i)}),r.promise},e.prototype.field=function(t){for(var r in t)t[r]?typeof t[r]!="object"&&(t[r]=1):t[r]=0;var n=ot({},this._queryOptions);return n.projection=t,new e(this._db,this._coll,this._fieldFilters,this._fieldOrders,n)},e.prototype.remove=function(t){t=t||We(),Object.keys(this._queryOptions).length>0&&console.warn("`offset`, `limit` and `projection` are not supported in remove() operation"),this._fieldOrders.length>0&&console.warn("`orderBy` is not supported in remove() operation");var r={collectionName:this._coll,query:hn.encode(this._fieldFilters),queryType:Pe.WHERE,multi:!0};return this._request.send("database.deleteDocument",r).then(function(n){n.code?t(0,n):t(0,{requestId:n.requestId,deleted:n.data.deleted})}).catch(function(n){t(n)}),t.promise},e}();function fa(e,t){return t={exports:{}},e(t,t.exports),t.exports}var ha=ma,la=wa,da=ba,Be=[],ve=[],pa=typeof Uint8Array<"u"?Uint8Array:Array,Yr="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";for(var wt=0,ga=Yr.length;wt<ga;++wt)Be[wt]=Yr[wt],ve[Yr.charCodeAt(wt)]=wt;ve[45]=62;ve[95]=63;function Hi(e){var t=e.length;if(t%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var r=e.indexOf("=");r===-1&&(r=t);var n=r===t?0:4-r%4;return[r,n]}function ma(e){var t=Hi(e),r=t[0],n=t[1];return(r+n)*3/4-n}function ya(e,t,r){return(t+r)*3/4-r}function wa(e){var t,r=Hi(e),n=r[0],i=r[1],o=new pa(ya(e,n,i)),a=0,l=i>0?n-4:n,p;for(p=0;p<l;p+=4)t=ve[e.charCodeAt(p)]<<18|ve[e.charCodeAt(p+1)]<<12|ve[e.charCodeAt(p+2)]<<6|ve[e.charCodeAt(p+3)],o[a++]=t>>16&255,o[a++]=t>>8&255,o[a++]=t&255;return i===2&&(t=ve[e.charCodeAt(p)]<<2|ve[e.charCodeAt(p+1)]>>4,o[a++]=t&255),i===1&&(t=ve[e.charCodeAt(p)]<<10|ve[e.charCodeAt(p+1)]<<4|ve[e.charCodeAt(p+2)]>>2,o[a++]=t>>8&255,o[a++]=t&255),o}function _a(e){return Be[e>>18&63]+Be[e>>12&63]+Be[e>>6&63]+Be[e&63]}function va(e,t,r){for(var n,i=[],o=t;o<r;o+=3)n=(e[o]<<16&16711680)+(e[o+1]<<8&65280)+(e[o+2]&255),i.push(_a(n));return i.join("")}function ba(e){for(var t,r=e.length,n=r%3,i=[],o=16383,a=0,l=r-n;a<l;a+=o)i.push(va(e,a,a+o>l?l:a+o));return n===1?(t=e[r-1],i.push(Be[t>>2]+Be[t<<4&63]+"==")):n===2&&(t=(e[r-2]<<8)+e[r-1],i.push(Be[t>>10]+Be[t>>4&63]+Be[t<<2&63]+"=")),i.join("")}var Xr={byteLength:ha,toByteArray:la,fromByteArray:da};/*! ieee754. BSD-3-Clause License. Feross Aboukhadijeh <https://feross.org/opensource> */var Ea=function(t,r,n,i,o){var a,l,p=o*8-i-1,c=(1<<p)-1,g=c>>1,m=-7,_=n?o-1:0,I=n?-1:1,T=t[r+_];for(_+=I,a=T&(1<<-m)-1,T>>=-m,m+=p;m>0;a=a*256+t[r+_],_+=I,m-=8);for(l=a&(1<<-m)-1,a>>=-m,m+=i;m>0;l=l*256+t[r+_],_+=I,m-=8);if(a===0)a=1-g;else{if(a===c)return l?NaN:(T?-1:1)*(1/0);l=l+Math.pow(2,i),a=a-g}return(T?-1:1)*l*Math.pow(2,a-i)},Sa=function(t,r,n,i,o,a){var l,p,c,g=a*8-o-1,m=(1<<g)-1,_=m>>1,I=o===23?Math.pow(2,-24)-Math.pow(2,-77):0,T=i?0:a-1,N=i?1:-1,D=r<0||r===0&&1/r<0?1:0;for(r=Math.abs(r),isNaN(r)||r===1/0?(p=isNaN(r)?1:0,l=m):(l=Math.floor(Math.log(r)/Math.LN2),r*(c=Math.pow(2,-l))<1&&(l--,c*=2),l+_>=1?r+=I/c:r+=I*Math.pow(2,1-_),r*c>=2&&(l++,c/=2),l+_>=m?(p=0,l=m):l+_>=1?(p=(r*c-1)*Math.pow(2,o),l=l+_):(p=r*Math.pow(2,_-1)*Math.pow(2,o),l=0));o>=8;t[n+T]=p&255,T+=N,p/=256,o-=8);for(l=l<<o|p,g+=o;g>0;t[n+T]=l&255,T+=N,l/=256,g-=8);t[n+T-N]|=D*128},_t={read:Ea,write:Sa},_r=fa(function(e,t){var r=typeof Symbol=="function"&&typeof Symbol.for=="function"?Symbol.for("nodejs.util.inspect.custom"):null;t.Buffer=a,t.SlowBuffer=x,t.INSPECT_MAX_BYTES=50;var n=2147483647;t.kMaxLength=n,a.TYPED_ARRAY_SUPPORT=i(),!a.TYPED_ARRAY_SUPPORT&&typeof console<"u"&&typeof console.error=="function"&&console.error("This browser lacks typed array (Uint8Array) support which is required by `buffer` v5.x. Use `buffer` v4.x if you require old browser support.");function i(){try{var h=new Uint8Array(1),s={foo:function(){return 42}};return Object.setPrototypeOf(s,Uint8Array.prototype),Object.setPrototypeOf(h,s),h.foo()===42}catch{return!1}}Object.defineProperty(a.prototype,"parent",{enumerable:!0,get:function(){if(a.isBuffer(this))return this.buffer}}),Object.defineProperty(a.prototype,"offset",{enumerable:!0,get:function(){if(a.isBuffer(this))return this.byteOffset}});function o(h){if(h>n)throw new RangeError('The value "'+h+'" is invalid for option "size"');var s=new Uint8Array(h);return Object.setPrototypeOf(s,a.prototype),s}function a(h,s,u){if(typeof h=="number"){if(typeof s=="string")throw new TypeError('The "string" argument must be of type string. Received type number');return g(h)}return l(h,s,u)}a.poolSize=8192;function l(h,s,u){if(typeof h=="string")return m(h,s);if(ArrayBuffer.isView(h))return I(h);if(h==null)throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+babelHelpers.typeof(h));if(ye(h,ArrayBuffer)||h&&ye(h.buffer,ArrayBuffer)||typeof SharedArrayBuffer<"u"&&(ye(h,SharedArrayBuffer)||h&&ye(h.buffer,SharedArrayBuffer)))return T(h,s,u);if(typeof h=="number")throw new TypeError('The "value" argument must not be of type number. Received type number');var d=h.valueOf&&h.valueOf();if(d!=null&&d!==h)return a.from(d,s,u);var y=N(h);if(y)return y;if(typeof Symbol<"u"&&Symbol.toPrimitive!=null&&typeof h[Symbol.toPrimitive]=="function")return a.from(h[Symbol.toPrimitive]("string"),s,u);throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+babelHelpers.typeof(h))}a.from=function(h,s,u){return l(h,s,u)},Object.setPrototypeOf(a.prototype,Uint8Array.prototype),Object.setPrototypeOf(a,Uint8Array);function p(h){if(typeof h!="number")throw new TypeError('"size" argument must be of type number');if(h<0)throw new RangeError('The value "'+h+'" is invalid for option "size"')}function c(h,s,u){return p(h),h<=0?o(h):s!==void 0?typeof u=="string"?o(h).fill(s,u):o(h).fill(s):o(h)}a.alloc=function(h,s,u){return c(h,s,u)};function g(h){return p(h),o(h<0?0:D(h)|0)}a.allocUnsafe=function(h){return g(h)},a.allocUnsafeSlow=function(h){return g(h)};function m(h,s){if((typeof s!="string"||s==="")&&(s="utf8"),!a.isEncoding(s))throw new TypeError("Unknown encoding: "+s);var u=P(h,s)|0,d=o(u),y=d.write(h,s);return y!==u&&(d=d.slice(0,y)),d}function _(h){for(var s=h.length<0?0:D(h.length)|0,u=o(s),d=0;d<s;d+=1)u[d]=h[d]&255;return u}function I(h){if(ye(h,Uint8Array)){var s=new Uint8Array(h);return T(s.buffer,s.byteOffset,s.byteLength)}return _(h)}function T(h,s,u){if(s<0||h.byteLength<s)throw new RangeError('"offset" is outside of buffer bounds');if(h.byteLength<s+(u||0))throw new RangeError('"length" is outside of buffer bounds');var d;return s===void 0&&u===void 0?d=new Uint8Array(h):u===void 0?d=new Uint8Array(h,s):d=new Uint8Array(h,s,u),Object.setPrototypeOf(d,a.prototype),d}function N(h){if(a.isBuffer(h)){var s=D(h.length)|0,u=o(s);return u.length===0||h.copy(u,0,0,s),u}if(h.length!==void 0)return typeof h.length!="number"||Rt(h.length)?o(0):_(h);if(h.type==="Buffer"&&Array.isArray(h.data))return _(h.data)}function D(h){if(h>=n)throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+n.toString(16)+" bytes");return h|0}function x(h){return+h!=h&&(h=0),a.alloc(+h)}a.isBuffer=function(s){return s!=null&&s._isBuffer===!0&&s!==a.prototype},a.compare=function(s,u){if(ye(s,Uint8Array)&&(s=a.from(s,s.offset,s.byteLength)),ye(u,Uint8Array)&&(u=a.from(u,u.offset,u.byteLength)),!a.isBuffer(s)||!a.isBuffer(u))throw new TypeError('The "buf1", "buf2" arguments must be one of type Buffer or Uint8Array');if(s===u)return 0;for(var d=s.length,y=u.length,b=0,E=Math.min(d,y);b<E;++b)if(s[b]!==u[b]){d=s[b],y=u[b];break}return d<y?-1:y<d?1:0},a.isEncoding=function(s){switch(String(s).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},a.concat=function(s,u){if(!Array.isArray(s))throw new TypeError('"list" argument must be an Array of Buffers');if(s.length===0)return a.alloc(0);var d;if(u===void 0)for(u=0,d=0;d<s.length;++d)u+=s[d].length;var y=a.allocUnsafe(u),b=0;for(d=0;d<s.length;++d){var E=s[d];if(ye(E,Uint8Array))b+E.length>y.length?a.from(E).copy(y,b):Uint8Array.prototype.set.call(y,E,b);else if(a.isBuffer(E))E.copy(y,b);else throw new TypeError('"list" argument must be an Array of Buffers');b+=E.length}return y};function P(h,s){if(a.isBuffer(h))return h.length;if(ArrayBuffer.isView(h)||ye(h,ArrayBuffer))return h.byteLength;if(typeof h!="string")throw new TypeError('The "string" argument must be one of type string, Buffer, or ArrayBuffer. Received type '+babelHelpers.typeof(h));var u=h.length,d=arguments.length>2&&arguments[2]===!0;if(!d&&u===0)return 0;for(var y=!1;;)switch(s){case"ascii":case"latin1":case"binary":return u;case"utf8":case"utf-8":return At(h).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return u*2;case"hex":return u>>>1;case"base64":return Kt(h).length;default:if(y)return d?-1:At(h).length;s=(""+s).toLowerCase(),y=!0}}a.byteLength=P;function G(h,s,u){var d=!1;if((s===void 0||s<0)&&(s=0),s>this.length||((u===void 0||u>this.length)&&(u=this.length),u<=0)||(u>>>=0,s>>>=0,u<=s))return"";for(h||(h="utf8");;)switch(h){case"hex":return ce(this,s,u);case"utf8":case"utf-8":return X(this,s,u);case"ascii":return Ge(this,s,u);case"latin1":case"binary":return k(this,s,u);case"base64":return ge(this,s,u);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return F(this,s,u);default:if(d)throw new TypeError("Unknown encoding: "+h);h=(h+"").toLowerCase(),d=!0}}a.prototype._isBuffer=!0;function O(h,s,u){var d=h[s];h[s]=h[u],h[u]=d}a.prototype.swap16=function(){var s=this.length;if(s%2!==0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(var u=0;u<s;u+=2)O(this,u,u+1);return this},a.prototype.swap32=function(){var s=this.length;if(s%4!==0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(var u=0;u<s;u+=4)O(this,u,u+3),O(this,u+1,u+2);return this},a.prototype.swap64=function(){var s=this.length;if(s%8!==0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(var u=0;u<s;u+=8)O(this,u,u+7),O(this,u+1,u+6),O(this,u+2,u+5),O(this,u+3,u+4);return this},a.prototype.toString=function(){var s=this.length;return s===0?"":arguments.length===0?X(this,0,s):G.apply(this,arguments)},a.prototype.toLocaleString=a.prototype.toString,a.prototype.equals=function(s){if(!a.isBuffer(s))throw new TypeError("Argument must be a Buffer");return this===s?!0:a.compare(this,s)===0},a.prototype.inspect=function(){var s="",u=t.INSPECT_MAX_BYTES;return s=this.toString("hex",0,u).replace(/(.{2})/g,"$1 ").trim(),this.length>u&&(s+=" ... "),"<Buffer "+s+">"},r&&(a.prototype[r]=a.prototype.inspect),a.prototype.compare=function(s,u,d,y,b){if(ye(s,Uint8Array)&&(s=a.from(s,s.offset,s.byteLength)),!a.isBuffer(s))throw new TypeError('The "target" argument must be one of type Buffer or Uint8Array. Received type '+babelHelpers.typeof(s));if(u===void 0&&(u=0),d===void 0&&(d=s?s.length:0),y===void 0&&(y=0),b===void 0&&(b=this.length),u<0||d>s.length||y<0||b>this.length)throw new RangeError("out of range index");if(y>=b&&u>=d)return 0;if(y>=b)return-1;if(u>=d)return 1;if(u>>>=0,d>>>=0,y>>>=0,b>>>=0,this===s)return 0;for(var E=b-y,B=d-u,W=Math.min(E,B),U=this.slice(y,b),Z=s.slice(u,d),J=0;J<W;++J)if(U[J]!==Z[J]){E=U[J],B=Z[J];break}return E<B?-1:B<E?1:0};function q(h,s,u,d,y){if(h.length===0)return-1;if(typeof u=="string"?(d=u,u=0):u>2147483647?u=2147483647:u<-2147483648&&(u=-2147483648),u=+u,Rt(u)&&(u=y?0:h.length-1),u<0&&(u=h.length+u),u>=h.length){if(y)return-1;u=h.length-1}else if(u<0)if(y)u=0;else return-1;if(typeof s=="string"&&(s=a.from(s,d)),a.isBuffer(s))return s.length===0?-1:$(h,s,u,d,y);if(typeof s=="number")return s=s&255,typeof Uint8Array.prototype.indexOf=="function"?y?Uint8Array.prototype.indexOf.call(h,s,u):Uint8Array.prototype.lastIndexOf.call(h,s,u):$(h,[s],u,d,y);throw new TypeError("val must be string, number or Buffer")}function $(h,s,u,d,y){var b=1,E=h.length,B=s.length;if(d!==void 0&&(d=String(d).toLowerCase(),d==="ucs2"||d==="ucs-2"||d==="utf16le"||d==="utf-16le")){if(h.length<2||s.length<2)return-1;b=2,E/=2,B/=2,u/=2}function W(Ct,Dt){return b===1?Ct[Dt]:Ct.readUInt16BE(Dt*b)}var U;if(y){var Z=-1;for(U=u;U<E;U++)if(W(h,U)===W(s,Z===-1?0:U-Z)){if(Z===-1&&(Z=U),U-Z+1===B)return Z*b}else Z!==-1&&(U-=U-Z),Z=-1}else for(u+B>E&&(u=E-B),U=u;U>=0;U--){for(var J=!0,Ze=0;Ze<B;Ze++)if(W(h,U+Ze)!==W(s,Ze)){J=!1;break}if(J)return U}return-1}a.prototype.includes=function(s,u,d){return this.indexOf(s,u,d)!==-1},a.prototype.indexOf=function(s,u,d){return q(this,s,u,d,!0)},a.prototype.lastIndexOf=function(s,u,d){return q(this,s,u,d,!1)};function K(h,s,u,d){u=Number(u)||0;var y=h.length-u;d?(d=Number(d),d>y&&(d=y)):d=y;var b=s.length;d>b/2&&(d=b/2);for(var E=0;E<d;++E){var B=parseInt(s.substr(E*2,2),16);if(Rt(B))return E;h[u+E]=B}return E}function ie(h,s,u,d){return Xe(At(s,h.length-u),h,u,d)}function xe(h,s,u,d){return Xe(Lr(s),h,u,d)}function Me(h,s,u,d){return Xe(Kt(s),h,u,d)}function Re(h,s,u,d){return Xe(Br(s,h.length-u),h,u,d)}a.prototype.write=function(s,u,d,y){if(u===void 0)y="utf8",d=this.length,u=0;else if(d===void 0&&typeof u=="string")y=u,d=this.length,u=0;else if(isFinite(u))u=u>>>0,isFinite(d)?(d=d>>>0,y===void 0&&(y="utf8")):(y=d,d=void 0);else throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");var b=this.length-u;if((d===void 0||d>b)&&(d=b),s.length>0&&(d<0||u<0)||u>this.length)throw new RangeError("Attempt to write outside buffer bounds");y||(y="utf8");for(var E=!1;;)switch(y){case"hex":return K(this,s,u,d);case"utf8":case"utf-8":return ie(this,s,u,d);case"ascii":case"latin1":case"binary":return xe(this,s,u,d);case"base64":return Me(this,s,u,d);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return Re(this,s,u,d);default:if(E)throw new TypeError("Unknown encoding: "+y);y=(""+y).toLowerCase(),E=!0}},a.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};function ge(h,s,u){return s===0&&u===h.length?Xr.fromByteArray(h):Xr.fromByteArray(h.slice(s,u))}function X(h,s,u){u=Math.min(h.length,u);for(var d=[],y=s;y<u;){var b=h[y],E=null,B=b>239?4:b>223?3:b>191?2:1;if(y+B<=u){var W,U,Z,J;switch(B){case 1:b<128&&(E=b);break;case 2:W=h[y+1],(W&192)===128&&(J=(b&31)<<6|W&63,J>127&&(E=J));break;case 3:W=h[y+1],U=h[y+2],(W&192)===128&&(U&192)===128&&(J=(b&15)<<12|(W&63)<<6|U&63,J>2047&&(J<55296||J>57343)&&(E=J));break;case 4:W=h[y+1],U=h[y+2],Z=h[y+3],(W&192)===128&&(U&192)===128&&(Z&192)===128&&(J=(b&15)<<18|(W&63)<<12|(U&63)<<6|Z&63,J>65535&&J<1114112&&(E=J))}}E===null?(E=65533,B=1):E>65535&&(E-=65536,d.push(E>>>10&1023|55296),E=56320|E&1023),d.push(E),y+=B}return Ye(d)}var Te=4096;function Ye(h){var s=h.length;if(s<=Te)return String.fromCharCode.apply(String,h);for(var u="",d=0;d<s;)u+=String.fromCharCode.apply(String,h.slice(d,d+=Te));return u}function Ge(h,s,u){var d="";u=Math.min(h.length,u);for(var y=s;y<u;++y)d+=String.fromCharCode(h[y]&127);return d}function k(h,s,u){var d="";u=Math.min(h.length,u);for(var y=s;y<u;++y)d+=String.fromCharCode(h[y]);return d}function ce(h,s,u){var d=h.length;(!s||s<0)&&(s=0),(!u||u<0||u>d)&&(u=d);for(var y="",b=s;b<u;++b)y+=Yt[h[b]];return y}function F(h,s,u){for(var d=h.slice(s,u),y="",b=0;b<d.length-1;b+=2)y+=String.fromCharCode(d[b]+d[b+1]*256);return y}a.prototype.slice=function(s,u){var d=this.length;s=~~s,u=u===void 0?d:~~u,s<0?(s+=d,s<0&&(s=0)):s>d&&(s=d),u<0?(u+=d,u<0&&(u=0)):u>d&&(u=d),u<s&&(u=s);var y=this.subarray(s,u);return Object.setPrototypeOf(y,a.prototype),y};function A(h,s,u){if(h%1!==0||h<0)throw new RangeError("offset is not uint");if(h+s>u)throw new RangeError("Trying to access beyond buffer length")}a.prototype.readUintLE=a.prototype.readUIntLE=function(s,u,d){s=s>>>0,u=u>>>0,d||A(s,u,this.length);for(var y=this[s],b=1,E=0;++E<u&&(b*=256);)y+=this[s+E]*b;return y},a.prototype.readUintBE=a.prototype.readUIntBE=function(s,u,d){s=s>>>0,u=u>>>0,d||A(s,u,this.length);for(var y=this[s+--u],b=1;u>0&&(b*=256);)y+=this[s+--u]*b;return y},a.prototype.readUint8=a.prototype.readUInt8=function(s,u){return s=s>>>0,u||A(s,1,this.length),this[s]},a.prototype.readUint16LE=a.prototype.readUInt16LE=function(s,u){return s=s>>>0,u||A(s,2,this.length),this[s]|this[s+1]<<8},a.prototype.readUint16BE=a.prototype.readUInt16BE=function(s,u){return s=s>>>0,u||A(s,2,this.length),this[s]<<8|this[s+1]},a.prototype.readUint32LE=a.prototype.readUInt32LE=function(s,u){return s=s>>>0,u||A(s,4,this.length),(this[s]|this[s+1]<<8|this[s+2]<<16)+this[s+3]*16777216},a.prototype.readUint32BE=a.prototype.readUInt32BE=function(s,u){return s=s>>>0,u||A(s,4,this.length),this[s]*16777216+(this[s+1]<<16|this[s+2]<<8|this[s+3])},a.prototype.readIntLE=function(s,u,d){s=s>>>0,u=u>>>0,d||A(s,u,this.length);for(var y=this[s],b=1,E=0;++E<u&&(b*=256);)y+=this[s+E]*b;return b*=128,y>=b&&(y-=Math.pow(2,8*u)),y},a.prototype.readIntBE=function(s,u,d){s=s>>>0,u=u>>>0,d||A(s,u,this.length);for(var y=u,b=1,E=this[s+--y];y>0&&(b*=256);)E+=this[s+--y]*b;return b*=128,E>=b&&(E-=Math.pow(2,8*u)),E},a.prototype.readInt8=function(s,u){return s=s>>>0,u||A(s,1,this.length),this[s]&128?(255-this[s]+1)*-1:this[s]},a.prototype.readInt16LE=function(s,u){s=s>>>0,u||A(s,2,this.length);var d=this[s]|this[s+1]<<8;return d&32768?d|4294901760:d},a.prototype.readInt16BE=function(s,u){s=s>>>0,u||A(s,2,this.length);var d=this[s+1]|this[s]<<8;return d&32768?d|4294901760:d},a.prototype.readInt32LE=function(s,u){return s=s>>>0,u||A(s,4,this.length),this[s]|this[s+1]<<8|this[s+2]<<16|this[s+3]<<24},a.prototype.readInt32BE=function(s,u){return s=s>>>0,u||A(s,4,this.length),this[s]<<24|this[s+1]<<16|this[s+2]<<8|this[s+3]},a.prototype.readFloatLE=function(s,u){return s=s>>>0,u||A(s,4,this.length),_t.read(this,s,!0,23,4)},a.prototype.readFloatBE=function(s,u){return s=s>>>0,u||A(s,4,this.length),_t.read(this,s,!1,23,4)},a.prototype.readDoubleLE=function(s,u){return s=s>>>0,u||A(s,8,this.length),_t.read(this,s,!0,52,8)},a.prototype.readDoubleBE=function(s,u){return s=s>>>0,u||A(s,8,this.length),_t.read(this,s,!1,52,8)};function re(h,s,u,d,y,b){if(!a.isBuffer(h))throw new TypeError('"buffer" argument must be a Buffer instance');if(s>y||s<b)throw new RangeError('"value" argument is out of bounds');if(u+d>h.length)throw new RangeError("Index out of range")}a.prototype.writeUintLE=a.prototype.writeUIntLE=function(s,u,d,y){if(s=+s,u=u>>>0,d=d>>>0,!y){var b=Math.pow(2,8*d)-1;re(this,s,u,d,b,0)}var E=1,B=0;for(this[u]=s&255;++B<d&&(E*=256);)this[u+B]=s/E&255;return u+d},a.prototype.writeUintBE=a.prototype.writeUIntBE=function(s,u,d,y){if(s=+s,u=u>>>0,d=d>>>0,!y){var b=Math.pow(2,8*d)-1;re(this,s,u,d,b,0)}var E=d-1,B=1;for(this[u+E]=s&255;--E>=0&&(B*=256);)this[u+E]=s/B&255;return u+d},a.prototype.writeUint8=a.prototype.writeUInt8=function(s,u,d){return s=+s,u=u>>>0,d||re(this,s,u,1,255,0),this[u]=s&255,u+1},a.prototype.writeUint16LE=a.prototype.writeUInt16LE=function(s,u,d){return s=+s,u=u>>>0,d||re(this,s,u,2,65535,0),this[u]=s&255,this[u+1]=s>>>8,u+2},a.prototype.writeUint16BE=a.prototype.writeUInt16BE=function(s,u,d){return s=+s,u=u>>>0,d||re(this,s,u,2,65535,0),this[u]=s>>>8,this[u+1]=s&255,u+2},a.prototype.writeUint32LE=a.prototype.writeUInt32LE=function(s,u,d){return s=+s,u=u>>>0,d||re(this,s,u,4,4294967295,0),this[u+3]=s>>>24,this[u+2]=s>>>16,this[u+1]=s>>>8,this[u]=s&255,u+4},a.prototype.writeUint32BE=a.prototype.writeUInt32BE=function(s,u,d){return s=+s,u=u>>>0,d||re(this,s,u,4,4294967295,0),this[u]=s>>>24,this[u+1]=s>>>16,this[u+2]=s>>>8,this[u+3]=s&255,u+4},a.prototype.writeIntLE=function(s,u,d,y){if(s=+s,u=u>>>0,!y){var b=Math.pow(2,8*d-1);re(this,s,u,d,b-1,-b)}var E=0,B=1,W=0;for(this[u]=s&255;++E<d&&(B*=256);)s<0&&W===0&&this[u+E-1]!==0&&(W=1),this[u+E]=(s/B>>0)-W&255;return u+d},a.prototype.writeIntBE=function(s,u,d,y){if(s=+s,u=u>>>0,!y){var b=Math.pow(2,8*d-1);re(this,s,u,d,b-1,-b)}var E=d-1,B=1,W=0;for(this[u+E]=s&255;--E>=0&&(B*=256);)s<0&&W===0&&this[u+E+1]!==0&&(W=1),this[u+E]=(s/B>>0)-W&255;return u+d},a.prototype.writeInt8=function(s,u,d){return s=+s,u=u>>>0,d||re(this,s,u,1,127,-128),s<0&&(s=255+s+1),this[u]=s&255,u+1},a.prototype.writeInt16LE=function(s,u,d){return s=+s,u=u>>>0,d||re(this,s,u,2,32767,-32768),this[u]=s&255,this[u+1]=s>>>8,u+2},a.prototype.writeInt16BE=function(s,u,d){return s=+s,u=u>>>0,d||re(this,s,u,2,32767,-32768),this[u]=s>>>8,this[u+1]=s&255,u+2},a.prototype.writeInt32LE=function(s,u,d){return s=+s,u=u>>>0,d||re(this,s,u,4,2147483647,-2147483648),this[u]=s&255,this[u+1]=s>>>8,this[u+2]=s>>>16,this[u+3]=s>>>24,u+4},a.prototype.writeInt32BE=function(s,u,d){return s=+s,u=u>>>0,d||re(this,s,u,4,2147483647,-2147483648),s<0&&(s=4294967295+s+1),this[u]=s>>>24,this[u+1]=s>>>16,this[u+2]=s>>>8,this[u+3]=s&255,u+4};function kt(h,s,u,d,y,b){if(u+d>h.length)throw new RangeError("Index out of range");if(u<0)throw new RangeError("Index out of range")}function me(h,s,u,d,y){return s=+s,u=u>>>0,y||kt(h,s,u,4),_t.write(h,s,u,d,23,4),u+4}a.prototype.writeFloatLE=function(s,u,d){return me(this,s,u,!0,d)},a.prototype.writeFloatBE=function(s,u,d){return me(this,s,u,!1,d)};function Ot(h,s,u,d,y){return s=+s,u=u>>>0,y||kt(h,s,u,8),_t.write(h,s,u,d,52,8),u+8}a.prototype.writeDoubleLE=function(s,u,d){return Ot(this,s,u,!0,d)},a.prototype.writeDoubleBE=function(s,u,d){return Ot(this,s,u,!1,d)},a.prototype.copy=function(s,u,d,y){if(!a.isBuffer(s))throw new TypeError("argument should be a Buffer");if(d||(d=0),!y&&y!==0&&(y=this.length),u>=s.length&&(u=s.length),u||(u=0),y>0&&y<d&&(y=d),y===d||s.length===0||this.length===0)return 0;if(u<0)throw new RangeError("targetStart out of bounds");if(d<0||d>=this.length)throw new RangeError("Index out of range");if(y<0)throw new RangeError("sourceEnd out of bounds");y>this.length&&(y=this.length),s.length-u<y-d&&(y=s.length-u+d);var b=y-d;return this===s&&typeof Uint8Array.prototype.copyWithin=="function"?this.copyWithin(u,d,y):Uint8Array.prototype.set.call(s,this.subarray(d,y),u),b},a.prototype.fill=function(s,u,d,y){if(typeof s=="string"){if(typeof u=="string"?(y=u,u=0,d=this.length):typeof d=="string"&&(y=d,d=this.length),y!==void 0&&typeof y!="string")throw new TypeError("encoding must be a string");if(typeof y=="string"&&!a.isEncoding(y))throw new TypeError("Unknown encoding: "+y);if(s.length===1){var b=s.charCodeAt(0);(y==="utf8"&&b<128||y==="latin1")&&(s=b)}}else typeof s=="number"?s=s&255:typeof s=="boolean"&&(s=Number(s));if(u<0||this.length<u||this.length<d)throw new RangeError("Out of range index");if(d<=u)return this;u=u>>>0,d=d===void 0?this.length:d>>>0,s||(s=0);var E;if(typeof s=="number")for(E=u;E<d;++E)this[E]=s;else{var B=a.isBuffer(s)?s:a.from(s,y),W=B.length;if(W===0)throw new TypeError('The value "'+s+'" is invalid for argument "value"');for(E=0;E<d-u;++E)this[E+u]=B[E%W]}return this};var Jt=/[^+/0-9A-Za-z-_]/g;function Dr(h){if(h=h.split("=")[0],h=h.trim().replace(Jt,""),h.length<2)return"";for(;h.length%4!==0;)h=h+"=";return h}function At(h,s){s=s||1/0;for(var u,d=h.length,y=null,b=[],E=0;E<d;++E){if(u=h.charCodeAt(E),u>55295&&u<57344){if(!y){if(u>56319){(s-=3)>-1&&b.push(239,191,189);continue}else if(E+1===d){(s-=3)>-1&&b.push(239,191,189);continue}y=u;continue}if(u<56320){(s-=3)>-1&&b.push(239,191,189),y=u;continue}u=(y-55296<<10|u-56320)+65536}else y&&(s-=3)>-1&&b.push(239,191,189);if(y=null,u<128){if((s-=1)<0)break;b.push(u)}else if(u<2048){if((s-=2)<0)break;b.push(u>>6|192,u&63|128)}else if(u<65536){if((s-=3)<0)break;b.push(u>>12|224,u>>6&63|128,u&63|128)}else if(u<1114112){if((s-=4)<0)break;b.push(u>>18|240,u>>12&63|128,u>>6&63|128,u&63|128)}else throw new Error("Invalid code point")}return b}function Lr(h){for(var s=[],u=0;u<h.length;++u)s.push(h.charCodeAt(u)&255);return s}function Br(h,s){for(var u,d,y,b=[],E=0;E<h.length&&!((s-=2)<0);++E)u=h.charCodeAt(E),d=u>>8,y=u%256,b.push(y),b.push(d);return b}function Kt(h){return Xr.toByteArray(Dr(h))}function Xe(h,s,u,d){for(var y=0;y<d&&!(y+u>=s.length||y>=h.length);++y)s[y+u]=h[y];return y}function ye(h,s){return h instanceof s||h!=null&&h.constructor!=null&&h.constructor.name!=null&&h.constructor.name===s.name}function Rt(h){return h!==h}var Yt=function(){for(var h="0123456789abcdef",s=new Array(256),u=0;u<16;++u)for(var d=u*16,y=0;y<16;++y)s[d+y]=h[u]+h[y];return s}()}),j=_r.Buffer;_r.SlowBuffer;_r.INSPECT_MAX_BYTES;_r.kMaxLength;/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */var ln=function(t,r){return ln=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,i){n.__proto__=i}||function(n,i){for(var o in i)i.hasOwnProperty(o)&&(n[o]=i[o])},ln(t,r)};function vr(e,t){ln(e,t);function r(){this.constructor=e}e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}var ut=function(e){vr(t,e);function t(r){var n=e.call(this,r)||this;return Object.setPrototypeOf(n,t.prototype),n}return Object.defineProperty(t.prototype,"name",{get:function(){return"BSONError"},enumerable:!1,configurable:!0}),t}(Error),Y=function(e){vr(t,e);function t(r){var n=e.call(this,r)||this;return Object.setPrototypeOf(n,t.prototype),n}return Object.defineProperty(t.prototype,"name",{get:function(){return"BSONTypeError"},enumerable:!1,configurable:!0}),t}(TypeError);function ir(e){return e&&e.Math==Math&&e}function qi(){return ir(typeof globalThis=="object"&&globalThis)||ir(typeof window=="object"&&window)||ir(typeof self=="object"&&self)||ir(typeof global=="object"&&global)||Function("return this")()}function Ia(){var e=qi();return typeof e.navigator=="object"&&e.navigator.product==="ReactNative"}var xa=function(t){var r=Ia()?"BSON: For React Native please polyfill crypto.getRandomValues, e.g. using: https://www.npmjs.com/package/react-native-get-random-values.":"BSON: No cryptographic implementation for random bytes present, falling back to a less secure implementation.";console.warn(r);for(var n=j.alloc(t),i=0;i<t;++i)n[i]=Math.floor(Math.random()*256);return n},Ta=function(){{if(typeof window<"u"){var e=window.crypto||window.msCrypto;if(e&&e.getRandomValues)return function(t){return e.getRandomValues(j.alloc(t))}}return typeof global<"u"&&global.crypto&&global.crypto.getRandomValues?function(t){return global.crypto.getRandomValues(j.alloc(t))}:xa}},Vi=Ta();function Na(e){return["[object ArrayBuffer]","[object SharedArrayBuffer]"].includes(Object.prototype.toString.call(e))}function wn(e){return Object.prototype.toString.call(e)==="[object Uint8Array]"}function Oa(e){return Object.prototype.toString.call(e)==="[object RegExp]"}function Aa(e){return Vt(e)&&Object.prototype.toString.call(e)==="[object Date]"}function Vt(e){return typeof e=="object"&&e!==null}function br(e,t){var r=!1;function n(){for(var i=[],o=0;o<arguments.length;o++)i[o]=arguments[o];return r||(console.warn(t),r=!0),e.apply(this,i)}return n}function dr(e){if(ArrayBuffer.isView(e))return j.from(e.buffer,e.byteOffset,e.byteLength);if(Na(e))return j.from(e);throw new Y("Must use either Buffer or TypedArray")}var Ra=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-4[0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|[0-9a-f]{12}4[0-9a-f]{3}[89ab][0-9a-f]{15})$/i,ki=function(e){return typeof e=="string"&&Ra.test(e)},dn=function(e){if(!ki(e))throw new Y('UUID string representations must be a 32 or 36 character hex string (dashes excluded/included). Format: "xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx" or "xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx".');var t=e.replace(/-/g,"");return j.from(t,"hex")},ti=function(e,t){return t===void 0&&(t=!0),t?e.toString("hex",0,4)+"-"+e.toString("hex",4,6)+"-"+e.toString("hex",6,8)+"-"+e.toString("hex",8,10)+"-"+e.toString("hex",10,16):e.toString("hex")},Ca=Math.pow(2,53),Da=-Math.pow(2,53),Ji=4,ct=function(){function e(t,r){if(!(this instanceof e))return new e(t,r);if(t!=null&&typeof t!="string"&&!ArrayBuffer.isView(t)&&!(t instanceof ArrayBuffer)&&!Array.isArray(t))throw new Y("Binary can only be constructed from string, Buffer, TypedArray, or Array<number>");this.sub_type=r??e.BSON_BINARY_SUBTYPE_DEFAULT,t==null?(this.buffer=j.alloc(e.BUFFER_SIZE),this.position=0):(typeof t=="string"?this.buffer=j.from(t,"binary"):Array.isArray(t)?this.buffer=j.from(t):this.buffer=dr(t),this.position=this.buffer.byteLength)}return e.prototype.put=function(t){if(typeof t=="string"&&t.length!==1)throw new Y("only accepts single character String");if(typeof t!="number"&&t.length!==1)throw new Y("only accepts single character Uint8Array or Array");var r;if(typeof t=="string"?r=t.charCodeAt(0):typeof t=="number"?r=t:r=t[0],r<0||r>255)throw new Y("only accepts number in a valid unsigned byte range 0-255");if(this.buffer.length>this.position)this.buffer[this.position++]=r;else{var n=j.alloc(e.BUFFER_SIZE+this.buffer.length);this.buffer.copy(n,0,0,this.buffer.length),this.buffer=n,this.buffer[this.position++]=r}},e.prototype.write=function(t,r){if(r=typeof r=="number"?r:this.position,this.buffer.length<r+t.length){var n=j.alloc(this.buffer.length+t.length);this.buffer.copy(n,0,0,this.buffer.length),this.buffer=n}ArrayBuffer.isView(t)?(this.buffer.set(dr(t),r),this.position=r+t.byteLength>this.position?r+t.length:this.position):typeof t=="string"&&(this.buffer.write(t,r,t.length,"binary"),this.position=r+t.length>this.position?r+t.length:this.position)},e.prototype.read=function(t,r){return r=r&&r>0?r:this.position,this.buffer.slice(t,t+r)},e.prototype.value=function(t){return t=!!t,t&&this.buffer.length===this.position?this.buffer:t?this.buffer.slice(0,this.position):this.buffer.toString("binary",0,this.position)},e.prototype.length=function(){return this.position},e.prototype.toJSON=function(){return this.buffer.toString("base64")},e.prototype.toString=function(t){return this.buffer.toString(t)},e.prototype.toExtendedJSON=function(t){t=t||{};var r=this.buffer.toString("base64"),n=Number(this.sub_type).toString(16);return t.legacy?{$binary:r,$type:n.length===1?"0"+n:n}:{$binary:{base64:r,subType:n.length===1?"0"+n:n}}},e.prototype.toUUID=function(){if(this.sub_type===e.SUBTYPE_UUID)return new ri(this.buffer.slice(0,this.position));throw new ut('Binary sub_type "'.concat(this.sub_type,'" is not supported for converting to UUID. Only "').concat(e.SUBTYPE_UUID,'" is currently supported.'))},e.fromExtendedJSON=function(t,r){r=r||{};var n,i;if("$binary"in t?r.legacy&&typeof t.$binary=="string"&&"$type"in t?(i=t.$type?parseInt(t.$type,16):0,n=j.from(t.$binary,"base64")):typeof t.$binary!="string"&&(i=t.$binary.subType?parseInt(t.$binary.subType,16):0,n=j.from(t.$binary.base64,"base64")):"$uuid"in t&&(i=4,n=dn(t.$uuid)),!n)throw new Y("Unexpected Binary Extended JSON format ".concat(JSON.stringify(t)));return i===Ji?new ri(n):new e(n,i)},e.prototype[Symbol.for("nodejs.util.inspect.custom")]=function(){return this.inspect()},e.prototype.inspect=function(){var t=this.value(!0);return'new Binary(Buffer.from("'.concat(t.toString("hex"),'", "hex"), ').concat(this.sub_type,")")},e.BSON_BINARY_SUBTYPE_DEFAULT=0,e.BUFFER_SIZE=256,e.SUBTYPE_DEFAULT=0,e.SUBTYPE_FUNCTION=1,e.SUBTYPE_BYTE_ARRAY=2,e.SUBTYPE_UUID_OLD=3,e.SUBTYPE_UUID=4,e.SUBTYPE_MD5=5,e.SUBTYPE_ENCRYPTED=6,e.SUBTYPE_COLUMN=7,e.SUBTYPE_USER_DEFINED=128,e}();Object.defineProperty(ct.prototype,"_bsontype",{value:"Binary"});var Zr=16,ri=function(e){vr(t,e);function t(r){var n=this,i,o;if(r==null)i=t.generate();else if(r instanceof t)i=j.from(r.buffer),o=r.__id;else if(ArrayBuffer.isView(r)&&r.byteLength===Zr)i=dr(r);else if(typeof r=="string")i=dn(r);else throw new Y("Argument passed in UUID constructor must be a UUID, a 16 byte Buffer or a 32/36 character hex string (dashes excluded/included, format: xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx).");return n=e.call(this,i,Ji)||this,n.__id=o,n}return Object.defineProperty(t.prototype,"id",{get:function(){return this.buffer},set:function(r){this.buffer=r,t.cacheHexString&&(this.__id=ti(r))},enumerable:!1,configurable:!0}),t.prototype.toHexString=function(r){if(r===void 0&&(r=!0),t.cacheHexString&&this.__id)return this.__id;var n=ti(this.id,r);return t.cacheHexString&&(this.__id=n),n},t.prototype.toString=function(r){return r?this.id.toString(r):this.toHexString()},t.prototype.toJSON=function(){return this.toHexString()},t.prototype.equals=function(r){if(!r)return!1;if(r instanceof t)return r.id.equals(this.id);try{return new t(r).id.equals(this.id)}catch{return!1}},t.prototype.toBinary=function(){return new ct(this.id,ct.SUBTYPE_UUID)},t.generate=function(){var r=Vi(Zr);return r[6]=r[6]&15|64,r[8]=r[8]&63|128,j.from(r)},t.isValid=function(r){return r?r instanceof t?!0:typeof r=="string"?ki(r):wn(r)?r.length!==Zr?!1:(r[6]&240)===64&&(r[8]&128)===128:!1:!1},t.createFromHexString=function(r){var n=dn(r);return new t(n)},t.prototype[Symbol.for("nodejs.util.inspect.custom")]=function(){return this.inspect()},t.prototype.inspect=function(){return'new UUID("'.concat(this.toHexString(),'")')},t}(ct),Er=function(){function e(t,r){if(!(this instanceof e))return new e(t,r);this.code=t,this.scope=r}return e.prototype.toJSON=function(){return{code:this.code,scope:this.scope}},e.prototype.toExtendedJSON=function(){return this.scope?{$code:this.code,$scope:this.scope}:{$code:this.code}},e.fromExtendedJSON=function(t){return new e(t.$code,t.$scope)},e.prototype[Symbol.for("nodejs.util.inspect.custom")]=function(){return this.inspect()},e.prototype.inspect=function(){var t=this.toJSON();return'new Code("'.concat(String(t.code),'"').concat(t.scope?", ".concat(JSON.stringify(t.scope)):"",")")},e}();Object.defineProperty(Er.prototype,"_bsontype",{value:"Code"});function La(e){return Vt(e)&&e.$id!=null&&typeof e.$ref=="string"&&(e.$db==null||typeof e.$db=="string")}var Wt=function(){function e(t,r,n,i){if(!(this instanceof e))return new e(t,r,n,i);var o=t.split(".");o.length===2&&(n=o.shift(),t=o.shift()),this.collection=t,this.oid=r,this.db=n,this.fields=i||{}}return Object.defineProperty(e.prototype,"namespace",{get:function(){return this.collection},set:function(t){this.collection=t},enumerable:!1,configurable:!0}),e.prototype.toJSON=function(){var t=Object.assign({$ref:this.collection,$id:this.oid},this.fields);return this.db!=null&&(t.$db=this.db),t},e.prototype.toExtendedJSON=function(t){t=t||{};var r={$ref:this.collection,$id:this.oid};return t.legacy||(this.db&&(r.$db=this.db),r=Object.assign(r,this.fields)),r},e.fromExtendedJSON=function(t){var r=Object.assign({},t);return delete r.$ref,delete r.$id,delete r.$db,new e(t.$ref,t.$id,t.$db,r)},e.prototype[Symbol.for("nodejs.util.inspect.custom")]=function(){return this.inspect()},e.prototype.inspect=function(){var t=this.oid===void 0||this.oid.toString===void 0?this.oid:this.oid.toString();return'new DBRef("'.concat(this.namespace,'", new ObjectId("').concat(String(t),'")').concat(this.db?', "'.concat(this.db,'"'):"",")")},e}();Object.defineProperty(Wt.prototype,"_bsontype",{value:"DBRef"});var we=void 0;try{we=new WebAssembly.Instance(new WebAssembly.Module(new Uint8Array([0,97,115,109,1,0,0,0,1,13,2,96,0,1,127,96,4,127,127,127,127,1,127,3,7,6,0,1,1,1,1,1,6,6,1,127,1,65,0,11,7,50,6,3,109,117,108,0,1,5,100,105,118,95,115,0,2,5,100,105,118,95,117,0,3,5,114,101,109,95,115,0,4,5,114,101,109,95,117,0,5,8,103,101,116,95,104,105,103,104,0,0,10,191,1,6,4,0,35,0,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,126,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,127,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,128,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,129,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,130,34,4,66,32,135,167,36,0,32,4,167,11])),{}).exports}catch{}var ni=65536,Ba=1<<24,Et=ni*ni,Ki=Et*Et,ii=Ki/2,oi={},si={},C=function(){function e(t,r,n){if(t===void 0&&(t=0),!(this instanceof e))return new e(t,r,n);typeof t=="bigint"?Object.assign(this,e.fromBigInt(t,!!r)):typeof t=="string"?Object.assign(this,e.fromString(t,!!r)):(this.low=t|0,this.high=r|0,this.unsigned=!!n),Object.defineProperty(this,"__isLong__",{value:!0,configurable:!1,writable:!1,enumerable:!1})}return e.fromBits=function(t,r,n){return new e(t,r,n)},e.fromInt=function(t,r){var n,i,o;return r?(t>>>=0,(o=0<=t&&t<256)&&(i=si[t],i)?i:(n=e.fromBits(t,(t|0)<0?-1:0,!0),o&&(si[t]=n),n)):(t|=0,(o=-128<=t&&t<128)&&(i=oi[t],i)?i:(n=e.fromBits(t,t<0?-1:0,!1),o&&(oi[t]=n),n))},e.fromNumber=function(t,r){if(isNaN(t))return r?e.UZERO:e.ZERO;if(r){if(t<0)return e.UZERO;if(t>=Ki)return e.MAX_UNSIGNED_VALUE}else{if(t<=-ii)return e.MIN_VALUE;if(t+1>=ii)return e.MAX_VALUE}return t<0?e.fromNumber(-t,r).neg():e.fromBits(t%Et|0,t/Et|0,r)},e.fromBigInt=function(t,r){return e.fromString(t.toString(),r)},e.fromString=function(t,r,n){if(t.length===0)throw Error("empty string");if(t==="NaN"||t==="Infinity"||t==="+Infinity"||t==="-Infinity")return e.ZERO;if(typeof r=="number"?(n=r,r=!1):r=!!r,n=n||10,n<2||36<n)throw RangeError("radix");var i;if((i=t.indexOf("-"))>0)throw Error("interior hyphen");if(i===0)return e.fromString(t.substring(1),r,n).neg();for(var o=e.fromNumber(Math.pow(n,8)),a=e.ZERO,l=0;l<t.length;l+=8){var p=Math.min(8,t.length-l),c=parseInt(t.substring(l,l+p),n);if(p<8){var g=e.fromNumber(Math.pow(n,p));a=a.mul(g).add(e.fromNumber(c))}else a=a.mul(o),a=a.add(e.fromNumber(c))}return a.unsigned=r,a},e.fromBytes=function(t,r,n){return n?e.fromBytesLE(t,r):e.fromBytesBE(t,r)},e.fromBytesLE=function(t,r){return new e(t[0]|t[1]<<8|t[2]<<16|t[3]<<24,t[4]|t[5]<<8|t[6]<<16|t[7]<<24,r)},e.fromBytesBE=function(t,r){return new e(t[4]<<24|t[5]<<16|t[6]<<8|t[7],t[0]<<24|t[1]<<16|t[2]<<8|t[3],r)},e.isLong=function(t){return Vt(t)&&t.__isLong__===!0},e.fromValue=function(t,r){return typeof t=="number"?e.fromNumber(t,r):typeof t=="string"?e.fromString(t,r):e.fromBits(t.low,t.high,typeof r=="boolean"?r:t.unsigned)},e.prototype.add=function(t){e.isLong(t)||(t=e.fromValue(t));var r=this.high>>>16,n=this.high&65535,i=this.low>>>16,o=this.low&65535,a=t.high>>>16,l=t.high&65535,p=t.low>>>16,c=t.low&65535,g=0,m=0,_=0,I=0;return I+=o+c,_+=I>>>16,I&=65535,_+=i+p,m+=_>>>16,_&=65535,m+=n+l,g+=m>>>16,m&=65535,g+=r+a,g&=65535,e.fromBits(_<<16|I,g<<16|m,this.unsigned)},e.prototype.and=function(t){return e.isLong(t)||(t=e.fromValue(t)),e.fromBits(this.low&t.low,this.high&t.high,this.unsigned)},e.prototype.compare=function(t){if(e.isLong(t)||(t=e.fromValue(t)),this.eq(t))return 0;var r=this.isNegative(),n=t.isNegative();return r&&!n?-1:!r&&n?1:this.unsigned?t.high>>>0>this.high>>>0||t.high===this.high&&t.low>>>0>this.low>>>0?-1:1:this.sub(t).isNegative()?-1:1},e.prototype.comp=function(t){return this.compare(t)},e.prototype.divide=function(t){if(e.isLong(t)||(t=e.fromValue(t)),t.isZero())throw Error("division by zero");if(we){if(!this.unsigned&&this.high===-2147483648&&t.low===-1&&t.high===-1)return this;var r=(this.unsigned?we.div_u:we.div_s)(this.low,this.high,t.low,t.high);return e.fromBits(r,we.get_high(),this.unsigned)}if(this.isZero())return this.unsigned?e.UZERO:e.ZERO;var n,i,o;if(this.unsigned){if(t.unsigned||(t=t.toUnsigned()),t.gt(this))return e.UZERO;if(t.gt(this.shru(1)))return e.UONE;o=e.UZERO}else{if(this.eq(e.MIN_VALUE)){if(t.eq(e.ONE)||t.eq(e.NEG_ONE))return e.MIN_VALUE;if(t.eq(e.MIN_VALUE))return e.ONE;var a=this.shr(1);return n=a.div(t).shl(1),n.eq(e.ZERO)?t.isNegative()?e.ONE:e.NEG_ONE:(i=this.sub(t.mul(n)),o=n.add(i.div(t)),o)}else if(t.eq(e.MIN_VALUE))return this.unsigned?e.UZERO:e.ZERO;if(this.isNegative())return t.isNegative()?this.neg().div(t.neg()):this.neg().div(t).neg();if(t.isNegative())return this.div(t.neg()).neg();o=e.ZERO}for(i=this;i.gte(t);){n=Math.max(1,Math.floor(i.toNumber()/t.toNumber()));for(var l=Math.ceil(Math.log(n)/Math.LN2),p=l<=48?1:Math.pow(2,l-48),c=e.fromNumber(n),g=c.mul(t);g.isNegative()||g.gt(i);)n-=p,c=e.fromNumber(n,this.unsigned),g=c.mul(t);c.isZero()&&(c=e.ONE),o=o.add(c),i=i.sub(g)}return o},e.prototype.div=function(t){return this.divide(t)},e.prototype.equals=function(t){return e.isLong(t)||(t=e.fromValue(t)),this.unsigned!==t.unsigned&&this.high>>>31===1&&t.high>>>31===1?!1:this.high===t.high&&this.low===t.low},e.prototype.eq=function(t){return this.equals(t)},e.prototype.getHighBits=function(){return this.high},e.prototype.getHighBitsUnsigned=function(){return this.high>>>0},e.prototype.getLowBits=function(){return this.low},e.prototype.getLowBitsUnsigned=function(){return this.low>>>0},e.prototype.getNumBitsAbs=function(){if(this.isNegative())return this.eq(e.MIN_VALUE)?64:this.neg().getNumBitsAbs();var t=this.high!==0?this.high:this.low,r;for(r=31;r>0&&!(t&1<<r);r--);return this.high!==0?r+33:r+1},e.prototype.greaterThan=function(t){return this.comp(t)>0},e.prototype.gt=function(t){return this.greaterThan(t)},e.prototype.greaterThanOrEqual=function(t){return this.comp(t)>=0},e.prototype.gte=function(t){return this.greaterThanOrEqual(t)},e.prototype.ge=function(t){return this.greaterThanOrEqual(t)},e.prototype.isEven=function(){return(this.low&1)===0},e.prototype.isNegative=function(){return!this.unsigned&&this.high<0},e.prototype.isOdd=function(){return(this.low&1)===1},e.prototype.isPositive=function(){return this.unsigned||this.high>=0},e.prototype.isZero=function(){return this.high===0&&this.low===0},e.prototype.lessThan=function(t){return this.comp(t)<0},e.prototype.lt=function(t){return this.lessThan(t)},e.prototype.lessThanOrEqual=function(t){return this.comp(t)<=0},e.prototype.lte=function(t){return this.lessThanOrEqual(t)},e.prototype.modulo=function(t){if(e.isLong(t)||(t=e.fromValue(t)),we){var r=(this.unsigned?we.rem_u:we.rem_s)(this.low,this.high,t.low,t.high);return e.fromBits(r,we.get_high(),this.unsigned)}return this.sub(this.div(t).mul(t))},e.prototype.mod=function(t){return this.modulo(t)},e.prototype.rem=function(t){return this.modulo(t)},e.prototype.multiply=function(t){if(this.isZero())return e.ZERO;if(e.isLong(t)||(t=e.fromValue(t)),we){var r=we.mul(this.low,this.high,t.low,t.high);return e.fromBits(r,we.get_high(),this.unsigned)}if(t.isZero())return e.ZERO;if(this.eq(e.MIN_VALUE))return t.isOdd()?e.MIN_VALUE:e.ZERO;if(t.eq(e.MIN_VALUE))return this.isOdd()?e.MIN_VALUE:e.ZERO;if(this.isNegative())return t.isNegative()?this.neg().mul(t.neg()):this.neg().mul(t).neg();if(t.isNegative())return this.mul(t.neg()).neg();if(this.lt(e.TWO_PWR_24)&&t.lt(e.TWO_PWR_24))return e.fromNumber(this.toNumber()*t.toNumber(),this.unsigned);var n=this.high>>>16,i=this.high&65535,o=this.low>>>16,a=this.low&65535,l=t.high>>>16,p=t.high&65535,c=t.low>>>16,g=t.low&65535,m=0,_=0,I=0,T=0;return T+=a*g,I+=T>>>16,T&=65535,I+=o*g,_+=I>>>16,I&=65535,I+=a*c,_+=I>>>16,I&=65535,_+=i*g,m+=_>>>16,_&=65535,_+=o*c,m+=_>>>16,_&=65535,_+=a*p,m+=_>>>16,_&=65535,m+=n*g+i*c+o*p+a*l,m&=65535,e.fromBits(I<<16|T,m<<16|_,this.unsigned)},e.prototype.mul=function(t){return this.multiply(t)},e.prototype.negate=function(){return!this.unsigned&&this.eq(e.MIN_VALUE)?e.MIN_VALUE:this.not().add(e.ONE)},e.prototype.neg=function(){return this.negate()},e.prototype.not=function(){return e.fromBits(~this.low,~this.high,this.unsigned)},e.prototype.notEquals=function(t){return!this.equals(t)},e.prototype.neq=function(t){return this.notEquals(t)},e.prototype.ne=function(t){return this.notEquals(t)},e.prototype.or=function(t){return e.isLong(t)||(t=e.fromValue(t)),e.fromBits(this.low|t.low,this.high|t.high,this.unsigned)},e.prototype.shiftLeft=function(t){return e.isLong(t)&&(t=t.toInt()),(t&=63)===0?this:t<32?e.fromBits(this.low<<t,this.high<<t|this.low>>>32-t,this.unsigned):e.fromBits(0,this.low<<t-32,this.unsigned)},e.prototype.shl=function(t){return this.shiftLeft(t)},e.prototype.shiftRight=function(t){return e.isLong(t)&&(t=t.toInt()),(t&=63)===0?this:t<32?e.fromBits(this.low>>>t|this.high<<32-t,this.high>>t,this.unsigned):e.fromBits(this.high>>t-32,this.high>=0?0:-1,this.unsigned)},e.prototype.shr=function(t){return this.shiftRight(t)},e.prototype.shiftRightUnsigned=function(t){if(e.isLong(t)&&(t=t.toInt()),t&=63,t===0)return this;var r=this.high;if(t<32){var n=this.low;return e.fromBits(n>>>t|r<<32-t,r>>>t,this.unsigned)}else return t===32?e.fromBits(r,0,this.unsigned):e.fromBits(r>>>t-32,0,this.unsigned)},e.prototype.shr_u=function(t){return this.shiftRightUnsigned(t)},e.prototype.shru=function(t){return this.shiftRightUnsigned(t)},e.prototype.subtract=function(t){return e.isLong(t)||(t=e.fromValue(t)),this.add(t.neg())},e.prototype.sub=function(t){return this.subtract(t)},e.prototype.toInt=function(){return this.unsigned?this.low>>>0:this.low},e.prototype.toNumber=function(){return this.unsigned?(this.high>>>0)*Et+(this.low>>>0):this.high*Et+(this.low>>>0)},e.prototype.toBigInt=function(){return BigInt(this.toString())},e.prototype.toBytes=function(t){return t?this.toBytesLE():this.toBytesBE()},e.prototype.toBytesLE=function(){var t=this.high,r=this.low;return[r&255,r>>>8&255,r>>>16&255,r>>>24,t&255,t>>>8&255,t>>>16&255,t>>>24]},e.prototype.toBytesBE=function(){var t=this.high,r=this.low;return[t>>>24,t>>>16&255,t>>>8&255,t&255,r>>>24,r>>>16&255,r>>>8&255,r&255]},e.prototype.toSigned=function(){return this.unsigned?e.fromBits(this.low,this.high,!1):this},e.prototype.toString=function(t){if(t=t||10,t<2||36<t)throw RangeError("radix");if(this.isZero())return"0";if(this.isNegative())if(this.eq(e.MIN_VALUE)){var r=e.fromNumber(t),n=this.div(r),i=n.mul(r).sub(this);return n.toString(t)+i.toInt().toString(t)}else return"-"+this.neg().toString(t);for(var o=e.fromNumber(Math.pow(t,6),this.unsigned),a=this,l="";;){var p=a.div(o),c=a.sub(p.mul(o)).toInt()>>>0,g=c.toString(t);if(a=p,a.isZero())return g+l;for(;g.length<6;)g="0"+g;l=""+g+l}},e.prototype.toUnsigned=function(){return this.unsigned?this:e.fromBits(this.low,this.high,!0)},e.prototype.xor=function(t){return e.isLong(t)||(t=e.fromValue(t)),e.fromBits(this.low^t.low,this.high^t.high,this.unsigned)},e.prototype.eqz=function(){return this.isZero()},e.prototype.le=function(t){return this.lessThanOrEqual(t)},e.prototype.toExtendedJSON=function(t){return t&&t.relaxed?this.toNumber():{$numberLong:this.toString()}},e.fromExtendedJSON=function(t,r){var n=e.fromString(t.$numberLong);return r&&r.relaxed?n.toNumber():n},e.prototype[Symbol.for("nodejs.util.inspect.custom")]=function(){return this.inspect()},e.prototype.inspect=function(){return'new Long("'.concat(this.toString(),'"').concat(this.unsigned?", true":"",")")},e.TWO_PWR_24=e.fromInt(Ba),e.MAX_UNSIGNED_VALUE=e.fromBits(-1,-1,!0),e.ZERO=e.fromInt(0),e.UZERO=e.fromInt(0,!0),e.ONE=e.fromInt(1),e.UONE=e.fromInt(1,!0),e.NEG_ONE=e.fromInt(-1),e.MAX_VALUE=e.fromBits(-1,2147483647,!1),e.MIN_VALUE=e.fromBits(0,-2147483648,!1),e}();Object.defineProperty(C.prototype,"__isLong__",{value:!0});Object.defineProperty(C.prototype,"_bsontype",{value:"Long"});var Pa=/^(\+|-)?(\d+|(\d*\.\d*))?(E|e)?([-+])?(\d+)?$/,$a=/^(\+|-)?(Infinity|inf)$/i,Ma=/^(\+|-)?NaN$/i,Pt=6111,zr=-6176,ai=6176,Fa=34,Qr=[124,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0].reverse(),ui=[248,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0].reverse(),ci=[120,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0].reverse(),Ua=/^([-+])?(\d+)?$/,ja=31,fi=16383,Wa=30,Ga=31;function hi(e){return!isNaN(parseInt(e,10))}function Ha(e){var t=C.fromNumber(1e9),r=C.fromNumber(0);if(!e.parts[0]&&!e.parts[1]&&!e.parts[2]&&!e.parts[3])return{quotient:e,rem:r};for(var n=0;n<=3;n++)r=r.shiftLeft(32),r=r.add(new C(e.parts[n],0)),e.parts[n]=r.div(t).low,r=r.modulo(t);return{quotient:e,rem:r}}function qa(e,t){if(!e&&!t)return{high:C.fromNumber(0),low:C.fromNumber(0)};var r=e.shiftRightUnsigned(32),n=new C(e.getLowBits(),0),i=t.shiftRightUnsigned(32),o=new C(t.getLowBits(),0),a=r.multiply(i),l=r.multiply(o),p=n.multiply(i),c=n.multiply(o);return a=a.add(l.shiftRightUnsigned(32)),l=new C(l.getLowBits(),0).add(p).add(c.shiftRightUnsigned(32)),a=a.add(l.shiftRightUnsigned(32)),c=l.shiftLeft(32).add(new C(c.getLowBits(),0)),{high:a,low:c}}function Va(e,t){var r=e.high>>>0,n=t.high>>>0;if(r<n)return!0;if(r===n){var i=e.low>>>0,o=t.low>>>0;if(i<o)return!0}return!1}function vt(e,t){throw new Y('"'.concat(e,'" is not a valid Decimal128 string - ').concat(t))}var _n=function(){function e(t){if(!(this instanceof e))return new e(t);if(typeof t=="string")this.bytes=e.fromString(t).bytes;else if(wn(t)){if(t.byteLength!==16)throw new Y("Decimal128 must take a Buffer of 16 bytes");this.bytes=t}else throw new Y("Decimal128 must take a Buffer or string")}return e.fromString=function(t){var r=!1,n=!1,i=!1,o=0,a=0,l=0,p=0,c=0,g=[0],m=0,_=0,I=0,T=0,N=0,D=0,x=new C(0,0),P=new C(0,0),G=0,O=0;if(t.length>=7e3)throw new Y(""+t+" not a valid Decimal128 string");var q=t.match(Pa),$=t.match($a),K=t.match(Ma);if(!q&&!$&&!K||t.length===0)throw new Y(""+t+" not a valid Decimal128 string");if(q){var ie=q[2],xe=q[4],Me=q[5],Re=q[6];xe&&Re===void 0&&vt(t,"missing exponent power"),xe&&ie===void 0&&vt(t,"missing exponent base"),xe===void 0&&(Me||Re)&&vt(t,"missing e before exponent")}if((t[O]==="+"||t[O]==="-")&&(r=t[O++]==="-"),!hi(t[O])&&t[O]!=="."){if(t[O]==="i"||t[O]==="I")return new e(j.from(r?ui:ci));if(t[O]==="N")return new e(j.from(Qr))}for(;hi(t[O])||t[O]===".";){if(t[O]==="."){n&&vt(t,"contains multiple periods"),n=!0,O=O+1;continue}m<34&&(t[O]!=="0"||i)&&(i||(c=a),i=!0,g[_++]=parseInt(t[O],10),m=m+1),i&&(l=l+1),n&&(p=p+1),a=a+1,O=O+1}if(n&&!a)throw new Y(""+t+" not a valid Decimal128 string");if(t[O]==="e"||t[O]==="E"){var ge=t.substr(++O).match(Ua);if(!ge||!ge[2])return new e(j.from(Qr));N=parseInt(ge[0],10),O=O+ge[0].length}if(t[O])return new e(j.from(Qr));if(I=0,!m)I=0,T=0,g[0]=0,l=1,m=1,o=0;else if(T=m-1,o=l,o!==1)for(;g[c+o-1]===0;)o=o-1;for(N<=p&&p-N>16384?N=zr:N=N-p;N>Pt;){if(T=T+1,T-I>Fa){var X=g.join("");if(X.match(/^0+$/)){N=Pt;break}vt(t,"overflow")}N=N-1}for(;N<zr||m<l;){if(T===0&&o<m){N=zr,o=0;break}if(m<l?l=l-1:T=T-1,N<Pt)N=N+1;else{var X=g.join("");if(X.match(/^0+$/)){N=Pt;break}vt(t,"overflow")}}if(T-I+1<o){var Te=a;n&&(c=c+1,Te=Te+1),r&&(c=c+1,Te=Te+1);var Ye=parseInt(t[c+T+1],10),Ge=0;if(Ye>=5&&(Ge=1,Ye===5)){for(Ge=g[T]%2===1?1:0,D=c+T+2;D<Te;D++)if(parseInt(t[D],10)){Ge=1;break}}if(Ge){for(var k=T;k>=0;k--)if(++g[k]>9&&(g[k]=0,k===0))if(N<Pt)N=N+1,g[k]=1;else return new e(j.from(r?ui:ci))}}if(x=C.fromNumber(0),P=C.fromNumber(0),o===0)x=C.fromNumber(0),P=C.fromNumber(0);else if(T-I<17){var k=I;for(P=C.fromNumber(g[k++]),x=new C(0,0);k<=T;k++)P=P.multiply(C.fromNumber(10)),P=P.add(C.fromNumber(g[k]))}else{var k=I;for(x=C.fromNumber(g[k++]);k<=T-17;k++)x=x.multiply(C.fromNumber(10)),x=x.add(C.fromNumber(g[k]));for(P=C.fromNumber(g[k++]);k<=T;k++)P=P.multiply(C.fromNumber(10)),P=P.add(C.fromNumber(g[k]))}var ce=qa(x,C.fromString("100000000000000000"));ce.low=ce.low.add(P),Va(ce.low,P)&&(ce.high=ce.high.add(C.fromNumber(1))),G=N+ai;var F={low:C.fromNumber(0),high:C.fromNumber(0)};ce.high.shiftRightUnsigned(49).and(C.fromNumber(1)).equals(C.fromNumber(1))?(F.high=F.high.or(C.fromNumber(3).shiftLeft(61)),F.high=F.high.or(C.fromNumber(G).and(C.fromNumber(16383).shiftLeft(47))),F.high=F.high.or(ce.high.and(C.fromNumber(0x7fffffffffff)))):(F.high=F.high.or(C.fromNumber(G&16383).shiftLeft(49)),F.high=F.high.or(ce.high.and(C.fromNumber(562949953421311)))),F.low=ce.low,r&&(F.high=F.high.or(C.fromString("9223372036854775808")));var A=j.alloc(16);return O=0,A[O++]=F.low.low&255,A[O++]=F.low.low>>8&255,A[O++]=F.low.low>>16&255,A[O++]=F.low.low>>24&255,A[O++]=F.low.high&255,A[O++]=F.low.high>>8&255,A[O++]=F.low.high>>16&255,A[O++]=F.low.high>>24&255,A[O++]=F.high.low&255,A[O++]=F.high.low>>8&255,A[O++]=F.high.low>>16&255,A[O++]=F.high.low>>24&255,A[O++]=F.high.high&255,A[O++]=F.high.high>>8&255,A[O++]=F.high.high>>16&255,A[O++]=F.high.high>>24&255,new e(A)},e.prototype.toString=function(){for(var t,r=0,n=new Array(36),i=0;i<n.length;i++)n[i]=0;var o=0,a=!1,l,p={parts:[0,0,0,0]},c,g,m=[];o=0;var _=this.bytes,I=_[o++]|_[o++]<<8|_[o++]<<16|_[o++]<<24,T=_[o++]|_[o++]<<8|_[o++]<<16|_[o++]<<24,N=_[o++]|_[o++]<<8|_[o++]<<16|_[o++]<<24,D=_[o++]|_[o++]<<8|_[o++]<<16|_[o++]<<24;o=0;var x={low:new C(I,T),high:new C(N,D)};x.high.lessThan(C.ZERO)&&m.push("-");var P=D>>26&ja;if(P>>3===3){if(P===Wa)return m.join("")+"Infinity";if(P===Ga)return"NaN";t=D>>15&fi,l=8+(D>>14&1)}else l=D>>14&7,t=D>>17&fi;var G=t-ai;if(p.parts[0]=(D&16383)+((l&15)<<14),p.parts[1]=N,p.parts[2]=T,p.parts[3]=I,p.parts[0]===0&&p.parts[1]===0&&p.parts[2]===0&&p.parts[3]===0)a=!0;else for(g=3;g>=0;g--){var O=0,q=Ha(p);if(p=q.quotient,O=q.rem.low,!!O)for(c=8;c>=0;c--)n[g*9+c]=O%10,O=Math.floor(O/10)}if(a)r=1,n[o]=0;else for(r=36;!n[o];)r=r-1,o=o+1;var $=r-1+G;if($>=34||$<=-7||G>0){if(r>34)return m.push("".concat(0)),G>0?m.push("E+".concat(G)):G<0&&m.push("E".concat(G)),m.join("");m.push("".concat(n[o++])),r=r-1,r&&m.push(".");for(var i=0;i<r;i++)m.push("".concat(n[o++]));m.push("E"),$>0?m.push("+".concat($)):m.push("".concat($))}else if(G>=0)for(var i=0;i<r;i++)m.push("".concat(n[o++]));else{var K=r+G;if(K>0)for(var i=0;i<K;i++)m.push("".concat(n[o++]));else m.push("0");for(m.push(".");K++<0;)m.push("0");for(var i=0;i<r-Math.max(K-1,0);i++)m.push("".concat(n[o++]))}return m.join("")},e.prototype.toJSON=function(){return{$numberDecimal:this.toString()}},e.prototype.toExtendedJSON=function(){return{$numberDecimal:this.toString()}},e.fromExtendedJSON=function(t){return e.fromString(t.$numberDecimal)},e.prototype[Symbol.for("nodejs.util.inspect.custom")]=function(){return this.inspect()},e.prototype.inspect=function(){return'new Decimal128("'.concat(this.toString(),'")')},e}();Object.defineProperty(_n.prototype,"_bsontype",{value:"Decimal128"});var Sr=function(){function e(t){if(!(this instanceof e))return new e(t);t instanceof Number&&(t=t.valueOf()),this.value=+t}return e.prototype.valueOf=function(){return this.value},e.prototype.toJSON=function(){return this.value},e.prototype.toString=function(t){return this.value.toString(t)},e.prototype.toExtendedJSON=function(t){return t&&(t.legacy||t.relaxed&&isFinite(this.value))?this.value:Object.is(Math.sign(this.value),-0)?{$numberDouble:"-".concat(this.value.toFixed(1))}:{$numberDouble:Number.isInteger(this.value)?this.value.toFixed(1):this.value.toString()}},e.fromExtendedJSON=function(t,r){var n=parseFloat(t.$numberDouble);return r&&r.relaxed?n:new e(n)},e.prototype[Symbol.for("nodejs.util.inspect.custom")]=function(){return this.inspect()},e.prototype.inspect=function(){var t=this.toExtendedJSON();return"new Double(".concat(t.$numberDouble,")")},e}();Object.defineProperty(Sr.prototype,"_bsontype",{value:"Double"});var Ir=function(){function e(t){if(!(this instanceof e))return new e(t);t instanceof Number&&(t=t.valueOf()),this.value=+t|0}return e.prototype.valueOf=function(){return this.value},e.prototype.toString=function(t){return this.value.toString(t)},e.prototype.toJSON=function(){return this.value},e.prototype.toExtendedJSON=function(t){return t&&(t.relaxed||t.legacy)?this.value:{$numberInt:this.value.toString()}},e.fromExtendedJSON=function(t,r){return r&&r.relaxed?parseInt(t.$numberInt,10):new e(t.$numberInt)},e.prototype[Symbol.for("nodejs.util.inspect.custom")]=function(){return this.inspect()},e.prototype.inspect=function(){return"new Int32(".concat(this.valueOf(),")")},e}();Object.defineProperty(Ir.prototype,"_bsontype",{value:"Int32"});var vn=function(){function e(){if(!(this instanceof e))return new e}return e.prototype.toExtendedJSON=function(){return{$maxKey:1}},e.fromExtendedJSON=function(){return new e},e.prototype[Symbol.for("nodejs.util.inspect.custom")]=function(){return this.inspect()},e.prototype.inspect=function(){return"new MaxKey()"},e}();Object.defineProperty(vn.prototype,"_bsontype",{value:"MaxKey"});var bn=function(){function e(){if(!(this instanceof e))return new e}return e.prototype.toExtendedJSON=function(){return{$minKey:1}},e.fromExtendedJSON=function(){return new e},e.prototype[Symbol.for("nodejs.util.inspect.custom")]=function(){return this.inspect()},e.prototype.inspect=function(){return"new MinKey()"},e}();Object.defineProperty(bn.prototype,"_bsontype",{value:"MinKey"});var ka=new RegExp("^[0-9a-fA-F]{24}$"),rt=null,Ce=Symbol("id"),Ie=function(){function e(t){if(!(this instanceof e))return new e(t);var r;if(typeof t=="object"&&t&&"id"in t){if(typeof t.id!="string"&&!ArrayBuffer.isView(t.id))throw new Y("Argument passed in must have an id that is of type string or Buffer");"toHexString"in t&&typeof t.toHexString=="function"?r=j.from(t.toHexString(),"hex"):r=t.id}else r=t;if(r==null||typeof r=="number")this[Ce]=e.generate(typeof r=="number"?r:void 0);else if(ArrayBuffer.isView(r)&&r.byteLength===12)this[Ce]=r instanceof j?r:dr(r);else if(typeof r=="string")if(r.length===12){var n=j.from(r);if(n.byteLength===12)this[Ce]=n;else throw new Y("Argument passed in must be a string of 12 bytes")}else if(r.length===24&&ka.test(r))this[Ce]=j.from(r,"hex");else throw new Y("Argument passed in must be a string of 12 bytes or a string of 24 hex characters or an integer");else throw new Y("Argument passed in does not match the accepted types");e.cacheHexString&&(this.__id=this.id.toString("hex"))}return Object.defineProperty(e.prototype,"id",{get:function(){return this[Ce]},set:function(t){this[Ce]=t,e.cacheHexString&&(this.__id=t.toString("hex"))},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"generationTime",{get:function(){return this.id.readInt32BE(0)},set:function(t){this.id.writeUInt32BE(t,0)},enumerable:!1,configurable:!0}),e.prototype.toHexString=function(){if(e.cacheHexString&&this.__id)return this.__id;var t=this.id.toString("hex");return e.cacheHexString&&!this.__id&&(this.__id=t),t},e.getInc=function(){return e.index=(e.index+1)%16777215},e.generate=function(t){typeof t!="number"&&(t=Math.floor(Date.now()/1e3));var r=e.getInc(),n=j.alloc(12);return n.writeUInt32BE(t,0),rt===null&&(rt=Vi(5)),n[4]=rt[0],n[5]=rt[1],n[6]=rt[2],n[7]=rt[3],n[8]=rt[4],n[11]=r&255,n[10]=r>>8&255,n[9]=r>>16&255,n},e.prototype.toString=function(t){return t?this.id.toString(t):this.toHexString()},e.prototype.toJSON=function(){return this.toHexString()},e.prototype.equals=function(t){if(t==null)return!1;if(t instanceof e)return this[Ce][11]===t[Ce][11]&&this[Ce].equals(t[Ce]);if(typeof t=="string"&&e.isValid(t)&&t.length===12&&wn(this.id))return t===j.prototype.toString.call(this.id,"latin1");if(typeof t=="string"&&e.isValid(t)&&t.length===24)return t.toLowerCase()===this.toHexString();if(typeof t=="string"&&e.isValid(t)&&t.length===12)return j.from(t).equals(this.id);if(typeof t=="object"&&"toHexString"in t&&typeof t.toHexString=="function"){var r=t.toHexString(),n=this.toHexString().toLowerCase();return typeof r=="string"&&r.toLowerCase()===n}return!1},e.prototype.getTimestamp=function(){var t=new Date,r=this.id.readUInt32BE(0);return t.setTime(Math.floor(r)*1e3),t},e.createPk=function(){return new e},e.createFromTime=function(t){var r=j.from([0,0,0,0,0,0,0,0,0,0,0,0]);return r.writeUInt32BE(t,0),new e(r)},e.createFromHexString=function(t){if(typeof t>"u"||t!=null&&t.length!==24)throw new Y("Argument passed in must be a single String of 12 bytes or a string of 24 hex characters");return new e(j.from(t,"hex"))},e.isValid=function(t){if(t==null)return!1;try{return new e(t),!0}catch{return!1}},e.prototype.toExtendedJSON=function(){return this.toHexString?{$oid:this.toHexString()}:{$oid:this.toString("hex")}},e.fromExtendedJSON=function(t){return new e(t.$oid)},e.prototype[Symbol.for("nodejs.util.inspect.custom")]=function(){return this.inspect()},e.prototype.inspect=function(){return'new ObjectId("'.concat(this.toHexString(),'")')},e.index=Math.floor(Math.random()*16777215),e}();Object.defineProperty(Ie.prototype,"generate",{value:br(function(e){return Ie.generate(e)},"Please use the static `ObjectId.generate(time)` instead")});Object.defineProperty(Ie.prototype,"getInc",{value:br(function(){return Ie.getInc()},"Please use the static `ObjectId.getInc()` instead")});Object.defineProperty(Ie.prototype,"get_inc",{value:br(function(){return Ie.getInc()},"Please use the static `ObjectId.getInc()` instead")});Object.defineProperty(Ie,"get_inc",{value:br(function(){return Ie.getInc()},"Please use the static `ObjectId.getInc()` instead")});Object.defineProperty(Ie.prototype,"_bsontype",{value:"ObjectID"});function Ja(e){return e.split("").sort().join("")}var Gt=function(){function e(t,r){if(!(this instanceof e))return new e(t,r);if(this.pattern=t,this.options=Ja(r??""),this.pattern.indexOf("\0")!==-1)throw new ut("BSON Regex patterns cannot contain null bytes, found: ".concat(JSON.stringify(this.pattern)));if(this.options.indexOf("\0")!==-1)throw new ut("BSON Regex options cannot contain null bytes, found: ".concat(JSON.stringify(this.options)));for(var n=0;n<this.options.length;n++)if(!(this.options[n]==="i"||this.options[n]==="m"||this.options[n]==="x"||this.options[n]==="l"||this.options[n]==="s"||this.options[n]==="u"))throw new ut("The regular expression option [".concat(this.options[n],"] is not supported"))}return e.parseOptions=function(t){return t?t.split("").sort().join(""):""},e.prototype.toExtendedJSON=function(t){return t=t||{},t.legacy?{$regex:this.pattern,$options:this.options}:{$regularExpression:{pattern:this.pattern,options:this.options}}},e.fromExtendedJSON=function(t){if("$regex"in t)if(typeof t.$regex!="string"){if(t.$regex._bsontype==="BSONRegExp")return t}else return new e(t.$regex,e.parseOptions(t.$options));if("$regularExpression"in t)return new e(t.$regularExpression.pattern,e.parseOptions(t.$regularExpression.options));throw new Y("Unexpected BSONRegExp EJSON object form: ".concat(JSON.stringify(t)))},e}();Object.defineProperty(Gt.prototype,"_bsontype",{value:"BSONRegExp"});var En=function(){function e(t){if(!(this instanceof e))return new e(t);this.value=t}return e.prototype.valueOf=function(){return this.value},e.prototype.toString=function(){return this.value},e.prototype.inspect=function(){return'new BSONSymbol("'.concat(this.value,'")')},e.prototype.toJSON=function(){return this.value},e.prototype.toExtendedJSON=function(){return{$symbol:this.value}},e.fromExtendedJSON=function(t){return new e(t.$symbol)},e.prototype[Symbol.for("nodejs.util.inspect.custom")]=function(){return this.inspect()},e}();Object.defineProperty(En.prototype,"_bsontype",{value:"Symbol"});var Ka=C,Yi=function(e){vr(t,e);function t(r,n){var i=this;return i instanceof t?(C.isLong(r)?i=e.call(this,r.low,r.high,!0)||this:Vt(r)&&typeof r.t<"u"&&typeof r.i<"u"?i=e.call(this,r.i,r.t,!0)||this:i=e.call(this,r,n,!0)||this,Object.defineProperty(i,"_bsontype",{value:"Timestamp",writable:!1,configurable:!1,enumerable:!1}),i):new t(r,n)}return t.prototype.toJSON=function(){return{$timestamp:this.toString()}},t.fromInt=function(r){return new t(C.fromInt(r,!0))},t.fromNumber=function(r){return new t(C.fromNumber(r,!0))},t.fromBits=function(r,n){return new t(r,n)},t.fromString=function(r,n){return new t(C.fromString(r,!0,n))},t.prototype.toExtendedJSON=function(){return{$timestamp:{t:this.high>>>0,i:this.low>>>0}}},t.fromExtendedJSON=function(r){return new t(r.$timestamp)},t.prototype[Symbol.for("nodejs.util.inspect.custom")]=function(){return this.inspect()},t.prototype.inspect=function(){return"new Timestamp({ t: ".concat(this.getHighBits(),", i: ").concat(this.getLowBits()," })")},t.MAX_VALUE=C.MAX_UNSIGNED_VALUE,t}(Ka);function Ya(e){return Vt(e)&&Reflect.has(e,"_bsontype")&&typeof e._bsontype=="string"}var Xi=2147483647,Zi=-2147483648,zi=9223372036854776e3,Qi=-9223372036854776e3,Xa={$oid:Ie,$binary:ct,$uuid:ct,$symbol:En,$numberInt:Ir,$numberDecimal:_n,$numberDouble:Sr,$numberLong:C,$minKey:bn,$maxKey:vn,$regex:Gt,$regularExpression:Gt,$timestamp:Yi};function eo(e,t){if(t===void 0&&(t={}),typeof e=="number"){if(t.relaxed||t.legacy)return e;if(Math.floor(e)===e){if(e>=Zi&&e<=Xi)return new Ir(e);if(e>=Qi&&e<=zi)return C.fromNumber(e)}return new Sr(e)}if(e==null||typeof e!="object")return e;if(e.$undefined)return null;for(var r=Object.keys(e).filter(function(m){return m.startsWith("$")&&e[m]!=null}),n=0;n<r.length;n++){var i=Xa[r[n]];if(i)return i.fromExtendedJSON(e,t)}if(e.$date!=null){var o=e.$date,a=new Date;return t.legacy?typeof o=="number"?a.setTime(o):typeof o=="string"&&a.setTime(Date.parse(o)):typeof o=="string"?a.setTime(Date.parse(o)):C.isLong(o)?a.setTime(o.toNumber()):typeof o=="number"&&t.relaxed&&a.setTime(o),a}if(e.$code!=null){var l=Object.assign({},e);return e.$scope&&(l.$scope=eo(e.$scope)),Er.fromExtendedJSON(e)}if(La(e)||e.$dbPointer){var p=e.$ref?e:e.$dbPointer;if(p instanceof Wt)return p;var c=Object.keys(p).filter(function(m){return m.startsWith("$")}),g=!0;if(c.forEach(function(m){["$ref","$id","$db"].indexOf(m)===-1&&(g=!1)}),g)return Wt.fromExtendedJSON(p)}return e}function Za(e,t){return e.map(function(r,n){t.seenObjects.push({propertyName:"index ".concat(n),obj:null});try{return He(r,t)}finally{t.seenObjects.pop()}})}function li(e){var t=e.toISOString();return e.getUTCMilliseconds()!==0?t:t.slice(0,-5)+"Z"}function He(e,t){if((typeof e=="object"||typeof e=="function")&&e!==null){var r=t.seenObjects.findIndex(function(x){return x.obj===e});if(r!==-1){var n=t.seenObjects.map(function(x){return x.propertyName}),i=n.slice(0,r).map(function(x){return"".concat(x," -> ")}).join(""),o=n[r],a=" -> "+n.slice(r+1,n.length-1).map(function(x){return"".concat(x," -> ")}).join(""),l=n[n.length-1],p=" ".repeat(i.length+o.length/2),c="-".repeat(a.length+(o.length+l.length)/2-1);throw new Y(`Converting circular structure to EJSON:
`+"    ".concat(i).concat(o).concat(a).concat(l,`
`)+"    ".concat(p,"\\").concat(c,"/"))}t.seenObjects[t.seenObjects.length-1].obj=e}if(Array.isArray(e))return Za(e,t);if(e===void 0)return null;if(e instanceof Date||Aa(e)){var g=e.getTime(),m=g>-1&&g<2534023188e5;return t.legacy?t.relaxed&&m?{$date:e.getTime()}:{$date:li(e)}:t.relaxed&&m?{$date:li(e)}:{$date:{$numberLong:e.getTime().toString()}}}if(typeof e=="number"&&(!t.relaxed||!isFinite(e))){if(Math.floor(e)===e){var _=e>=Zi&&e<=Xi,I=e>=Qi&&e<=zi;if(_)return{$numberInt:e.toString()};if(I)return{$numberLong:e.toString()}}return{$numberDouble:e.toString()}}if(e instanceof RegExp||Oa(e)){var T=e.flags;if(T===void 0){var N=e.toString().match(/[gimuy]*$/);N&&(T=N[0])}var D=new Gt(e.source,T);return D.toExtendedJSON(t)}return e!=null&&typeof e=="object"?Qa(e,t):e}var za={Binary:function(e){return new ct(e.value(),e.sub_type)},Code:function(e){return new Er(e.code,e.scope)},DBRef:function(e){return new Wt(e.collection||e.namespace,e.oid,e.db,e.fields)},Decimal128:function(e){return new _n(e.bytes)},Double:function(e){return new Sr(e.value)},Int32:function(e){return new Ir(e.value)},Long:function(e){return C.fromBits(e.low!=null?e.low:e.low_,e.low!=null?e.high:e.high_,e.low!=null?e.unsigned:e.unsigned_)},MaxKey:function(){return new vn},MinKey:function(){return new bn},ObjectID:function(e){return new Ie(e)},ObjectId:function(e){return new Ie(e)},BSONRegExp:function(e){return new Gt(e.pattern,e.options)},Symbol:function(e){return new En(e.value)},Timestamp:function(e){return Yi.fromBits(e.low,e.high)}};function Qa(e,t){if(e==null||typeof e!="object")throw new ut("not an object instance");var r=e._bsontype;if(typeof r>"u"){var n={};for(var i in e){t.seenObjects.push({propertyName:i,obj:null});try{var o=He(e[i],t);i==="__proto__"?Object.defineProperty(n,i,{value:o,writable:!0,enumerable:!0,configurable:!0}):n[i]=o}finally{t.seenObjects.pop()}}return n}else if(Ya(e)){var a=e;if(typeof a.toExtendedJSON!="function"){var l=za[e._bsontype];if(!l)throw new Y("Unrecognized or invalid _bsontype: "+e._bsontype);a=l(a)}return r==="Code"&&a.scope?a=new Er(a.code,He(a.scope,t)):r==="DBRef"&&a.oid&&(a=new Wt(He(a.collection,t),He(a.oid,t),He(a.db,t),He(a.fields,t))),a.toExtendedJSON(t)}else throw new ut("_bsontype must be a string, but was: "+typeof r)}var he;(function(e){function t(o,a){var l=Object.assign({},{relaxed:!0,legacy:!1},a);return typeof l.relaxed=="boolean"&&(l.strict=!l.relaxed),typeof l.strict=="boolean"&&(l.relaxed=!l.strict),JSON.parse(o,function(p,c){if(p.indexOf("\0")!==-1)throw new ut("BSON Document field names cannot contain null bytes, found: ".concat(JSON.stringify(p)));return eo(c,l)})}e.parse=t;function r(o,a,l,p){l!=null&&typeof l=="object"&&(p=l,l=0),a!=null&&typeof a=="object"&&!Array.isArray(a)&&(p=a,a=void 0,l=0);var c=Object.assign({relaxed:!0,legacy:!1},p,{seenObjects:[{propertyName:"(root)",obj:null}]}),g=He(o,c);return JSON.stringify(g,a,l)}e.stringify=r;function n(o,a){return a=a||{},JSON.parse(r(o,a))}e.serialize=n;function i(o,a){return a=a||{},t(JSON.stringify(o),a)}e.deserialize=i})(he||(he={}));var di=qi();di.Map?di.Map:function(){function e(t){t===void 0&&(t=[]),this._keys=[],this._values={};for(var r=0;r<t.length;r++)if(t[r]!=null){var n=t[r],i=n[0],o=n[1];this._keys.push(i),this._values[i]={v:o,i:this._keys.length-1}}}return e.prototype.clear=function(){this._keys=[],this._values={}},e.prototype.delete=function(t){var r=this._values[t];return r==null?!1:(delete this._values[t],this._keys.splice(r.i,1),!0)},e.prototype.entries=function(){var t=this,r=0;return{next:function(){var n=t._keys[r++];return{value:n!==void 0?[n,t._values[n].v]:void 0,done:n===void 0}}}},e.prototype.forEach=function(t,r){r=r||this;for(var n=0;n<this._keys.length;n++){var i=this._keys[n];t.call(r,this._values[i].v,i,r)}},e.prototype.get=function(t){return this._values[t]?this._values[t].v:void 0},e.prototype.has=function(t){return this._values[t]!=null},e.prototype.keys=function(){var t=this,r=0;return{next:function(){var n=t._keys[r++];return{value:n!==void 0?n:void 0,done:n===void 0}}}},e.prototype.set=function(t,r){return this._values[t]?(this._values[t].v=r,this):(this._keys.push(t),this._values[t]={v:r,i:this._keys.length-1},this)},e.prototype.values=function(){var t=this,r=0;return{next:function(){var n=t._keys[r++];return{value:n!==void 0?t._values[n].v:void 0,done:n===void 0}}}},Object.defineProperty(e.prototype,"size",{get:function(){return this._keys.length},enumerable:!1,configurable:!0}),e}();C.fromNumber(Ca);C.fromNumber(Da);var en=new Uint8Array(8);new DataView(en.buffer,en.byteOffset,en.byteLength);var eu=1024*1024*17;j.alloc(eu);var tu=function(e,t,r,n){function i(o){return o instanceof r?o:new r(function(a){a(o)})}return new(r||(r=Promise))(function(o,a){function l(g){try{c(n.next(g))}catch(m){a(m)}}function p(g){try{c(n.throw(g))}catch(m){a(m)}}function c(g){g.done?o(g.value):i(g.value).then(l,p)}c((n=n.apply(e,t||[])).next())})},ru=function(e,t){var r={label:0,sent:function(){if(o[0]&1)throw o[1];return o[1]},trys:[],ops:[]},n,i,o,a;return a={next:l(0),throw:l(1),return:l(2)},typeof Symbol=="function"&&(a[Symbol.iterator]=function(){return this}),a;function l(c){return function(g){return p([c,g])}}function p(c){if(n)throw new TypeError("Generator is already executing.");for(;r;)try{if(n=1,i&&(o=c[0]&2?i.return:c[0]?i.throw||((o=i.return)&&o.call(i),0):i.next)&&!(o=o.call(i,c[1])).done)return o;switch(i=0,o&&(c=[c[0]&2,o.value]),c[0]){case 0:case 1:o=c;break;case 4:return r.label++,{value:c[1],done:!1};case 5:r.label++,i=c[1],c=[0];continue;case 7:c=r.ops.pop(),r.trys.pop();continue;default:if(o=r.trys,!(o=o.length>0&&o[o.length-1])&&(c[0]===6||c[0]===2)){r=0;continue}if(c[0]===3&&(!o||c[1]>o[0]&&c[1]<o[3])){r.label=c[1];break}if(c[0]===6&&r.label<o[1]){r.label=o[1],o=c;break}if(o&&r.label<o[2]){r.label=o[2],r.ops.push(c);break}o[2]&&r.ops.pop(),r.trys.pop();continue}c=t.call(e,r)}catch(g){c=[6,g],i=0}finally{n=o=0}if(c[0]&5)throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}},to=function(){function e(t,r){this._stages=[],t&&r&&(this._db=t,this._request=new ne.reqClass(this._db.config),this._collectionName=r)}return e.prototype.end=function(){return tu(this,void 0,void 0,function(){var t;return ru(this,function(r){switch(r.label){case 0:if(!this._collectionName||!this._db)throw new Error("Aggregation pipeline cannot send request");return[4,this._request.send("database.aggregate",{collectionName:this._collectionName,stages:this._stages})];case 1:return t=r.sent(),t&&t.data&&t.data.list?[2,{requestId:t.requestId,data:JSON.parse(t.data.list).map(he.parse)}]:[2,t]}})})},e.prototype.unwrap=function(){return this._stages},e.prototype.done=function(){return this._stages.map(function(t){var r,n=t.stageKey,i=t.stageValue;return r={},r[n]=JSON.parse(i),r})},e.prototype._pipe=function(t,r){return this._stages.push({stageKey:"$"+t,stageValue:JSON.stringify(r)}),this},e.prototype.addFields=function(t){return this._pipe("addFields",t)},e.prototype.bucket=function(t){return this._pipe("bucket",t)},e.prototype.bucketAuto=function(t){return this._pipe("bucketAuto",t)},e.prototype.count=function(t){return this._pipe("count",t)},e.prototype.geoNear=function(t){return this._pipe("geoNear",t)},e.prototype.group=function(t){return this._pipe("group",t)},e.prototype.limit=function(t){return this._pipe("limit",t)},e.prototype.match=function(t){return this._pipe("match",hn.encode(t))},e.prototype.project=function(t){return this._pipe("project",t)},e.prototype.lookup=function(t){return this._pipe("lookup",t)},e.prototype.replaceRoot=function(t){return this._pipe("replaceRoot",t)},e.prototype.sample=function(t){return this._pipe("sample",t)},e.prototype.skip=function(t){return this._pipe("skip",t)},e.prototype.sort=function(t){return this._pipe("sort",t)},e.prototype.sortByCount=function(t){return this._pipe("sortByCount",t)},e.prototype.unwind=function(t){return this._pipe("unwind",t)},e}(),nu=function(){var e=function(t,r){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,i){n.__proto__=i}||function(n,i){for(var o in i)i.hasOwnProperty(o)&&(n[o]=i[o])},e(t,r)};return function(t,r){e(t,r);function n(){this.constructor=t}t.prototype=r===null?Object.create(r):(n.prototype=r.prototype,new n)}}(),iu=function(e){nu(t,e);function t(r,n){return e.call(this,r,n)||this}return Object.defineProperty(t.prototype,"name",{get:function(){return this._coll},enumerable:!0,configurable:!0}),t.prototype.doc=function(r){if(typeof r!="string"&&typeof r!="number")throw new Error("docId必须为字符串或数字");return new ei(this._db,this._coll,r)},t.prototype.add=function(r,n){var i=new ei(this._db,this._coll,void 0);return i.create(r,n)},t.prototype.aggregate=function(){return new to(this._db,this._coll)},t}(ca),ou={eq:function(e){return new ee(L.EQ,[e])},neq:function(e){return new ee(L.NEQ,[e])},lt:function(e){return new ee(L.LT,[e])},lte:function(e){return new ee(L.LTE,[e])},gt:function(e){return new ee(L.GT,[e])},gte:function(e){return new ee(L.GTE,[e])},in:function(e){return new ee(L.IN,e)},nin:function(e){return new ee(L.NIN,e)},all:function(e){return new ee(L.ALL,e)},elemMatch:function(e){return new ee(L.ELEM_MATCH,[e])},exists:function(e){return new ee(L.EXISTS,[e])},size:function(e){return new ee(L.SIZE,[e])},mod:function(e){return new ee(L.MOD,[e])},geoNear:function(e){return new ee(L.GEO_NEAR,[e])},geoWithin:function(e){return new ee(L.GEO_WITHIN,[e])},geoIntersects:function(e){return new ee(L.GEO_INTERSECTS,[e])},and:function(){var e=z(arguments[0])?arguments[0]:Array.from(arguments);return new st(de.AND,e)},nor:function(){var e=z(arguments[0])?arguments[0]:Array.from(arguments);return new st(de.NOR,e)},or:function(){var e=z(arguments[0])?arguments[0]:Array.from(arguments);return new st(de.OR,e)},not:function(){var e=z(arguments[0])?arguments[0]:Array.from(arguments);return new st(de.NOT,e)},set:function(e){return new Q(M.SET,[e])},remove:function(){return new Q(M.REMOVE,[])},inc:function(e){return new Q(M.INC,[e])},mul:function(e){return new Q(M.MUL,[e])},push:function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var r;if(ke(e[0])&&e[0].hasOwnProperty("each")){var n=e[0];r={$each:n.each,$position:n.position,$sort:n.sort,$slice:n.slice}}else z(e[0])?r=e[0]:r=Array.from(e);return new Q(M.PUSH,r)},pull:function(e){return new Q(M.PULL,e)},pullAll:function(e){return new Q(M.PULL_ALL,e)},pop:function(){return new Q(M.POP,[])},shift:function(){return new Q(M.SHIFT,[])},unshift:function(){var e=z(arguments[0])?arguments[0]:Array.from(arguments);return new Q(M.UNSHIFT,e)},addToSet:function(e){return new Q(M.ADD_TO_SET,e)},rename:function(e){return new Q(M.RENAME,[e])},bit:function(e){return new Q(M.BIT,[e])},max:function(e){return new Q(M.MAX,[e])},min:function(e){return new Q(M.MIN,[e])},expr:function(e){return{$expr:e}},jsonSchema:function(e){return{$jsonSchema:e}},text:function(e){return ta(e)?{$search:e.search}:{$search:e.search,$language:e.language,$caseSensitive:e.caseSensitive,$diacriticSensitive:e.diacriticSensitive}},aggregate:{pipeline:function(){return new to},abs:function(e){return new S("abs",e)},add:function(e){return new S("add",e)},ceil:function(e){return new S("ceil",e)},divide:function(e){return new S("divide",e)},exp:function(e){return new S("exp",e)},floor:function(e){return new S("floor",e)},ln:function(e){return new S("ln",e)},log:function(e){return new S("log",e)},log10:function(e){return new S("log10",e)},mod:function(e){return new S("mod",e)},multiply:function(e){return new S("multiply",e)},pow:function(e){return new S("pow",e)},sqrt:function(e){return new S("sqrt",e)},subtract:function(e){return new S("subtract",e)},trunc:function(e){return new S("trunc",e)},arrayElemAt:function(e){return new S("arrayElemAt",e)},arrayToObject:function(e){return new S("arrayToObject",e)},concatArrays:function(e){return new S("concatArrays",e)},filter:function(e){return new S("filter",e)},in:function(e){return new S("in",e)},indexOfArray:function(e){return new S("indexOfArray",e)},isArray:function(e){return new S("isArray",e)},map:function(e){return new S("map",e)},range:function(e){return new S("range",e)},reduce:function(e){return new S("reduce",e)},reverseArray:function(e){return new S("reverseArray",e)},size:function(e){return new S("size",e)},slice:function(e){return new S("slice",e)},zip:function(e){return new S("zip",e)},and:function(e){return new S("and",e)},not:function(e){return new S("not",e)},or:function(e){return new S("or",e)},cmp:function(e){return new S("cmp",e)},eq:function(e){return new S("eq",e)},gt:function(e){return new S("gt",e)},gte:function(e){return new S("gte",e)},lt:function(e){return new S("lt",e)},lte:function(e){return new S("lte",e)},neq:function(e){return new S("ne",e)},cond:function(e){return new S("cond",e)},ifNull:function(e){return new S("ifNull",e)},switch:function(e){return new S("switch",e)},dateFromParts:function(e){return new S("dateFromParts",e)},dateFromString:function(e){return new S("dateFromString",e)},dayOfMonth:function(e){return new S("dayOfMonth",e)},dayOfWeek:function(e){return new S("dayOfWeek",e)},dayOfYear:function(e){return new S("dayOfYear",e)},isoDayOfWeek:function(e){return new S("isoDayOfWeek",e)},isoWeek:function(e){return new S("isoWeek",e)},isoWeekYear:function(e){return new S("isoWeekYear",e)},millisecond:function(e){return new S("millisecond",e)},minute:function(e){return new S("minute",e)},month:function(e){return new S("month",e)},second:function(e){return new S("second",e)},hour:function(e){return new S("hour",e)},week:function(e){return new S("week",e)},year:function(e){return new S("year",e)},literal:function(e){return new S("literal",e)},mergeObjects:function(e){return new S("mergeObjects",e)},objectToArray:function(e){return new S("objectToArray",e)},allElementsTrue:function(e){return new S("allElementsTrue",e)},anyElementTrue:function(e){return new S("anyElementTrue",e)},setDifference:function(e){return new S("setDifference",e)},setEquals:function(e){return new S("setEquals",e)},setIntersection:function(e){return new S("setIntersection",e)},setIsSubset:function(e){return new S("setIsSubset",e)},setUnion:function(e){return new S("setUnion",e)},concat:function(e){return new S("concat",e)},dateToString:function(e){return new S("dateToString",e)},indexOfBytes:function(e){return new S("indexOfBytes",e)},indexOfCP:function(e){return new S("indexOfCP",e)},split:function(e){return new S("split",e)},strLenBytes:function(e){return new S("strLenBytes",e)},strLenCP:function(e){return new S("strLenCP",e)},strcasecmp:function(e){return new S("strcasecmp",e)},substr:function(e){return new S("substr",e)},substrBytes:function(e){return new S("substrBytes",e)},substrCP:function(e){return new S("substrCP",e)},toLower:function(e){return new S("toLower",e)},toUpper:function(e){return new S("toUpper",e)},meta:function(e){return new S("meta",e)},addToSet:function(e){return new S("addToSet",e)},avg:function(e){return new S("avg",e)},first:function(e){return new S("first",e)},last:function(e){return new S("last",e)},max:function(e){return new S("max",e)},min:function(e){return new S("min",e)},push:function(e){return new S("push",e)},stdDevPop:function(e){return new S("stdDevPop",e)},stdDevSamp:function(e){return new S("stdDevSamp",e)},sum:function(e){return new S("sum",e)},let:function(e){return new S("let",e)}},project:{slice:function(e){return new pi("slice",e)},elemMatch:function(e){return new pi("elemMatch",e)}}},S=function(){function e(t,r){this["$"+t]=r}return e}(),pi=function(){function e(t,r){this["$"+t]=r}return e}(),su=function(){function e(t){var r=t.regexp,n=t.options;if(!r)throw new TypeError("regexp must be a string");this.$regex=r,this.$options=n}return e.prototype.parse=function(){return{$regex:this.$regex,$options:this.$options}},Object.defineProperty(e.prototype,"_internalType",{get:function(){return $i},enumerable:!0,configurable:!0}),e}();function au(e){return new su(e)}var ro={CREATE_WATCH_NET_ERROR:{code:"CREATE_WATCH_NET_ERROR",message:"create watch network error"},CREATE_WACTH_EXCEED_ERROR:{code:"CREATE_WACTH_EXCEED_ERROR",message:"maximum connections exceed"},CREATE_WATCH_SERVER_ERROR:{code:"CREATE_WATCH_SERVER_ERROR",message:"create watch server error"},CONN_ERROR:{code:"CONN_ERROR",message:"connection error"},INVALID_PARAM:{code:"INVALID_PARAM",message:"Invalid request param"},INSERT_DOC_FAIL:{code:"INSERT_DOC_FAIL",message:"insert document failed"},DATABASE_TRANSACTION_CONFLICT:{code:"DATABASE_TRANSACTION_CONFLICT",message:"database transaction conflict"}},De=function(){return De=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++){t=arguments[r];for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i])}return e},De.apply(this,arguments)},$t=function(e,t,r,n){function i(o){return o instanceof r?o:new r(function(a){a(o)})}return new(r||(r=Promise))(function(o,a){function l(g){try{c(n.next(g))}catch(m){a(m)}}function p(g){try{c(n.throw(g))}catch(m){a(m)}}function c(g){g.done?o(g.value):i(g.value).then(l,p)}c((n=n.apply(e,t||[])).next())})},Mt=function(e,t){var r={label:0,sent:function(){if(o[0]&1)throw o[1];return o[1]},trys:[],ops:[]},n,i,o,a;return a={next:l(0),throw:l(1),return:l(2)},typeof Symbol=="function"&&(a[Symbol.iterator]=function(){return this}),a;function l(c){return function(g){return p([c,g])}}function p(c){if(n)throw new TypeError("Generator is already executing.");for(;r;)try{if(n=1,i&&(o=c[0]&2?i.return:c[0]?i.throw||((o=i.return)&&o.call(i),0):i.next)&&!(o=o.call(i,c[1])).done)return o;switch(i=0,o&&(c=[c[0]&2,o.value]),c[0]){case 0:case 1:o=c;break;case 4:return r.label++,{value:c[1],done:!1};case 5:r.label++,i=c[1],c=[0];continue;case 7:c=r.ops.pop(),r.trys.pop();continue;default:if(o=r.trys,!(o=o.length>0&&o[o.length-1])&&(c[0]===6||c[0]===2)){r=0;continue}if(c[0]===3&&(!o||c[1]>o[0]&&c[1]<o[3])){r.label=c[1];break}if(c[0]===6&&r.label<o[1]){r.label=o[1],o=c;break}if(o&&r.label<o[2]){r.label=o[2],r.ops.push(c);break}o[2]&&r.ops.pop(),r.trys.pop();continue}c=t.call(e,r)}catch(g){c=[6,g],i=0}finally{n=o=0}if(c[0]&5)throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}},uu="database.getInTransaction",gi="database.updateDocInTransaction",cu="database.deleteDocInTransaction",fu="database.insertDocInTransaction",mi=function(){function e(t,r,n){this._coll=r,this.id=n,this._transaction=t,this._request=this._transaction.getRequestMethod(),this._transactionId=this._transaction.getTransactionId()}return e.prototype.create=function(t){return $t(this,void 0,void 0,function(){var r,n,i,o;return Mt(this,function(a){switch(a.label){case 0:return r={collectionName:this._coll,transactionId:this._transactionId,data:he.stringify(jt(t),{relaxed:!1})},this.id&&(r._id=this.id),[4,this._request.send(fu,r)];case 1:if(n=a.sent(),n.code)throw n;if(i=he.parse(n.inserted),o=he.parse(n.ok),o==1&&i==1)return[2,De(De({},n),{ok:o,inserted:i})];throw new Error(ro.INSERT_DOC_FAIL.message)}})})},e.prototype.get=function(){return $t(this,void 0,void 0,function(){var t,r;return Mt(this,function(n){switch(n.label){case 0:return t={collectionName:this._coll,transactionId:this._transactionId,query:{_id:{$eq:this.id}}},[4,this._request.send(uu,t)];case 1:if(r=n.sent(),r.code)throw r;return[2,{data:r.data!=="null"?wr.formatField(he.parse(r.data)):he.parse(r.data),requestId:r.requestId}]}})})},e.prototype.set=function(t){return $t(this,void 0,void 0,function(){var r,n;return Mt(this,function(i){switch(i.label){case 0:return r={collectionName:this._coll,transactionId:this._transactionId,query:{_id:{$eq:this.id}},data:he.stringify(jt(t),{relaxed:!1}),upsert:!0},[4,this._request.send(gi,r)];case 1:if(n=i.sent(),n.code)throw n;return[2,De(De({},n),{updated:he.parse(n.updated),upserted:n.upserted?JSON.parse(n.upserted):null})]}})})},e.prototype.update=function(t){return $t(this,void 0,void 0,function(){var r,n;return Mt(this,function(i){switch(i.label){case 0:return r={collectionName:this._coll,transactionId:this._transactionId,query:{_id:{$eq:this.id}},data:he.stringify(yn.encode(t),{relaxed:!1})},[4,this._request.send(gi,r)];case 1:if(n=i.sent(),n.code)throw n;return[2,De(De({},n),{updated:he.parse(n.updated)})]}})})},e.prototype.delete=function(){return $t(this,void 0,void 0,function(){var t,r;return Mt(this,function(n){switch(n.label){case 0:return t={collectionName:this._coll,transactionId:this._transactionId,query:{_id:{$eq:this.id}}},[4,this._request.send(cu,t)];case 1:if(r=n.sent(),r.code)throw r;return[2,De(De({},r),{deleted:he.parse(r.deleted)})]}})})},e}(),hu=function(){function e(t,r){this._coll=r,this._transaction=t}return e}(),lu=function(){var e=function(t,r){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,i){n.__proto__=i}||function(n,i){for(var o in i)i.hasOwnProperty(o)&&(n[o]=i[o])},e(t,r)};return function(t,r){e(t,r);function n(){this.constructor=t}t.prototype=r===null?Object.create(r):(n.prototype=r.prototype,new n)}}(),du=function(e){lu(t,e);function t(r,n){return e.call(this,r,n)||this}return Object.defineProperty(t.prototype,"name",{get:function(){return this._coll},enumerable:!0,configurable:!0}),t.prototype.doc=function(r){if(typeof r!="string"&&typeof r!="number")throw new Error("docId必须为字符串或数字");return new mi(this._transaction,this._coll,r)},t.prototype.add=function(r){var n;r._id!==void 0&&(n=r._id);var i=new mi(this._transaction,this._coll,n);return i.create(r)},t}(hu),It=function(e,t,r,n){function i(o){return o instanceof r?o:new r(function(a){a(o)})}return new(r||(r=Promise))(function(o,a){function l(g){try{c(n.next(g))}catch(m){a(m)}}function p(g){try{c(n.throw(g))}catch(m){a(m)}}function c(g){g.done?o(g.value):i(g.value).then(l,p)}c((n=n.apply(e,t||[])).next())})},xt=function(e,t){var r={label:0,sent:function(){if(o[0]&1)throw o[1];return o[1]},trys:[],ops:[]},n,i,o,a;return a={next:l(0),throw:l(1),return:l(2)},typeof Symbol=="function"&&(a[Symbol.iterator]=function(){return this}),a;function l(c){return function(g){return p([c,g])}}function p(c){if(n)throw new TypeError("Generator is already executing.");for(;r;)try{if(n=1,i&&(o=c[0]&2?i.return:c[0]?i.throw||((o=i.return)&&o.call(i),0):i.next)&&!(o=o.call(i,c[1])).done)return o;switch(i=0,o&&(c=[c[0]&2,o.value]),c[0]){case 0:case 1:o=c;break;case 4:return r.label++,{value:c[1],done:!1};case 5:r.label++,i=c[1],c=[0];continue;case 7:c=r.ops.pop(),r.trys.pop();continue;default:if(o=r.trys,!(o=o.length>0&&o[o.length-1])&&(c[0]===6||c[0]===2)){r=0;continue}if(c[0]===3&&(!o||c[1]>o[0]&&c[1]<o[3])){r.label=c[1];break}if(c[0]===6&&r.label<o[1]){r.label=o[1],o=c;break}if(o&&r.label<o[2]){r.label=o[2],r.ops.push(c);break}o[2]&&r.ops.pop(),r.trys.pop();continue}c=t.call(e,r)}catch(g){c=[6,g],i=0}finally{n=o=0}if(c[0]&5)throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}},pu="database.startTransaction",gu="database.commitTransaction",mu="database.abortTransaction",no=function(){function e(t){this._db=t,this._request=new ne.reqClass(this._db.config),this.aborted=!1,this.commited=!1,this.inited=!1}return e.prototype.init=function(){return It(this,void 0,void 0,function(){var t;return xt(this,function(r){switch(r.label){case 0:return[4,this._request.send(pu)];case 1:if(t=r.sent(),t.code)throw t;return this.inited=!0,this._id=t.transactionId,[2]}})})},e.prototype.collection=function(t){if(!t)throw new Error("Collection name is required");return new du(this,t)},e.prototype.getTransactionId=function(){return this._id},e.prototype.getRequestMethod=function(){return this._request},e.prototype.commit=function(){return It(this,void 0,void 0,function(){var t,r;return xt(this,function(n){switch(n.label){case 0:return t={transactionId:this._id},[4,this._request.send(gu,t)];case 1:if(r=n.sent(),r.code)throw r;return this.commited=!0,[2,r]}})})},e.prototype.rollback=function(t){return It(this,void 0,void 0,function(){var r,n;return xt(this,function(i){switch(i.label){case 0:return r={transactionId:this._id},[4,this._request.send(mu,r)];case 1:if(n=i.sent(),n.code)throw n;return this.aborted=!0,this.abortReason=t,[2,n]}})})},e}();function yu(){return It(this,void 0,void 0,function(){var e;return xt(this,function(t){switch(t.label){case 0:return e=new no(this),[4,e.init()];case 1:return t.sent(),[2,e]}})})}function io(e,t){return t===void 0&&(t=3),It(this,void 0,void 0,function(){var r,n,i,o,a=this;return xt(this,function(l){switch(l.label){case 0:return l.trys.push([0,4,,10]),r=new no(this),[4,r.init()];case 1:return l.sent(),[4,e(r)];case 2:if(n=l.sent(),r.aborted===!0)throw r.abortReason;return[4,r.commit()];case 3:return l.sent(),[2,n];case 4:if(i=l.sent(),r.inited===!1)throw i;return o=function(p){return It(a,void 0,void 0,function(){return xt(this,function(c){switch(c.label){case 0:if(!(!r.aborted&&!r.commited))return[3,5];c.label=1;case 1:return c.trys.push([1,3,,4]),[4,r.rollback()];case 2:return c.sent(),[3,4];case 3:return c.sent(),[3,4];case 4:throw p;case 5:throw r.aborted===!0?r.abortReason:p}})})},t<=0?[4,o(i)]:[3,6];case 5:l.sent(),l.label=6;case 6:return i&&i.code===ro.DATABASE_TRANSACTION_CONFLICT.code?[4,io.bind(this)(e,--t)]:[3,8];case 7:return[2,l.sent()];case 8:return[4,o(i)];case 9:return l.sent(),[3,10];case 10:return[2]}})})}var ne=function(){function e(t){this.config=t,this.Geo=ia,this.serverDate=ea,this.command=ou,this.RegExp=au,this.startTransaction=yu,this.runTransaction=io,this.logicCommand=st,this.updateCommand=Q,this.queryCommand=ee}return e.prototype.collection=function(t){if(!t)throw new Error("Collection name is required");return new iu(this,t)},e.prototype.createCollection=function(t){var r=new e.reqClass(this.config),n={collectionName:t};return r.send("database.addCollection",n)},e}(),pr=function(){return pr=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++){t=arguments[r];for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i])}return e},pr.apply(this,arguments)},wu="database";function _u(e){var t=this.platform,r=t.adapter,n=t.runtime;return ne.reqClass=this.request.constructor,ne.getAccessToken=this.authInstance?this.authInstance.getAccessToken.bind(this.authInstance):function(){return""},ne.runtime=n,this.wsClientClass&&(ne.wsClass=r.wsClass,ne.wsClientClass=this.wsClientClass),ne.ws||(ne.ws=null),new ne(pr(pr({},this.config),e))}var vu={name:wu,entity:{database:_u}};try{cloudbase.registerComponent(vu)}catch{}var bu="Expected a function",oo="__lodash_hash_undefined__",so=1/0,Eu=9007199254740991,Su="[object Function]",Iu="[object GeneratorFunction]",xu="[object Symbol]",Tu=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,Nu=/^\w*$/,Ou=/^\./,Au=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,Ru=/[\\^$.*+?()[\]{}|]/g,Cu=/\\(\\)?/g,Du=/^\[object .+?Constructor\]$/,Lu=/^(?:0|[1-9]\d*)$/,Bu=typeof Ee=="object"&&Ee&&Ee.Object===Object&&Ee,Pu=typeof self=="object"&&self&&self.Object===Object&&self,Sn=Bu||Pu||Function("return this")();function $u(e,t){return e==null?void 0:e[t]}function Mu(e){var t=!1;if(e!=null&&typeof e.toString!="function")try{t=!!(e+"")}catch{}return t}var Fu=Array.prototype,Uu=Function.prototype,ao=Object.prototype,tn=Sn["__core-js_shared__"],yi=function(){var e=/[^.]+$/.exec(tn&&tn.keys&&tn.keys.IE_PROTO||"");return e?"Symbol(src)_1."+e:""}(),uo=Uu.toString,xr=ao.hasOwnProperty,co=ao.toString,ju=RegExp("^"+uo.call(xr).replace(Ru,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),wi=Sn.Symbol,Wu=Fu.splice,Gu=fo(Sn,"Map"),Ht=fo(Object,"create"),_i=wi?wi.prototype:void 0,vi=_i?_i.toString:void 0;function ft(e){var t=-1,r=e?e.length:0;for(this.clear();++t<r;){var n=e[t];this.set(n[0],n[1])}}function Hu(){this.__data__=Ht?Ht(null):{}}function qu(e){return this.has(e)&&delete this.__data__[e]}function Vu(e){var t=this.__data__;if(Ht){var r=t[e];return r===oo?void 0:r}return xr.call(t,e)?t[e]:void 0}function ku(e){var t=this.__data__;return Ht?t[e]!==void 0:xr.call(t,e)}function Ju(e,t){var r=this.__data__;return r[e]=Ht&&t===void 0?oo:t,this}ft.prototype.clear=Hu;ft.prototype.delete=qu;ft.prototype.get=Vu;ft.prototype.has=ku;ft.prototype.set=Ju;function Tt(e){var t=-1,r=e?e.length:0;for(this.clear();++t<r;){var n=e[t];this.set(n[0],n[1])}}function Ku(){this.__data__=[]}function Yu(e){var t=this.__data__,r=Tr(t,e);if(r<0)return!1;var n=t.length-1;return r==n?t.pop():Wu.call(t,r,1),!0}function Xu(e){var t=this.__data__,r=Tr(t,e);return r<0?void 0:t[r][1]}function Zu(e){return Tr(this.__data__,e)>-1}function zu(e,t){var r=this.__data__,n=Tr(r,e);return n<0?r.push([e,t]):r[n][1]=t,this}Tt.prototype.clear=Ku;Tt.prototype.delete=Yu;Tt.prototype.get=Xu;Tt.prototype.has=Zu;Tt.prototype.set=zu;function lt(e){var t=-1,r=e?e.length:0;for(this.clear();++t<r;){var n=e[t];this.set(n[0],n[1])}}function Qu(){this.__data__={hash:new ft,map:new(Gu||Tt),string:new ft}}function ec(e){return Nr(this,e).delete(e)}function tc(e){return Nr(this,e).get(e)}function rc(e){return Nr(this,e).has(e)}function nc(e,t){return Nr(this,e).set(e,t),this}lt.prototype.clear=Qu;lt.prototype.delete=ec;lt.prototype.get=tc;lt.prototype.has=rc;lt.prototype.set=nc;function ic(e,t,r){var n=e[t];(!(xr.call(e,t)&&ho(n,r))||r===void 0&&!(t in e))&&(e[t]=r)}function Tr(e,t){for(var r=e.length;r--;)if(ho(e[r][0],t))return r;return-1}function oc(e){if(!gr(e)||lc(e))return!1;var t=mc(e)||Mu(e)?ju:Du;return t.test(gc(e))}function sc(e,t,r,n){if(!gr(e))return e;t=fc(t,e)?[t]:uc(t);for(var i=-1,o=t.length,a=o-1,l=e;l!=null&&++i<o;){var p=pc(t[i]),c=r;if(i!=a){var g=l[p];c=void 0,c===void 0&&(c=gr(g)?g:cc(t[i+1])?[]:{})}ic(l,p,c),l=l[p]}return e}function ac(e){if(typeof e=="string")return e;if(xn(e))return vi?vi.call(e):"";var t=e+"";return t=="0"&&1/e==-so?"-0":t}function uc(e){return lo(e)?e:dc(e)}function Nr(e,t){var r=e.__data__;return hc(t)?r[typeof t=="string"?"string":"hash"]:r.map}function fo(e,t){var r=$u(e,t);return oc(r)?r:void 0}function cc(e,t){return t=t??Eu,!!t&&(typeof e=="number"||Lu.test(e))&&e>-1&&e%1==0&&e<t}function fc(e,t){if(lo(e))return!1;var r=typeof e;return r=="number"||r=="symbol"||r=="boolean"||e==null||xn(e)?!0:Nu.test(e)||!Tu.test(e)||t!=null&&e in Object(t)}function hc(e){var t=typeof e;return t=="string"||t=="number"||t=="symbol"||t=="boolean"?e!=="__proto__":e===null}function lc(e){return!!yi&&yi in e}var dc=In(function(e){e=wc(e);var t=[];return Ou.test(e)&&t.push(""),e.replace(Au,function(r,n,i,o){t.push(i?o.replace(Cu,"$1"):n||r)}),t});function pc(e){if(typeof e=="string"||xn(e))return e;var t=e+"";return t=="0"&&1/e==-so?"-0":t}function gc(e){if(e!=null){try{return uo.call(e)}catch{}try{return e+""}catch{}}return""}function In(e,t){if(typeof e!="function"||t&&typeof t!="function")throw new TypeError(bu);var r=function(){var n=arguments,i=t?t.apply(this,n):n[0],o=r.cache;if(o.has(i))return o.get(i);var a=e.apply(this,n);return r.cache=o.set(i,a),a};return r.cache=new(In.Cache||lt),r}In.Cache=lt;function ho(e,t){return e===t||e!==e&&t!==t}var lo=Array.isArray;function mc(e){var t=gr(e)?co.call(e):"";return t==Su||t==Iu}function gr(e){var t=typeof e;return!!e&&(t=="object"||t=="function")}function yc(e){return!!e&&typeof e=="object"}function xn(e){return typeof e=="symbol"||yc(e)&&co.call(e)==xu}function wc(e){return e==null?"":ac(e)}function _c(e,t,r){return e==null?e:sc(e,t,r)}var vc=_c;const bc=gn(vc);var Ec="Expected a function",po="__lodash_hash_undefined__",go=1/0,Sc="[object Function]",Ic="[object GeneratorFunction]",xc="[object Symbol]",Tc=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,Nc=/^\w*$/,Oc=/^\./,Ac=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,Rc=/[\\^$.*+?()[\]{}|]/g,Cc=/\\(\\)?/g,Dc=/^\[object .+?Constructor\]$/,Lc=typeof Ee=="object"&&Ee&&Ee.Object===Object&&Ee,Bc=typeof self=="object"&&self&&self.Object===Object&&self,Tn=Lc||Bc||Function("return this")();function Pc(e,t){return e==null?void 0:e[t]}function $c(e){var t=!1;if(e!=null&&typeof e.toString!="function")try{t=!!(e+"")}catch{}return t}var Mc=Array.prototype,Fc=Function.prototype,mo=Object.prototype,rn=Tn["__core-js_shared__"],bi=function(){var e=/[^.]+$/.exec(rn&&rn.keys&&rn.keys.IE_PROTO||"");return e?"Symbol(src)_1."+e:""}(),yo=Fc.toString,Or=mo.hasOwnProperty,wo=mo.toString,Uc=RegExp("^"+yo.call(Or).replace(Rc,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),Ei=Tn.Symbol,jc=Mc.splice,Wc=vo(Tn,"Map"),qt=vo(Object,"create"),Si=Ei?Ei.prototype:void 0,Ii=Si?Si.toString:void 0;function ht(e){var t=-1,r=e?e.length:0;for(this.clear();++t<r;){var n=e[t];this.set(n[0],n[1])}}function Gc(){this.__data__=qt?qt(null):{}}function Hc(e){return this.has(e)&&delete this.__data__[e]}function qc(e){var t=this.__data__;if(qt){var r=t[e];return r===po?void 0:r}return Or.call(t,e)?t[e]:void 0}function Vc(e){var t=this.__data__;return qt?t[e]!==void 0:Or.call(t,e)}function kc(e,t){var r=this.__data__;return r[e]=qt&&t===void 0?po:t,this}ht.prototype.clear=Gc;ht.prototype.delete=Hc;ht.prototype.get=qc;ht.prototype.has=Vc;ht.prototype.set=kc;function Nt(e){var t=-1,r=e?e.length:0;for(this.clear();++t<r;){var n=e[t];this.set(n[0],n[1])}}function Jc(){this.__data__=[]}function Kc(e){var t=this.__data__,r=Ar(t,e);if(r<0)return!1;var n=t.length-1;return r==n?t.pop():jc.call(t,r,1),!0}function Yc(e){var t=this.__data__,r=Ar(t,e);return r<0?void 0:t[r][1]}function Xc(e){return Ar(this.__data__,e)>-1}function Zc(e,t){var r=this.__data__,n=Ar(r,e);return n<0?r.push([e,t]):r[n][1]=t,this}Nt.prototype.clear=Jc;Nt.prototype.delete=Kc;Nt.prototype.get=Yc;Nt.prototype.has=Xc;Nt.prototype.set=Zc;function dt(e){var t=-1,r=e?e.length:0;for(this.clear();++t<r;){var n=e[t];this.set(n[0],n[1])}}function zc(){this.__data__={hash:new ht,map:new(Wc||Nt),string:new ht}}function Qc(e){return Rr(this,e).delete(e)}function ef(e){return Rr(this,e).get(e)}function tf(e){return Rr(this,e).has(e)}function rf(e,t){return Rr(this,e).set(e,t),this}dt.prototype.clear=zc;dt.prototype.delete=Qc;dt.prototype.get=ef;dt.prototype.has=tf;dt.prototype.set=rf;function Ar(e,t){for(var r=e.length;r--;)if(gf(e[r][0],t))return r;return-1}function nf(e,t){t=bo(t,e)?[t]:_o(t);for(var r=0,n=t.length;e!=null&&r<n;)e=e[Eo(t[r++])];return r&&r==n?e:void 0}function of(e){if(!Io(e)||ff(e))return!1;var t=mf(e)||$c(e)?Uc:Dc;return t.test(df(e))}function sf(e,t,r){var n=-1,i=e.length;t<0&&(t=-t>i?0:i+t),r=r>i?i:r,r<0&&(r+=i),i=t>r?0:r-t>>>0,t>>>=0;for(var o=Array(i);++n<i;)o[n]=e[n+t];return o}function af(e){if(typeof e=="string")return e;if(On(e))return Ii?Ii.call(e):"";var t=e+"";return t=="0"&&1/e==-go?"-0":t}function uf(e,t){t=bo(t,e)?[t]:_o(t),e=hf(e,t);var r=Eo(pf(t));return!(e!=null&&Or.call(e,r))||delete e[r]}function _o(e){return So(e)?e:lf(e)}function Rr(e,t){var r=e.__data__;return cf(t)?r[typeof t=="string"?"string":"hash"]:r.map}function vo(e,t){var r=Pc(e,t);return of(r)?r:void 0}function bo(e,t){if(So(e))return!1;var r=typeof e;return r=="number"||r=="symbol"||r=="boolean"||e==null||On(e)?!0:Nc.test(e)||!Tc.test(e)||t!=null&&e in Object(t)}function cf(e){var t=typeof e;return t=="string"||t=="number"||t=="symbol"||t=="boolean"?e!=="__proto__":e===null}function ff(e){return!!bi&&bi in e}function hf(e,t){return t.length==1?e:nf(e,sf(t,0,-1))}var lf=Nn(function(e){e=wf(e);var t=[];return Oc.test(e)&&t.push(""),e.replace(Ac,function(r,n,i,o){t.push(i?o.replace(Cc,"$1"):n||r)}),t});function Eo(e){if(typeof e=="string"||On(e))return e;var t=e+"";return t=="0"&&1/e==-go?"-0":t}function df(e){if(e!=null){try{return yo.call(e)}catch{}try{return e+""}catch{}}return""}function pf(e){var t=e?e.length:0;return t?e[t-1]:void 0}function Nn(e,t){if(typeof e!="function"||t&&typeof t!="function")throw new TypeError(Ec);var r=function(){var n=arguments,i=t?t.apply(this,n):n[0],o=r.cache;if(o.has(i))return o.get(i);var a=e.apply(this,n);return r.cache=o.set(i,a),a};return r.cache=new(Nn.Cache||dt),r}Nn.Cache=dt;function gf(e,t){return e===t||e!==e&&t!==t}var So=Array.isArray;function mf(e){var t=Io(e)?wo.call(e):"";return t==Sc||t==Ic}function Io(e){var t=typeof e;return!!e&&(t=="object"||t=="function")}function yf(e){return!!e&&typeof e=="object"}function On(e){return typeof e=="symbol"||yf(e)&&wo.call(e)==xc}function wf(e){return e==null?"":af(e)}function _f(e,t){return e==null?!0:uf(e,t)}var vf=_f;const bf=gn(vf);var mr={exports:{}};mr.exports;(function(e,t){var r=200,n="__lodash_hash_undefined__",i=9007199254740991,o="[object Arguments]",a="[object Array]",l="[object Boolean]",p="[object Date]",c="[object Error]",g="[object Function]",m="[object GeneratorFunction]",_="[object Map]",I="[object Number]",T="[object Object]",N="[object Promise]",D="[object RegExp]",x="[object Set]",P="[object String]",G="[object Symbol]",O="[object WeakMap]",q="[object ArrayBuffer]",$="[object DataView]",K="[object Float32Array]",ie="[object Float64Array]",xe="[object Int8Array]",Me="[object Int16Array]",Re="[object Int32Array]",ge="[object Uint8Array]",X="[object Uint8ClampedArray]",Te="[object Uint16Array]",Ye="[object Uint32Array]",Ge=/[\\^$.*+?()[\]{}|]/g,k=/\w*$/,ce=/^\[object .+?Constructor\]$/,F=/^(?:0|[1-9]\d*)$/,A={};A[o]=A[a]=A[q]=A[$]=A[l]=A[p]=A[K]=A[ie]=A[xe]=A[Me]=A[Re]=A[_]=A[I]=A[T]=A[D]=A[x]=A[P]=A[G]=A[ge]=A[X]=A[Te]=A[Ye]=!0,A[c]=A[g]=A[O]=!1;var re=typeof Ee=="object"&&Ee&&Ee.Object===Object&&Ee,kt=typeof self=="object"&&self&&self.Object===Object&&self,me=re||kt||Function("return this")(),Ot=t&&!t.nodeType&&t,Jt=Ot&&!0&&e&&!e.nodeType&&e,Dr=Jt&&Jt.exports===Ot;function At(f,w){return f.set(w[0],w[1]),f}function Lr(f,w){return f.add(w),f}function Br(f,w){for(var v=-1,R=f?f.length:0;++v<R&&w(f[v],v,f)!==!1;);return f}function Kt(f,w){for(var v=-1,R=w.length,te=f.length;++v<R;)f[te+v]=w[v];return f}function Xe(f,w,v,R){for(var te=-1,oe=f?f.length:0;++te<oe;)v=w(v,f[te],te,f);return v}function ye(f,w){for(var v=-1,R=Array(f);++v<f;)R[v]=w(v);return R}function Rt(f,w){return f==null?void 0:f[w]}function Yt(f){var w=!1;if(f!=null&&typeof f.toString!="function")try{w=!!(f+"")}catch{}return w}function h(f){var w=-1,v=Array(f.size);return f.forEach(function(R,te){v[++w]=[te,R]}),v}function s(f,w){return function(v){return f(w(v))}}function u(f){var w=-1,v=Array(f.size);return f.forEach(function(R){v[++w]=R}),v}var d=Array.prototype,y=Function.prototype,b=Object.prototype,E=me["__core-js_shared__"],B=function(){var f=/[^.]+$/.exec(E&&E.keys&&E.keys.IE_PROTO||"");return f?"Symbol(src)_1."+f:""}(),W=y.toString,U=b.hasOwnProperty,Z=b.toString,J=RegExp("^"+W.call(U).replace(Ge,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),Ze=Dr?me.Buffer:void 0,Ct=me.Symbol,Dt=me.Uint8Array,Oo=s(Object.getPrototypeOf,Object),Ao=Object.create,Ro=b.propertyIsEnumerable,Co=d.splice,Rn=Object.getOwnPropertySymbols,Do=Ze?Ze.isBuffer:void 0,Lo=s(Object.keys,Object),Pr=mt(me,"DataView"),Lt=mt(me,"Map"),$r=mt(me,"Promise"),Mr=mt(me,"Set"),Fr=mt(me,"WeakMap"),Bt=mt(Object,"create"),Bo=et(Pr),Po=et(Lt),$o=et($r),Mo=et(Mr),Fo=et(Fr),Cn=Ct?Ct.prototype:void 0,Dn=Cn?Cn.valueOf:void 0;function ze(f){var w=-1,v=f?f.length:0;for(this.clear();++w<v;){var R=f[w];this.set(R[0],R[1])}}function Uo(){this.__data__=Bt?Bt(null):{}}function jo(f){return this.has(f)&&delete this.__data__[f]}function Wo(f){var w=this.__data__;if(Bt){var v=w[f];return v===n?void 0:v}return U.call(w,f)?w[f]:void 0}function Go(f){var w=this.__data__;return Bt?w[f]!==void 0:U.call(w,f)}function Ho(f,w){var v=this.__data__;return v[f]=Bt&&w===void 0?n:w,this}ze.prototype.clear=Uo,ze.prototype.delete=jo,ze.prototype.get=Wo,ze.prototype.has=Go,ze.prototype.set=Ho;function Fe(f){var w=-1,v=f?f.length:0;for(this.clear();++w<v;){var R=f[w];this.set(R[0],R[1])}}function qo(){this.__data__=[]}function Vo(f){var w=this.__data__,v=Xt(w,f);if(v<0)return!1;var R=w.length-1;return v==R?w.pop():Co.call(w,v,1),!0}function ko(f){var w=this.__data__,v=Xt(w,f);return v<0?void 0:w[v][1]}function Jo(f){return Xt(this.__data__,f)>-1}function Ko(f,w){var v=this.__data__,R=Xt(v,f);return R<0?v.push([f,w]):v[R][1]=w,this}Fe.prototype.clear=qo,Fe.prototype.delete=Vo,Fe.prototype.get=ko,Fe.prototype.has=Jo,Fe.prototype.set=Ko;function pt(f){var w=-1,v=f?f.length:0;for(this.clear();++w<v;){var R=f[w];this.set(R[0],R[1])}}function Yo(){this.__data__={hash:new ze,map:new(Lt||Fe),string:new ze}}function Xo(f){return Zt(this,f).delete(f)}function Zo(f){return Zt(this,f).get(f)}function zo(f){return Zt(this,f).has(f)}function Qo(f,w){return Zt(this,f).set(f,w),this}pt.prototype.clear=Yo,pt.prototype.delete=Xo,pt.prototype.get=Zo,pt.prototype.has=zo,pt.prototype.set=Qo;function gt(f){this.__data__=new Fe(f)}function es(){this.__data__=new Fe}function ts(f){return this.__data__.delete(f)}function rs(f){return this.__data__.get(f)}function ns(f){return this.__data__.has(f)}function is(f,w){var v=this.__data__;if(v instanceof Fe){var R=v.__data__;if(!Lt||R.length<r-1)return R.push([f,w]),this;v=this.__data__=new pt(R)}return v.set(f,w),this}gt.prototype.clear=es,gt.prototype.delete=ts,gt.prototype.get=rs,gt.prototype.has=ns,gt.prototype.set=is;function os(f,w){var v=Wr(f)||As(f)?ye(f.length,String):[],R=v.length,te=!!R;for(var oe in f)U.call(f,oe)&&!(te&&(oe=="length"||xs(oe,R)))&&v.push(oe);return v}function Ln(f,w,v){var R=f[w];(!(U.call(f,w)&&Mn(R,v))||v===void 0&&!(w in f))&&(f[w]=v)}function Xt(f,w){for(var v=f.length;v--;)if(Mn(f[v][0],w))return v;return-1}function ss(f,w){return f&&Bn(w,Gr(w),f)}function Ur(f,w,v,R,te,oe,Ue){var se;if(R&&(se=oe?R(f,te,oe,Ue):R(f)),se!==void 0)return se;if(!zt(f))return f;var jn=Wr(f);if(jn){if(se=Es(f),!w)return _s(f,se)}else{var yt=Qe(f),Wn=yt==g||yt==m;if(Cs(f))return ls(f,w);if(yt==T||yt==o||Wn&&!oe){if(Yt(f))return oe?f:{};if(se=Ss(Wn?{}:f),!w)return vs(f,ss(se,f))}else{if(!A[yt])return oe?f:{};se=Is(f,yt,Ur,w)}}Ue||(Ue=new gt);var Gn=Ue.get(f);if(Gn)return Gn;if(Ue.set(f,se),!jn)var Hn=v?bs(f):Gr(f);return Br(Hn||f,function(Hr,Qt){Hn&&(Qt=Hr,Hr=f[Qt]),Ln(se,Qt,Ur(Hr,w,v,R,Qt,f,Ue))}),se}function as(f){return zt(f)?Ao(f):{}}function us(f,w,v){var R=w(f);return Wr(f)?R:Kt(R,v(f))}function cs(f){return Z.call(f)}function fs(f){if(!zt(f)||Ns(f))return!1;var w=Un(f)||Yt(f)?J:ce;return w.test(et(f))}function hs(f){if(!$n(f))return Lo(f);var w=[];for(var v in Object(f))U.call(f,v)&&v!="constructor"&&w.push(v);return w}function ls(f,w){if(w)return f.slice();var v=new f.constructor(f.length);return f.copy(v),v}function jr(f){var w=new f.constructor(f.byteLength);return new Dt(w).set(new Dt(f)),w}function ds(f,w){var v=w?jr(f.buffer):f.buffer;return new f.constructor(v,f.byteOffset,f.byteLength)}function ps(f,w,v){var R=w?v(h(f),!0):h(f);return Xe(R,At,new f.constructor)}function gs(f){var w=new f.constructor(f.source,k.exec(f));return w.lastIndex=f.lastIndex,w}function ms(f,w,v){var R=w?v(u(f),!0):u(f);return Xe(R,Lr,new f.constructor)}function ys(f){return Dn?Object(Dn.call(f)):{}}function ws(f,w){var v=w?jr(f.buffer):f.buffer;return new f.constructor(v,f.byteOffset,f.length)}function _s(f,w){var v=-1,R=f.length;for(w||(w=Array(R));++v<R;)w[v]=f[v];return w}function Bn(f,w,v,R){v||(v={});for(var te=-1,oe=w.length;++te<oe;){var Ue=w[te],se=void 0;Ln(v,Ue,se===void 0?f[Ue]:se)}return v}function vs(f,w){return Bn(f,Pn(f),w)}function bs(f){return us(f,Gr,Pn)}function Zt(f,w){var v=f.__data__;return Ts(w)?v[typeof w=="string"?"string":"hash"]:v.map}function mt(f,w){var v=Rt(f,w);return fs(v)?v:void 0}var Pn=Rn?s(Rn,Object):Bs,Qe=cs;(Pr&&Qe(new Pr(new ArrayBuffer(1)))!=$||Lt&&Qe(new Lt)!=_||$r&&Qe($r.resolve())!=N||Mr&&Qe(new Mr)!=x||Fr&&Qe(new Fr)!=O)&&(Qe=function(f){var w=Z.call(f),v=w==T?f.constructor:void 0,R=v?et(v):void 0;if(R)switch(R){case Bo:return $;case Po:return _;case $o:return N;case Mo:return x;case Fo:return O}return w});function Es(f){var w=f.length,v=f.constructor(w);return w&&typeof f[0]=="string"&&U.call(f,"index")&&(v.index=f.index,v.input=f.input),v}function Ss(f){return typeof f.constructor=="function"&&!$n(f)?as(Oo(f)):{}}function Is(f,w,v,R){var te=f.constructor;switch(w){case q:return jr(f);case l:case p:return new te(+f);case $:return ds(f,R);case K:case ie:case xe:case Me:case Re:case ge:case X:case Te:case Ye:return ws(f,R);case _:return ps(f,R,v);case I:case P:return new te(f);case D:return gs(f);case x:return ms(f,R,v);case G:return ys(f)}}function xs(f,w){return w=w??i,!!w&&(typeof f=="number"||F.test(f))&&f>-1&&f%1==0&&f<w}function Ts(f){var w=typeof f;return w=="string"||w=="number"||w=="symbol"||w=="boolean"?f!=="__proto__":f===null}function Ns(f){return!!B&&B in f}function $n(f){var w=f&&f.constructor,v=typeof w=="function"&&w.prototype||b;return f===v}function et(f){if(f!=null){try{return W.call(f)}catch{}try{return f+""}catch{}}return""}function Os(f){return Ur(f,!0,!0)}function Mn(f,w){return f===w||f!==f&&w!==w}function As(f){return Rs(f)&&U.call(f,"callee")&&(!Ro.call(f,"callee")||Z.call(f)==o)}var Wr=Array.isArray;function Fn(f){return f!=null&&Ds(f.length)&&!Un(f)}function Rs(f){return Ls(f)&&Fn(f)}var Cs=Do||Ps;function Un(f){var w=zt(f)?Z.call(f):"";return w==g||w==m}function Ds(f){return typeof f=="number"&&f>-1&&f%1==0&&f<=i}function zt(f){var w=typeof f;return!!f&&(w=="object"||w=="function")}function Ls(f){return!!f&&typeof f=="object"}function Gr(f){return Fn(f)?os(f):hs(f)}function Bs(){return[]}function Ps(){return!1}e.exports=Os})(mr,mr.exports);var Ef=mr.exports;const Sf=gn(Ef);function St(e){return e===void 0&&(e=""),(e?e+"_":"")+ +new Date+"_"+Math.random()}var If=function(){function e(t){this.close=t.close,this.onChange=t.onChange,this.onError=t.onError,t.debug&&Object.defineProperty(this,"virtualClient",{get:function(){return t.virtualClient}})}return e}(),xi=function(){function e(t){var r=t.id,n=t.docChanges,i=t.docs,o=t.msgType,a=t.type,l,p;Object.defineProperties(this,{id:{get:function(){return r},enumerable:!0},docChanges:{get:function(){return l||(l=JSON.parse(JSON.stringify(n))),l},enumerable:!0},docs:{get:function(){return p||(p=JSON.parse(JSON.stringify(i))),p},enumerable:!0},msgType:{get:function(){return o},enumerable:!0},type:{get:function(){return a},enumerable:!0}})}return e}(),Cr=function(){var e=function(t,r){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,i){n.__proto__=i}||function(n,i){for(var o in i)i.hasOwnProperty(o)&&(n[o]=i[o])},e(t,r)};return function(t,r){e(t,r);function n(){this.constructor=t}t.prototype=r===null?Object.create(r):(n.prototype=r.prototype,new n)}}(),xf=function(e){Cr(t,e);function t(r){var n=e.call(this,"Watch Error "+JSON.stringify(r.msgData)+" (requestid: "+r.requestId+")")||this;return n.isRealtimeErrorMessageError=!0,n.payload=r,n}return t}(Error),Ti=function(e){return e==null?void 0:e.isRealtimeErrorMessageError},Tf=function(e){Cr(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.type="timeout",r.payload=null,r.generic=!0,r}return t}(Error),Nf=function(e){return e.type==="timeout"},Of=function(e){Cr(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.type="cancelled",r.payload=null,r.generic=!0,r}return t}(Error),Af=function(e){return e.type==="cancelled"},be=function(e){Cr(t,e);function t(r){var n=e.call(this,r.errMsg)||this;return n.errCode="UNKNOWN_ERROR",Object.defineProperties(n,{message:{get:function(){return"errCode: "+this.errCode+" "+(ue[this.errCode]||"")+" | errMsg: "+this.errMsg},set:function(i){this.errMsg=i}}}),n.errCode=r.errCode||"UNKNOWN_ERROR",n.errMsg=r.errMsg,n}return Object.defineProperty(t.prototype,"message",{get:function(){return"errCode: "+this.errCode+" | errMsg: "+this.errMsg},set:function(r){this.errMsg=r},enumerable:!1,configurable:!0}),t}(Error),ue={UNKNOWN_ERROR:"UNKNOWN_ERROR",SDK_DATABASE_REALTIME_LISTENER_INIT_WATCH_FAIL:"SDK_DATABASE_REALTIME_LISTENER_INIT_WATCH_FAIL",SDK_DATABASE_REALTIME_LISTENER_RECONNECT_WATCH_FAIL:"SDK_DATABASE_REALTIME_LISTENER_RECONNECT_WATCH_FAIL",SDK_DATABASE_REALTIME_LISTENER_REBUILD_WATCH_FAIL:"SDK_DATABASE_REALTIME_LISTENER_REBUILD_WATCH_FAIL",SDK_DATABASE_REALTIME_LISTENER_CLOSE_WATCH_FAIL:"SDK_DATABASE_REALTIME_LISTENER_CLOSE_WATCH_FAIL",SDK_DATABASE_REALTIME_LISTENER_SERVER_ERROR_MSG:"SDK_DATABASE_REALTIME_LISTENER_SERVER_ERROR_MSG",SDK_DATABASE_REALTIME_LISTENER_RECEIVE_INVALID_SERVER_DATA:"SDK_DATABASE_REALTIME_LISTENER_RECEIVE_INVALID_SERVER_DATA",SDK_DATABASE_REALTIME_LISTENER_WEBSOCKET_CONNECTION_ERROR:"SDK_DATABASE_REALTIME_LISTENER_WEBSOCKET_CONNECTION_ERROR",SDK_DATABASE_REALTIME_LISTENER_WEBSOCKET_CONNECTION_CLOSED:"SDK_DATABASE_REALTIME_LISTENER_WEBSOCKET_CONNECTION_CLOSED",SDK_DATABASE_REALTIME_LISTENER_CHECK_LAST_FAIL:"SDK_DATABASE_REALTIME_LISTENER_CHECK_LAST_FAIL",SDK_DATABASE_REALTIME_LISTENER_UNEXPECTED_FATAL_ERROR:"SDK_DATABASE_REALTIME_LISTENER_UNEXPECTED_FATAL_ERROR"},pn=function(e){return e===void 0&&(e=0),new Promise(function(t){return setTimeout(t,e)})},fe=function(e,t,r,n){function i(o){return o instanceof r?o:new r(function(a){a(o)})}return new(r||(r=Promise))(function(o,a){function l(g){try{c(n.next(g))}catch(m){a(m)}}function p(g){try{c(n.throw(g))}catch(m){a(m)}}function c(g){g.done?o(g.value):i(g.value).then(l,p)}c((n=n.apply(e,t||[])).next())})},ae=function(e,t){var r={label:0,sent:function(){if(o[0]&1)throw o[1];return o[1]},trys:[],ops:[]},n,i,o,a;return a={next:l(0),throw:l(1),return:l(2)},typeof Symbol=="function"&&(a[Symbol.iterator]=function(){return this}),a;function l(c){return function(g){return p([c,g])}}function p(c){if(n)throw new TypeError("Generator is already executing.");for(;r;)try{if(n=1,i&&(o=c[0]&2?i.return:c[0]?i.throw||((o=i.return)&&o.call(i),0):i.next)&&!(o=o.call(i,c[1])).done)return o;switch(i=0,o&&(c=[c[0]&2,o.value]),c[0]){case 0:case 1:o=c;break;case 4:return r.label++,{value:c[1],done:!1};case 5:r.label++,i=c[1],c=[0];continue;case 7:c=r.ops.pop(),r.trys.pop();continue;default:if(o=r.trys,!(o=o.length>0&&o[o.length-1])&&(c[0]===6||c[0]===2)){r=0;continue}if(c[0]===3&&(!o||c[1]>o[0]&&c[1]<o[3])){r.label=c[1];break}if(c[0]===6&&r.label<o[1]){r.label=o[1],o=c;break}if(o&&r.label<o[2]){r.label=o[2],r.ops.push(c);break}o[2]&&r.ops.pop(),r.trys.pop();continue}c=t.call(e,r)}catch(g){c=[6,g],i=0}finally{n=o=0}if(c[0]&5)throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}},Ni=function(){for(var e=0,t=0,r=arguments.length;t<r;t++)e+=arguments[t].length;for(var n=Array(e),i=0,t=0;t<r;t++)for(var o=arguments[t],a=0,l=o.length;a<l;a++,i++)n[i]=o[a];return n},H;(function(e){e.LOGGINGIN="LOGGINGIN",e.INITING="INITING",e.REBUILDING="REBUILDING",e.ACTIVE="ACTIVE",e.ERRORED="ERRORED",e.CLOSING="CLOSING",e.CLOSED="CLOSED",e.PAUSED="PAUSED",e.RESUMING="RESUMING"})(H||(H={}));var Rf=100,or=2,Cf=2,Df=10*1e3,Lf=10*1e3,Bf=10*1e3,Pf=function(){function e(t){var r=this;this.watchStatus=H.INITING,this._login=function(n,i){return fe(r,void 0,void 0,function(){var o;return ae(this,function(a){switch(a.label){case 0:return this.watchStatus=H.LOGGINGIN,[4,this.login(n,i)];case 1:return o=a.sent(),this.envId||(this.envId=o.envId),[2,o]}})})},this.initWatch=function(n){return fe(r,void 0,void 0,function(){var i,o=this;return ae(this,function(a){switch(a.label){case 0:if(this._initWatchPromise)return[2,this._initWatchPromise];this._initWatchPromise=new Promise(function(l,p){return fe(o,void 0,void 0,function(){var c,g,m,_,I,T,N,D,x,P,G;return ae(this,function(O){switch(O.label){case 0:return O.trys.push([0,3,,4]),this.watchStatus===H.PAUSED?(console.log("[realtime] initWatch cancelled on pause"),[2,l()]):[4,this._login(this.envId,n)];case 1:return c=O.sent().envId,this.watchStatus===H.PAUSED?(console.log("[realtime] initWatch cancelled on pause"),[2,l()]):(this.watchStatus=H.INITING,g={watchId:this.watchId,requestId:St(),msgType:"INIT_WATCH",msgData:{envId:c,collName:this.collectionName,query:this.query,limit:this.limit,orderBy:this.orderBy}},[4,this.send({msg:g,waitResponse:!0,skipOnMessage:!0,timeout:Lf})]);case 2:if(m=O.sent(),_=m.msgData,I=_.events,T=_.currEvent,this.sessionInfo={queryID:m.msgData.queryID,currentEventId:T-1,currentDocs:[]},I.length>0){for(N=0,D=I;N<D.length;N++)x=D[N],x.ID=T;this.handleServerEvents(m)}else this.sessionInfo.currentEventId=T,P=new xi({id:T,docChanges:[],docs:[],type:"init"}),this.listener.onChange(P),this.scheduleSendACK();return this.onWatchStart(this,this.sessionInfo.queryID),this.watchStatus=H.ACTIVE,this._availableRetries.INIT_WATCH=or,l(),[3,4];case 3:return G=O.sent(),this.handleWatchEstablishmentError(G,{operationName:"INIT_WATCH",resolve:l,reject:p}),[3,4];case 4:return[2]}})})}),i=!1,a.label=1;case 1:return a.trys.push([1,,3,4]),[4,this._initWatchPromise];case 2:return a.sent(),i=!0,[3,4];case 3:return this._initWatchPromise=void 0,[7];case 4:return console.log("[realtime] initWatch "+(i?"success":"fail")),[2]}})})},this.rebuildWatch=function(n){return fe(r,void 0,void 0,function(){var i,o=this;return ae(this,function(a){switch(a.label){case 0:if(this._rebuildWatchPromise)return[2,this._rebuildWatchPromise];this._rebuildWatchPromise=new Promise(function(l,p){return fe(o,void 0,void 0,function(){var c,g,m,_;return ae(this,function(I){switch(I.label){case 0:return I.trys.push([0,3,,4]),this.watchStatus===H.PAUSED?(console.log("[realtime] rebuildWatch cancelled on pause"),[2,l()]):[4,this._login(this.envId,n)];case 1:if(c=I.sent().envId,!this.sessionInfo)throw new Error("can not rebuildWatch without a successful initWatch (lack of sessionInfo)");return this.watchStatus===H.PAUSED?(console.log("[realtime] rebuildWatch cancelled on pause"),[2,l()]):(this.watchStatus=H.REBUILDING,g={watchId:this.watchId,requestId:St(),msgType:"REBUILD_WATCH",msgData:{envId:c,collName:this.collectionName,queryID:this.sessionInfo.queryID,eventID:this.sessionInfo.currentEventId}},[4,this.send({msg:g,waitResponse:!0,skipOnMessage:!1,timeout:Bf})]);case 2:return m=I.sent(),this.handleServerEvents(m),this.watchStatus=H.ACTIVE,this._availableRetries.REBUILD_WATCH=or,l(),[3,4];case 3:return _=I.sent(),this.handleWatchEstablishmentError(_,{operationName:"REBUILD_WATCH",resolve:l,reject:p}),[3,4];case 4:return[2]}})})}),i=!1,a.label=1;case 1:return a.trys.push([1,,3,4]),[4,this._rebuildWatchPromise];case 2:return a.sent(),i=!0,[3,4];case 3:return this._rebuildWatchPromise=void 0,[7];case 4:return console.log("[realtime] rebuildWatch "+(i?"success":"fail")),[2]}})})},this.handleWatchEstablishmentError=function(n,i){return fe(r,void 0,void 0,function(){var o,a,l,p=this;return ae(this,function(c){return o=i.operationName==="INIT_WATCH",a=function(){p.closeWithError(new be({errCode:o?ue.SDK_DATABASE_REALTIME_LISTENER_INIT_WATCH_FAIL:ue.SDK_DATABASE_REALTIME_LISTENER_REBUILD_WATCH_FAIL,errMsg:n})),i.reject(n)},l=function(g){p.useRetryTicket(i.operationName)?o?(p._initWatchPromise=void 0,i.resolve(p.initWatch(g))):(p._rebuildWatchPromise=void 0,i.resolve(p.rebuildWatch(g))):a()},this.handleCommonError(n,{onSignError:function(){return l(!0)},onTimeoutError:function(){return l(!1)},onNotRetryableError:a,onCancelledError:i.reject,onUnknownError:function(){return fe(p,void 0,void 0,function(){var g,m=this;return ae(this,function(_){switch(_.label){case 0:return _.trys.push([0,8,,9]),g=function(){return fe(m,void 0,void 0,function(){return ae(this,function(I){switch(I.label){case 0:return this.pause(),[4,this.onceWSConnected()];case 1:return I.sent(),l(!0),[2]}})})},this.isWSConnected()?[3,2]:[4,g()];case 1:return _.sent(),[3,7];case 2:return[4,pn(Rf)];case 3:return _.sent(),this.watchStatus!==H.PAUSED?[3,4]:(i.reject(new Of(i.operationName+" cancelled due to pause after unknownError")),[3,7]);case 4:return this.isWSConnected()?[3,6]:[4,g()];case 5:return _.sent(),[3,7];case 6:l(!1),_.label=7;case 7:return[3,9];case 8:return _.sent(),l(!0),[3,9];case 9:return[2]}})})}}),[2]})})},this.closeWatch=function(){return fe(r,void 0,void 0,function(){var n,i,o;return ae(this,function(a){switch(a.label){case 0:if(n=this.sessionInfo?this.sessionInfo.queryID:"",this.watchStatus!==H.ACTIVE)return this.watchStatus=H.CLOSED,this.onWatchClose(this,n),[2];a.label=1;case 1:return a.trys.push([1,3,4,5]),this.watchStatus=H.CLOSING,i={watchId:this.watchId,requestId:St(),msgType:"CLOSE_WATCH",msgData:null},[4,this.send({msg:i})];case 2:return a.sent(),this.sessionInfo=void 0,this.watchStatus=H.CLOSED,[3,5];case 3:return o=a.sent(),this.closeWithError(new be({errCode:ue.SDK_DATABASE_REALTIME_LISTENER_CLOSE_WATCH_FAIL,errMsg:o})),[3,5];case 4:return this.onWatchClose(this,n),[7];case 5:return[2]}})})},this.scheduleSendACK=function(){r.clearACKSchedule(),r._ackTimeoutId=setTimeout(function(){r._waitExpectedTimeoutId?r.scheduleSendACK():r.sendACK()},Df)},this.clearACKSchedule=function(){r._ackTimeoutId&&clearTimeout(r._ackTimeoutId)},this.sendACK=function(){return fe(r,void 0,void 0,function(){var n,i,o;return ae(this,function(a){switch(a.label){case 0:return a.trys.push([0,2,,3]),this.watchStatus!==H.ACTIVE?(this.scheduleSendACK(),[2]):this.sessionInfo?(n={watchId:this.watchId,requestId:St(),msgType:"CHECK_LAST",msgData:{queryID:this.sessionInfo.queryID,eventID:this.sessionInfo.currentEventId}},[4,this.send({msg:n})]):(console.warn("[realtime listener] can not send ack without a successful initWatch (lack of sessionInfo)"),[2]);case 1:return a.sent(),this.scheduleSendACK(),[3,3];case 2:if(i=a.sent(),Ti(i))switch(o=i.payload,o.msgData.code){case"CHECK_LOGIN_FAILED":case"SIGN_EXPIRED_ERROR":case"SIGN_INVALID_ERROR":case"SIGN_PARAM_INVALID":return this.rebuildWatch(),[2];case"QUERYID_INVALID_ERROR":case"SYS_ERR":case"INVALIID_ENV":case"COLLECTION_PERMISSION_DENIED":return this.closeWithError(new be({errCode:ue.SDK_DATABASE_REALTIME_LISTENER_CHECK_LAST_FAIL,errMsg:o.msgData.code})),[2]}return this._availableRetries.CHECK_LAST&&this._availableRetries.CHECK_LAST>0?(this._availableRetries.CHECK_LAST--,this.scheduleSendACK()):this.closeWithError(new be({errCode:ue.SDK_DATABASE_REALTIME_LISTENER_CHECK_LAST_FAIL,errMsg:i})),[3,3];case 3:return[2]}})})},this.handleCommonError=function(n,i){if(Ti(n)){var o=n.payload;switch(o.msgData.code){case"CHECK_LOGIN_FAILED":case"SIGN_EXPIRED_ERROR":case"SIGN_INVALID_ERROR":case"SIGN_PARAM_INVALID":{i.onSignError(n);return}case"QUERYID_INVALID_ERROR":case"SYS_ERR":case"INVALIID_ENV":case"COLLECTION_PERMISSION_DENIED":{i.onNotRetryableError(n);return}default:{i.onNotRetryableError(n);return}}}else if(Nf(n)){i.onTimeoutError(n);return}else if(Af(n)){i.onCancelledError(n);return}i.onUnknownError(n)},this.watchId="watchid_"+ +new Date+"_"+Math.random(),this.envId=t.envId,this.collectionName=t.collectionName,this.query=t.query,this.limit=t.limit,this.orderBy=t.orderBy,this.send=t.send,this.login=t.login,this.isWSConnected=t.isWSConnected,this.onceWSConnected=t.onceWSConnected,this.getWaitExpectedTimeoutLength=t.getWaitExpectedTimeoutLength,this.onWatchStart=t.onWatchStart,this.onWatchClose=t.onWatchClose,this.debug=t.debug,this._availableRetries={INIT_WATCH:or,REBUILD_WATCH:or,CHECK_LAST:Cf},this.listener=new If({close:this.closeWatch,onChange:t.onChange,onError:t.onError,debug:this.debug,virtualClient:this}),this.initWatch()}return e.prototype.onMessage=function(t){var r=this;switch(this.watchStatus){case H.PAUSED:{if(t.msgType!=="ERROR")return;break}case H.LOGGINGIN:case H.INITING:case H.REBUILDING:{console.warn("[realtime listener] internal non-fatal error: unexpected message received while "+this.watchStatus);return}case H.CLOSED:{console.warn("[realtime listener] internal non-fatal error: unexpected message received when the watch has closed");return}case H.ERRORED:{console.warn("[realtime listener] internal non-fatal error: unexpected message received when the watch has ended with error");return}}if(!this.sessionInfo){console.warn("[realtime listener] internal non-fatal error: sessionInfo not found while message is received.");return}switch(this.scheduleSendACK(),t.msgType){case"NEXT_EVENT":{console.warn("nextevent "+t.msgData.currEvent+" ignored",t),this.handleServerEvents(t);break}case"CHECK_EVENT":{this.sessionInfo.currentEventId<t.msgData.currEvent&&(this.sessionInfo.expectEventId=t.msgData.currEvent,this.clearWaitExpectedEvent(),this._waitExpectedTimeoutId=setTimeout(function(){r.rebuildWatch()},this.getWaitExpectedTimeoutLength()),console.log("[realtime] waitExpectedTimeoutLength "+this.getWaitExpectedTimeoutLength()));break}case"ERROR":{this.closeWithError(new be({errCode:ue.SDK_DATABASE_REALTIME_LISTENER_SERVER_ERROR_MSG,errMsg:t.msgData.code+" - "+t.msgData.message}));break}default:{console.warn("[realtime listener] virtual client receive unexpected msg "+t.msgType+": ",t);break}}},e.prototype.closeWithError=function(t){this.watchStatus=H.ERRORED,this.clearACKSchedule(),this.listener.onError(t),this.onWatchClose(this,this.sessionInfo&&this.sessionInfo.queryID||""),console.log("[realtime] client closed ("+this.collectionName+" "+this.query+") (watchId "+this.watchId+")")},e.prototype.pause=function(){this.watchStatus=H.PAUSED,console.log("[realtime] client paused ("+this.collectionName+" "+this.query+") (watchId "+this.watchId+")")},e.prototype.resume=function(){return fe(this,void 0,void 0,function(){var t;return ae(this,function(r){switch(r.label){case 0:this.watchStatus=H.RESUMING,console.log("[realtime] client resuming with "+(this.sessionInfo?"REBUILD_WATCH":"INIT_WATCH")+" ("+this.collectionName+" "+this.query+") ("+this.watchId+")"),r.label=1;case 1:return r.trys.push([1,3,,4]),[4,this.sessionInfo?this.rebuildWatch():this.initWatch()];case 2:return r.sent(),console.log("[realtime] client successfully resumed ("+this.collectionName+" "+this.query+") ("+this.watchId+")"),[3,4];case 3:return t=r.sent(),console.error("[realtime] client resume failed ("+this.collectionName+" "+this.query+") ("+this.watchId+")",t),[3,4];case 4:return[2]}})})},e.prototype.useRetryTicket=function(t){return this._availableRetries[t]&&this._availableRetries[t]>0?(this._availableRetries[t]--,console.log("[realtime] "+t+" use a retry ticket, now only "+this._availableRetries[t]+" retry left"),!0):!1},e.prototype.handleServerEvents=function(t){return fe(this,void 0,void 0,function(){var r;return ae(this,function(n){switch(n.label){case 0:return n.trys.push([0,2,,3]),this.scheduleSendACK(),[4,this._handleServerEvents(t)];case 1:return n.sent(),this._postHandleServerEventsValidityCheck(t),[3,3];case 2:throw r=n.sent(),console.error("[realtime listener] internal non-fatal error: handle server events failed with error: ",r),r;case 3:return[2]}})})},e.prototype._handleServerEvents=function(t){return fe(this,void 0,void 0,function(){var r,n,i,o,a,l,p,c,g,m,_,I;return ae(this,function(T){switch(T.label){case 0:if(r=t.requestId,n=t.msgData.events,i=t.msgType,!n.length||!this.sessionInfo)return[2];o=this.sessionInfo;try{a=n.map($f)}catch(N){return this.closeWithError(new be({errCode:ue.SDK_DATABASE_REALTIME_LISTENER_RECEIVE_INVALID_SERVER_DATA,errMsg:N})),[2]}l=Ni(o.currentDocs),p=!1,c=function(N,D){var x,P,$,q,G,O,q,K,K,$,$,K,ie,ie,xe,Me,Re;return ae(this,function(ge){switch(ge.label){case 0:return x=a[N],o.currentEventId>=x.id?(!a[N-1]||x.id>a[N-1].id?console.warn("[realtime] duplicate event received, cur "+o.currentEventId+" but got "+x.id):console.error("[realtime listener] server non-fatal error: events out of order (the latter event's id is smaller than that of the former) (requestId "+r+")"),[2,"continue"]):[3,1];case 1:if(o.currentEventId!==x.id-1)return[3,2];switch(x.dataType){case"update":{if(!x.doc)switch(x.queueType){case"update":case"dequeue":{if(P=l.find(function(X){return X._id===x.docId}),P){if($=Sf(P),x.updatedFields)for(q in x.updatedFields)bc($,q,x.updatedFields[q]);if(x.removedFields)for(G=0,O=x.removedFields;G<O.length;G++)q=O[G],bf($,q);x.doc=$}else console.error("[realtime listener] internal non-fatal server error: unexpected update dataType event where no doc is associated.");break}case"enqueue":throw K=new be({errCode:ue.SDK_DATABASE_REALTIME_LISTENER_UNEXPECTED_FATAL_ERROR,errMsg:'HandleServerEvents: full doc is not provided with dataType="update" and queueType="enqueue" (requestId '+t.requestId+")"}),g.closeWithError(K),K}break}case"replace":{if(!x.doc)throw K=new be({errCode:ue.SDK_DATABASE_REALTIME_LISTENER_UNEXPECTED_FATAL_ERROR,errMsg:'HandleServerEvents: full doc is not provided with dataType="replace" (requestId '+t.requestId+")"}),g.closeWithError(K),K;break}case"remove":{$=l.find(function(X){return X._id===x.docId}),$?x.doc=$:console.error("[realtime listener] internal non-fatal server error: unexpected remove event where no doc is associated.");break}case"limit":{if(!x.doc)switch(x.queueType){case"dequeue":{$=l.find(function(X){return X._id===x.docId}),$?x.doc=$:console.error("[realtime listener] internal non-fatal server error: unexpected limit dataType event where no doc is associated.");break}case"enqueue":throw K=new be({errCode:ue.SDK_DATABASE_REALTIME_LISTENER_UNEXPECTED_FATAL_ERROR,errMsg:'HandleServerEvents: full doc is not provided with dataType="limit" and queueType="enqueue" (requestId '+t.requestId+")"}),g.closeWithError(K),K}break}}switch(x.queueType){case"init":{p?l.push(x.doc):(p=!0,l=[x.doc]);break}case"enqueue":{l.push(x.doc);break}case"dequeue":{ie=l.findIndex(function(X){return X._id===x.docId}),ie>-1?l.splice(ie,1):console.error("[realtime listener] internal non-fatal server error: unexpected dequeue event where no doc is associated.");break}case"update":{ie=l.findIndex(function(X){return X._id===x.docId}),ie>-1?l[ie]=x.doc:console.error("[realtime listener] internal non-fatal server error: unexpected queueType update event where no doc is associated.");break}}return(N===D-1||a[N+1]&&a[N+1].id!==x.id)&&(xe=Ni(l),Me=a.slice(0,N+1).filter(function(X){return X.id===x.id}),g.sessionInfo.currentEventId=x.id,g.sessionInfo.currentDocs=l,Re=new xi({id:x.id,docChanges:Me,docs:xe,msgType:i}),g.listener.onChange(Re)),[3,4];case 2:return console.warn("[realtime listener] event received is out of order, cur "+g.sessionInfo.currentEventId+" but got "+x.id),[4,g.rebuildWatch()];case 3:return ge.sent(),[2,{value:void 0}];case 4:return[2]}})},g=this,m=0,_=a.length,T.label=1;case 1:return m<_?[5,c(m,_)]:[3,4];case 2:if(I=T.sent(),typeof I=="object")return[2,I.value];T.label=3;case 3:return m++,[3,1];case 4:return[2]}})})},e.prototype._postHandleServerEventsValidityCheck=function(t){if(!this.sessionInfo){console.error("[realtime listener] internal non-fatal error: sessionInfo lost after server event handling, this should never occur");return}if(this.sessionInfo.expectEventId&&this.sessionInfo.currentEventId>=this.sessionInfo.expectEventId&&this.clearWaitExpectedEvent(),this.sessionInfo.currentEventId<t.msgData.currEvent){console.warn("[realtime listener] internal non-fatal error: client eventId does not match with server event id after server event handling");return}},e.prototype.clearWaitExpectedEvent=function(){this._waitExpectedTimeoutId&&(clearTimeout(this._waitExpectedTimeoutId),this._waitExpectedTimeoutId=void 0)},e}();function $f(e){var t={id:e.ID,dataType:e.DataType,queueType:e.QueueType,docId:e.DocID,doc:e.Doc&&e.Doc!=="{}"?JSON.parse(e.Doc):void 0};return e.DataType==="update"&&(e.UpdatedFields&&(t.updatedFields=JSON.parse(e.UpdatedFields)),(e.removedFields||e.RemovedFields)&&(t.removedFields=JSON.parse(e.removedFields))),t}var xo={1e3:{code:1e3,name:"Normal Closure",description:"Normal closure; the connection successfully completed whatever purpose for which it was created."},1001:{code:1001,name:"Going Away",description:"The endpoint is going away, either because of a server failure or because the browser is navigating away from the page that opened the connection."},1002:{code:1002,name:"Protocol Error",description:"The endpoint is terminating the connection due to a protocol error."},1003:{code:1003,name:"Unsupported Data",description:"The connection is being terminated because the endpoint received data of a type it cannot accept (for example, a text-only endpoint received binary data)."},1005:{code:1005,name:"No Status Received",description:"Indicates that no status code was provided even though one was expected."},1006:{code:1006,name:"Abnormal Closure",description:"Used to indicate that a connection was closed abnormally (that is, with no close frame being sent) when a status code is expected."},1007:{code:1007,name:"Invalid frame payload data",description:"The endpoint is terminating the connection because a message was received that contained inconsistent data (e.g., non-UTF-8 data within a text message)."},1008:{code:1008,name:"Policy Violation",description:"The endpoint is terminating the connection because it received a message that violates its policy. This is a generic status code, used when codes 1003 and 1009 are not suitable."},1009:{code:1009,name:"Message too big",description:"The endpoint is terminating the connection because a data frame was received that is too large."},1010:{code:1010,name:"Missing Extension",description:"The client is terminating the connection because it expected the server to negotiate one or more extension, but the server didn't."},1011:{code:1011,name:"Internal Error",description:"The server is terminating the connection because it encountered an unexpected condition that prevented it from fulfilling the request."},1012:{code:1012,name:"Service Restart",description:"The server is terminating the connection because it is restarting."},1013:{code:1013,name:"Try Again Later",description:"The server is terminating the connection due to a temporary condition, e.g. it is overloaded and is casting off some of its clients."},1014:{code:1014,name:"Bad Gateway",description:"The server was acting as a gateway or proxy and received an invalid response from the upstream server. This is similar to 502 HTTP Status Code."},1015:{code:1015,name:"TLS Handshake",description:"Indicates that the connection was closed due to a failure to perform a TLS handshake (e.g., the server certificate can't be verified)."},3e3:{code:3e3,name:"Reconnect WebSocket",description:"The client is terminating the connection because it wants to reconnect"},3001:{code:3001,name:"No Realtime Listeners",description:"The client is terminating the connection because no more realtime listeners exist"},3002:{code:3002,name:"Heartbeat Ping Error",description:"The client is terminating the connection due to its failure in sending heartbeat messages"},3003:{code:3003,name:"Heartbeat Pong Timeout Error",description:"The client is terminating the connection because no heartbeat response is received from the server"},3050:{code:3050,name:"Server Close",description:"The client is terminating the connection because no heartbeat response is received from the server"}},_e;(function(e){e[e.NormalClosure=1e3]="NormalClosure",e[e.GoingAway=1001]="GoingAway",e[e.ProtocolError=1002]="ProtocolError",e[e.UnsupportedData=1003]="UnsupportedData",e[e.NoStatusReceived=1005]="NoStatusReceived",e[e.AbnormalClosure=1006]="AbnormalClosure",e[e.InvalidFramePayloadData=1007]="InvalidFramePayloadData",e[e.PolicyViolation=1008]="PolicyViolation",e[e.MessageTooBig=1009]="MessageTooBig",e[e.MissingExtension=1010]="MissingExtension",e[e.InternalError=1011]="InternalError",e[e.ServiceRestart=1012]="ServiceRestart",e[e.TryAgainLater=1013]="TryAgainLater",e[e.BadGateway=1014]="BadGateway",e[e.TLSHandshake=1015]="TLSHandshake",e[e.ReconnectWebSocket=3e3]="ReconnectWebSocket",e[e.NoRealtimeListeners=3001]="NoRealtimeListeners",e[e.HeartbeatPingError=3002]="HeartbeatPingError",e[e.HeartbeatPongTimeoutError=3003]="HeartbeatPongTimeoutError",e[e.NoAuthentication=3050]="NoAuthentication"})(_e||(_e={}));var nn=function(e,t){var r=xo[e],n=r?r.name+", code "+e+", reason "+(t||r.description):"code "+e;return new be({errCode:ue.SDK_DATABASE_REALTIME_LISTENER_WEBSOCKET_CONNECTION_CLOSED,errMsg:n})},To=null,No="web";function Mf(){return To}function Ff(e){To=e}function Oi(){return No}function Uf(e){No=e}var yr=function(){return yr=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++){t=arguments[r];for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i])}return e},yr.apply(this,arguments)},Ne=function(e,t,r,n){function i(o){return o instanceof r?o:new r(function(a){a(o)})}return new(r||(r=Promise))(function(o,a){function l(g){try{c(n.next(g))}catch(m){a(m)}}function p(g){try{c(n.throw(g))}catch(m){a(m)}}function c(g){g.done?o(g.value):i(g.value).then(l,p)}c((n=n.apply(e,t||[])).next())})},Oe=function(e,t){var r={label:0,sent:function(){if(o[0]&1)throw o[1];return o[1]},trys:[],ops:[]},n,i,o,a;return a={next:l(0),throw:l(1),return:l(2)},typeof Symbol=="function"&&(a[Symbol.iterator]=function(){return this}),a;function l(c){return function(g){return p([c,g])}}function p(c){if(n)throw new TypeError("Generator is already executing.");for(;r;)try{if(n=1,i&&(o=c[0]&2?i.return:c[0]?i.throw||((o=i.return)&&o.call(i),0):i.next)&&!(o=o.call(i,c[1])).done)return o;switch(i=0,o&&(c=[c[0]&2,o.value]),c[0]){case 0:case 1:o=c;break;case 4:return r.label++,{value:c[1],done:!1};case 5:r.label++,i=c[1],c=[0];continue;case 7:c=r.ops.pop(),r.trys.pop();continue;default:if(o=r.trys,!(o=o.length>0&&o[o.length-1])&&(c[0]===6||c[0]===2)){r=0;continue}if(c[0]===3&&(!o||c[1]>o[0]&&c[1]<o[3])){r.label=c[1];break}if(c[0]===6&&r.label<o[1]){r.label=o[1],o=c;break}if(o&&r.label<o[2]){r.label=o[2],r.ops.push(c);break}o[2]&&r.ops.pop(),r.trys.pop();continue}c=t.call(e,r)}catch(g){c=[6,g],i=0}finally{n=o=0}if(c[0]&5)throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}},on={CONNECTING:0,OPEN:1,CLOSING:2,CLOSED:3},Ai=3,jf=5e3,Wf=1e4,Gf=5,Hf=1e4,qf=2,Vf=2,kf=5e3,Jf=function(){function e(t){var r=this;this._virtualWSClient=new Set,this._queryIdClientMap=new Map,this._watchIdClientMap=new Map,this._pingFailed=0,this._pongMissed=0,this._logins=new Map,this._wsReadySubsribers=[],this._wsResponseWait=new Map,this._rttObserved=[],this.send=function(n){return Ne(r,void 0,void 0,function(){var i=this;return Oe(this,function(o){return[2,new Promise(function(a,l){return Ne(i,void 0,void 0,function(){var p,c,g,m,_,I,T,N=this;return Oe(this,function(D){switch(D.label){case 0:c=!1,g=!1,m=function(x){c=!0,p&&clearTimeout(p),a(x)},_=function(x){g=!0,p&&clearTimeout(p),l(x)},n.timeout&&(p=setTimeout(function(){return Ne(N,void 0,void 0,function(){return Oe(this,function(x){switch(x.label){case 0:return!c||!g?[4,pn(0)]:[3,2];case 1:x.sent(),(!c||!g)&&_(new Tf("wsclient.send timedout")),x.label=2;case 2:return[2]}})})},n.timeout)),D.label=1;case 1:return D.trys.push([1,8,,9]),this._wsInitPromise?[4,this._wsInitPromise]:[3,3];case 2:D.sent(),D.label=3;case 3:if(!this._ws)return _(new Error("invalid state: ws connection not exists, can not send message")),[2];if(this._ws.readyState!==on.OPEN)return _(new Error("ws readyState invalid: "+this._ws.readyState+", can not send message")),[2];n.waitResponse&&this._wsResponseWait.set(n.msg.requestId,{resolve:m,reject:_,skipOnMessage:n.skipOnMessage}),D.label=4;case 4:return D.trys.push([4,6,,7]),[4,this._ws.send(JSON.stringify(n.msg))];case 5:return D.sent(),n.waitResponse||m(),[3,7];case 6:return I=D.sent(),I&&(_(I),n.waitResponse&&this._wsResponseWait.delete(n.msg.requestId)),[3,7];case 7:return[3,9];case 8:return T=D.sent(),_(T),[3,9];case 9:return[2]}})})})]})})},this.closeAllClients=function(n){r._virtualWSClient.forEach(function(i){i.closeWithError(n)})},this.pauseClients=function(n){(n||r._virtualWSClient).forEach(function(i){i.pause()})},this.resumeClients=function(n){(n||r._virtualWSClient).forEach(function(i){i.resume()})},this.initWebSocketConnection=function(n,i){return i===void 0&&(i=r._maxReconnect),Ne(r,void 0,void 0,function(){var o=this;return Oe(this,function(a){switch(a.label){case 0:if(n&&this._reconnectState)return[2];if(n&&(this._reconnectState=!0),this._wsInitPromise)return[2,this._wsInitPromise];n&&this.pauseClients(),this.close(_e.ReconnectWebSocket),this._wsInitPromise=new Promise(function(l,p){return Ne(o,void 0,void 0,function(){var c,g,m,_=this;return Oe(this,function(I){switch(I.label){case 0:return I.trys.push([0,6,,11]),[4,this.getWsSign()];case 1:return c=I.sent(),[4,new Promise(function(T){var N=c.wsUrl||"wss://tcb-ws.tencentcloudapi.com",D=Mf();_._ws=D?new D(N):new WebSocket(N),T()})];case 2:return I.sent(),this._ws.connect?[4,this._ws.connect()]:[3,4];case 3:I.sent(),I.label=4;case 4:return[4,this.initWebSocketEvent()];case 5:return I.sent(),l(),n&&(this.resumeClients(),this._reconnectState=!1),[3,11];case 6:return g=I.sent(),console.error("[realtime] initWebSocketConnection connect fail",g),i>0?(m=!0,this._wsInitPromise=void 0,m?[4,pn(this._reconnectInterval)]:[3,8]):[3,9];case 7:I.sent(),n&&(this._reconnectState=!1),I.label=8;case 8:return l(this.initWebSocketConnection(n,i-1)),[3,10];case 9:p(g),n&&this.closeAllClients(new be({errCode:ue.SDK_DATABASE_REALTIME_LISTENER_RECONNECT_WATCH_FAIL,errMsg:g})),I.label=10;case 10:return[3,11];case 11:return[2]}})})}),a.label=1;case 1:return a.trys.push([1,3,4,5]),[4,this._wsInitPromise];case 2:return a.sent(),this._wsReadySubsribers.forEach(function(l){var p=l.resolve;return p()}),[3,5];case 3:return a.sent(),this._wsReadySubsribers.forEach(function(l){var p=l.reject;return p()}),[3,5];case 4:return this._wsInitPromise=void 0,this._wsReadySubsribers=[],[7];case 5:return[2]}})})},this.initWebSocketEvent=function(){return new Promise(function(n,i){if(!r._ws)throw new Error("can not initWebSocketEvent, ws not exists");var o=!1;r._ws.onopen=function(a){console.warn("[realtime] ws event: open",a),o=!0,n()},r._ws.onerror=function(a){r._logins=new Map,o?(console.error("[realtime] ws event: error",a),r.clearHeartbeat(),r._virtualWSClient.forEach(function(l){return l.closeWithError(new be({errCode:ue.SDK_DATABASE_REALTIME_LISTENER_WEBSOCKET_CONNECTION_ERROR,errMsg:a}))})):(console.error("[realtime] ws open failed with ws event: error",a),i(a))},r._ws.onclose=function(a){switch(console.warn("[realtime] ws event: close",a),r._logins=new Map,r.clearHeartbeat(),a.code){case _e.ReconnectWebSocket:break;case _e.NoRealtimeListeners:break;case _e.HeartbeatPingError:case _e.HeartbeatPongTimeoutError:case _e.NormalClosure:case _e.AbnormalClosure:{r._maxReconnect>0?r.initWebSocketConnection(!0,r._maxReconnect):r.closeAllClients(nn(a.code));break}case _e.NoAuthentication:{r.closeAllClients(nn(a.code,a.reason));break}default:r._maxReconnect>0?r.initWebSocketConnection(!0,r._maxReconnect):r.closeAllClients(nn(a.code))}},r._ws.onmessage=function(a){var l=a.data;r.heartbeat();var p;try{p=JSON.parse(l)}catch(x){throw new Error("[realtime] onMessage parse res.data error: "+x)}if(p.msgType==="ERROR"){var c=null;r._virtualWSClient.forEach(function(x){x.watchId===p.watchId&&(c=x)}),c&&c.listener.onError(p)}var g=r._wsResponseWait.get(p.requestId);if(g){try{p.msgType==="ERROR"?g.reject(new xf(p)):g.resolve(p)}catch(x){console.error("ws onMessage responseWaitSpec.resolve(msg) errored:",x)}finally{r._wsResponseWait.delete(p.requestId)}if(g.skipOnMessage)return}if(p.msgType==="PONG"){if(r._lastPingSendTS){var m=Date.now()-r._lastPingSendTS;if(m>Wf){console.warn("[realtime] untrusted rtt observed: "+m);return}r._rttObserved.length>=Ai&&r._rttObserved.splice(0,r._rttObserved.length-Ai+1),r._rttObserved.push(m)}return}var _=p.watchId&&r._watchIdClientMap.get(p.watchId);if(_)_.onMessage(p);else switch(console.error("[realtime] no realtime listener found responsible for watchId "+p.watchId+": ",p),p.msgType){case"INIT_EVENT":case"NEXT_EVENT":case"CHECK_EVENT":{_=r._queryIdClientMap.get(p.msgData.queryID),_&&_.onMessage(p);break}default:for(var I=0,T=Array.from(r._watchIdClientMap.entries());I<T.length;I++){var N=T[I],D=N[1];D.onMessage(p);break}}},r.heartbeat()})},this.isWSConnected=function(){return!!(r._ws&&r._ws.readyState===on.OPEN)},this.onceWSConnected=function(){return Ne(r,void 0,void 0,function(){var n=this;return Oe(this,function(i){return this.isWSConnected()?[2]:this._wsInitPromise?[2,this._wsInitPromise]:[2,new Promise(function(o,a){n._wsReadySubsribers.push({resolve:o,reject:a})})]})})},this.webLogin=function(n,i){return Ne(r,void 0,void 0,function(){var o,a,l,p,c,g,m,_,I=this;return Oe(this,function(T){switch(T.label){case 0:if(!i){if(n){if(o=this._logins.get(n),o){if(o.loggedIn&&o.loginResult)return[2,o.loginResult];if(o.loggingInPromise)return[2,o.loggingInPromise]}}else if(a=this._logins.get(""),a!=null&&a.loggingInPromise)return[2,a.loggingInPromise]}l=new Promise(function(N,D){return Ne(I,void 0,void 0,function(){var x,P,G,O,q;return Oe(this,function($){switch($.label){case 0:return $.trys.push([0,3,,4]),[4,this.getWsSign()];case 1:return x=$.sent(),P={envId:x.envId||"",accessToken:"",referrer:"web",sdkVersion:"",dataVersion:""},G={watchId:void 0,requestId:St(),msgType:"LOGIN",msgData:P,exMsgData:{runtime:Oi(),signStr:x.signStr,secretVersion:x.secretVersion}},[4,this.send({msg:G,waitResponse:!0,skipOnMessage:!0,timeout:kf})];case 2:return O=$.sent(),O.msgData.code?D(new Error(O.msgData.code+" "+O.msgData.message)):N({envId:x.envId}),[3,4];case 3:return q=$.sent(),D(q),[3,4];case 4:return[2]}})})}),p=n&&this._logins.get(n),c=Date.now(),p?(p.loggedIn=!1,p.loggingInPromise=l,p.loginStartTS=c):(p={loggedIn:!1,loggingInPromise:l,loginStartTS:c},this._logins.set(n||"",p)),T.label=1;case 1:return T.trys.push([1,3,,4]),[4,l];case 2:if(g=T.sent(),m=n&&this._logins.get(n),m&&m===p&&m.loginStartTS===c)return p.loggedIn=!0,p.loggingInPromise=void 0,p.loginStartTS=void 0,p.loginResult=g,[2,g];if(m){if(m.loggedIn&&m.loginResult)return[2,m.loginResult];if(m.loggingInPromise)return[2,m.loggingInPromise];throw new Error("ws unexpected login info")}else throw new Error("ws login info reset");case 3:throw _=T.sent(),p.loggedIn=!1,p.loggingInPromise=void 0,p.loginStartTS=void 0,p.loginResult=void 0,_;case 4:return[2]}})})},this.getWsSign=function(){return Ne(r,void 0,void 0,function(){var n,i,o,a,l,p,c;return Oe(this,function(g){switch(g.label){case 0:return this._wsSign&&this._wsSign.expiredTs>Date.now()?[2,this._wsSign]:(n=Date.now()+6e4,[4,this._context.appConfig.request.send("auth.wsWebSign",{runtime:Oi()})]);case 1:if(i=g.sent(),i.code)throw new Error("[tcb-js-sdk] 获取实时数据推送登录票据失败: "+i.code);if(i.data)return o=i.data,a=o.signStr,l=o.wsUrl,p=o.secretVersion,c=o.envId,[2,{signStr:a,wsUrl:l,secretVersion:p,envId:c,expiredTs:n}];throw new Error("[tcb-js-sdk] 获取实时数据推送登录票据失败")}})})},this.getWaitExpectedTimeoutLength=function(){return r._rttObserved.length?r._rttObserved.reduce(function(n,i){return n+i})/r._rttObserved.length*1.5:jf},this.ping=function(){return Ne(r,void 0,void 0,function(){var n;return Oe(this,function(i){switch(i.label){case 0:return n={watchId:void 0,requestId:St(),msgType:"PING",msgData:null},[4,this.send({msg:n})];case 1:return i.sent(),[2]}})})},this.onWatchStart=function(n,i){r._queryIdClientMap.set(i,n)},this.onWatchClose=function(n,i){i&&r._queryIdClientMap.delete(i),r._watchIdClientMap.delete(n.watchId),r._virtualWSClient.delete(n),r._virtualWSClient.size||r.close(_e.NoRealtimeListeners)},this._maxReconnect=t.maxReconnect||Gf,this._reconnectInterval=t.reconnectInterval||Hf,this._context=t.context}return e.prototype.clearHeartbeat=function(){this._pingTimeoutId&&clearTimeout(this._pingTimeoutId),this._pongTimeoutId&&clearTimeout(this._pongTimeoutId)},e.prototype.close=function(t){this.clearHeartbeat(),this._ws&&(this._ws.close(t,xo[t].name),this._ws=void 0)},e.prototype.watch=function(t){!this._ws&&!this._wsInitPromise&&this.initWebSocketConnection(!1);var r=new Pf(yr(yr({},t),{send:this.send,login:this.webLogin,isWSConnected:this.isWSConnected,onceWSConnected:this.onceWSConnected,getWaitExpectedTimeoutLength:this.getWaitExpectedTimeoutLength,onWatchStart:this.onWatchStart,onWatchClose:this.onWatchClose,debug:!0}));return this._virtualWSClient.add(r),this._watchIdClientMap.set(r.watchId,r),r.listener},e.prototype.heartbeat=function(t){var r=this;this.clearHeartbeat(),this._pingTimeoutId=setTimeout(function(){return Ne(r,void 0,void 0,function(){var n=this;return Oe(this,function(i){switch(i.label){case 0:return i.trys.push([0,2,,3]),!this._ws||this._ws.readyState!==on.OPEN?[2]:(this._lastPingSendTS=Date.now(),[4,this.ping()]);case 1:return i.sent(),this._pingFailed=0,this._pongTimeoutId=setTimeout(function(){console.error("pong timed out"),n._pongMissed<Vf?(n._pongMissed++,n.heartbeat(!0)):n.initWebSocketConnection(!0)},this._context.appConfig.realtimePongWaitTimeout),[3,3];case 2:return i.sent(),this._pingFailed<qf?(this._pingFailed++,this.heartbeat()):this.close(_e.HeartbeatPingError),[3,3];case 3:return[2]}})})},t?0:this._context.appConfig.realtimePingInterval)},e}(),Kf={target:"database",entity:function(){var e=this.platform,t=e.adapter,r=e.runtime;Ff(t.wsClass),Uf(r)}},Yf={name:"realtime",IIFE:!0,entity:function(){this.prototype.wsClientClass=Jf}};try{cloudbase.registerComponent(Yf),cloudbase.registerHook(Kf)}catch{}const Xf="walle-quant-website-2cg83b3402af",sr="pms",An=Hs.init({env:Xf}),ar=An.database(),sn=An.auth();class Zf{async login(){return sn.anonymousAuthProvider().signIn()}hasLoginState(){return sn.hasLoginState()}uid(){return void 0||sn.currentUser.uid}}class zf{create({uid:t="",order:r={},key:n=""}){return ar.collection(sr).add({uid:t,order:r,key:n})}query(t){return ar.collection(sr).where({uid:t}).get()}delete(t){return ar.collection(sr).where({uid:t}).delete()}watch(t,r=()=>{},n=()=>{}){return ar.collection(sr).where({uid:t}).watch({onChange:r,onError:n})}}class Qf{async request(t="native",r){const n=async o=>await(await fetch(o,{method:"POST",mode:"cors",headers:{"Content-Type":"application/json"},body:JSON.stringify(r)})).json(),i=`xpms/${t}`;try{const o=location.hostname==="localhost"?`/s/${i}`:`https://s.one-quant.com/${i}`;return await n(o)}catch{const a=`https://walle-quant-website-2cg83b3402af-1256154226.ap-shanghai.app.tcloudbase.com/${i}`;return await n(a)}}async query(t){return this.request("query",{out_trade_no:t})}async native({amount:t,id:r,title:n,attach:i}){return this.request("native",{total_fee:t,out_trade_no:r,body:n,attach:i})}}const nt={app:An,user:new Zf,db:new zf,pay:new Qf},eh="/assets/wx-Bfv1OeoY.png",th={props:["visible","price","title","message","messageTip","messageSucc","messageFail","orderTitle","orderAttach","orderPrefix"],components:{ElDialog:Ri},data(){return{isVisible:this.$props.visible,isShowClose:!1,amount:0,order:{qrcode:"",out_trade_no:"",pay_order_id:""},elmessage:this.$props.message||qs}},mounted(){this.$props.visible&&this.payment(this.$props.price)},unmounted(){this.hide()},methods:{onbeforeunload(e){try{const t="您确定要离开吗？ 等待支付结果中 请勿离开此页面";return typeof e>"u"&&(e=window.event),e&&(e.returnValue=t),t}catch{}},show(){this.isVisible=!0},hide(){this.isVisible=!1,this.watcher&&this.watcher.close(),clearInterval(this.intervalId),this.elmessage.closeAll(),window.removeEventListener("beforeunload",this.onbeforeunload)},async payment(e){if(e&&(this.amount=e),this.amount<=0){this.elmessage.info("非法价格"),this.$emit("fail");return}try{await nt.user.login();const t=nt.user.uid(),r=tr().format("YYYYMMDD"),n=tr().format("YYYYMMDD"),i=this.$props.orderPrefix||"9560",o=(this.$props.orderTitle?this.$props.orderTitle+" - ":"")+r.slice(4)+n.slice(4)+tr().format("SSS"),a=this.$props.orderAttach||t,l=i+r+n+tr().format("HHmmssSSSSSS"),p=+(this.amount*100).toFixed(),c=await nt.pay.native({title:o,amount:p,id:l,attach:a});if(!(c.return_code===1&&c.qrcode)){this.elmessage.info({message:"请求支付二维码失败 请稍后重试"}),this.$emit("fail");return}this.isVisible=!0,this.elmessage.closeAll(),this.elmessage.info({message:this.$props.messageTip||"请微信扫码完成支付 等待支付结果中",duration:0}),window.addEventListener("beforeunload",this.onbeforeunload);const g=N=>N&&N.order&&N.order.out_trade_no==l?(this.watcher&&this.watcher.close(),clearInterval(this.intervalId),this.isVisible=!1,this.elmessage.closeAll(),this.elmessage.info({message:this.$props.messageSucc||"支付成功"}),this.$emit("succ",N),!0):!1,m=await nt.db.query(t);(!m.data||!m.data.length)&&await nt.db.create({uid:t}),this.order=c;let _=50;this.intervalId=setInterval(async()=>{_--;const N=await nt.pay.query(this.order.pay_order_id);if(N&&+N.status==1){g({order:{out_trade_no:l,total_fee:p,status:N.status}});return}_===0&&(this.watcher&&this.watcher.close(),clearInterval(this.intervalId),this.elmessage.closeAll(),this.isVisible=!1,this.elmessage.info({message:this.$props.messageFail||"支付失败 请稍后重试"}),this.$emit("fail"))},6*1e3);const I=N=>{N.msgType!=="INIT_EVENT"&&g(N.docs[0])},T=()=>{};this.watcher=nt.db.watch(t,I,T)}catch(t){try{window.__WALLE_GUARD&&window.__WALLE_GUARD.sendSecurityReport("pay|"+(t.message||"exception").toLowerCase(),t.stack||t)}catch{}}},async onClose(e){this.watcher&&this.watcher.close(),clearInterval(this.intervalId),this.elmessage.closeAll(),this.isVisible=!1,this.order={},e&&e()}}},rh={class:"tips"},nh={class:"qrcode"},ih={class:"img"},oh=["src"],sh={class:"price"},ah=Ae("span",{class:"icon-price"},"¥",-1),uh=Ae("span",{class:"unit-price"},"元",-1),ch={key:0},fh=Ae("br",null,null,-1),hh={class:"footer"},lh={style:{color:"#999"}},dh=Ae("img",{src:eh,width:"100",style:{"margin-top":"5px"}},null,-1),ph=Ae("a",{class:"custom-wx"},"客服",-1);function gh(e,t,r,n,i,o){const a=Ws,l=Ri,p=Gs;return qr(),Ms(l,{class:"payment-dialog-9527",modelValue:i.isVisible,"onUpdate:modelValue":t[0]||(t[0]=c=>i.isVisible=c),modal:!1,"close-on-click-modal":!1,"destroy-on-close":!0,"before-close":o.onClose,"show-close":i.isShowClose},{default:Vr(()=>[qn(e.$slots,"header"),Ae("p",rh,kr(e.$props.title||"微信扫码支付"),1),Ae("div",nh,[Fs((qr(),Vn("div",ih,[Ae("img",{src:i.order.qrcode},null,8,oh)])),[[p,!i.order.qrcode]]),Ae("h3",sh,[ah,er(" "+kr(i.amount)+" ",1),uh]),i.order.pay_order_id?(qr(),Vn("p",ch,"订单号 - "+kr(i.order.pay_order_id),1)):Us("",!0),er(" 请使用微信扫码完成支付 结果返回前 请勿关闭页面 "),fh]),Ae("div",hh,[Ae("div",lh,[er(" 若支付出现异常 请将订单号提供给 "),js(a,{effect:"light",placement:"top"},{content:Vr(()=>[dh]),default:Vr(()=>[ph]),_:1}),er(" 处理 ")]),qn(e.$slots,"footer")])]),_:3},8,["modelValue","before-close","show-close"])}const Sh=$s(th,[["render",gh]]);export{Sh as default};
